
/*
THIS IS A GENERATED/BUNDLED FILE BY ESBuild

MIT License
Copyright (c) 2022 MarginNote

If you want to view the source code, please visit the github repository.
Github: https://github.com/marginnoteapp/ohmymn

Welcome to contribute to this project!
*/

try {

"use strict";(()=>{var ah=Object.create;var qn=Object.defineProperty;var ch=Object.getOwnPropertyDescriptor;var uh=Object.getOwnPropertyNames;var ph=Object.getPrototypeOf,fh=Object.prototype.hasOwnProperty;var hh=(e,t,r)=>t in e?qn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var _=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var dh=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of uh(t))!fh.call(e,n)&&n!==r&&qn(e,n,{get:()=>t[n],enumerable:!(o=ch(t,n))||o.enumerable});return e};var C=(e,t,r)=>(r=e!=null?ah(ph(e)):{},dh(t||!e||!e.__esModule?qn(r,"default",{value:e,enumerable:!0}):r,e));var as=(e,t,r)=>(hh(e,typeof t!="symbol"?t+"":t,r),r);var Ur=_((Qw,fs)=>{var mh="2.0.0",gh=Number.MAX_SAFE_INTEGER||9007199254740991,yh=16;fs.exports={SEMVER_SPEC_VERSION:mh,MAX_LENGTH:256,MAX_SAFE_INTEGER:gh,MAX_SAFE_COMPONENT_LENGTH:yh}});var Fr=_((e0,hs)=>{var bh=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};hs.exports=bh});var er=_((qt,ds)=>{var{MAX_SAFE_COMPONENT_LENGTH:jn}=Ur(),xh=Fr();qt=ds.exports={};var wh=qt.re=[],v=qt.src=[],$=qt.t={},_h=0,O=(e,t,r)=>{let o=_h++;xh(e,o,t),$[e]=o,v[o]=t,wh[o]=new RegExp(t,r?"g":void 0)};O("NUMERICIDENTIFIER","0|[1-9]\\d*");O("NUMERICIDENTIFIERLOOSE","[0-9]+");O("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");O("MAINVERSION",`(${v[$.NUMERICIDENTIFIER]})\\.(${v[$.NUMERICIDENTIFIER]})\\.(${v[$.NUMERICIDENTIFIER]})`);O("MAINVERSIONLOOSE",`(${v[$.NUMERICIDENTIFIERLOOSE]})\\.(${v[$.NUMERICIDENTIFIERLOOSE]})\\.(${v[$.NUMERICIDENTIFIERLOOSE]})`);O("PRERELEASEIDENTIFIER",`(?:${v[$.NUMERICIDENTIFIER]}|${v[$.NONNUMERICIDENTIFIER]})`);O("PRERELEASEIDENTIFIERLOOSE",`(?:${v[$.NUMERICIDENTIFIERLOOSE]}|${v[$.NONNUMERICIDENTIFIER]})`);O("PRERELEASE",`(?:-(${v[$.PRERELEASEIDENTIFIER]}(?:\\.${v[$.PRERELEASEIDENTIFIER]})*))`);O("PRERELEASELOOSE",`(?:-?(${v[$.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${v[$.PRERELEASEIDENTIFIERLOOSE]})*))`);O("BUILDIDENTIFIER","[0-9A-Za-z-]+");O("BUILD",`(?:\\+(${v[$.BUILDIDENTIFIER]}(?:\\.${v[$.BUILDIDENTIFIER]})*))`);O("FULLPLAIN",`v?${v[$.MAINVERSION]}${v[$.PRERELEASE]}?${v[$.BUILD]}?`);O("FULL",`^${v[$.FULLPLAIN]}$`);O("LOOSEPLAIN",`[v=\\s]*${v[$.MAINVERSIONLOOSE]}${v[$.PRERELEASELOOSE]}?${v[$.BUILD]}?`);O("LOOSE",`^${v[$.LOOSEPLAIN]}$`);O("GTLT","((?:<|>)?=?)");O("XRANGEIDENTIFIERLOOSE",`${v[$.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);O("XRANGEIDENTIFIER",`${v[$.NUMERICIDENTIFIER]}|x|X|\\*`);O("XRANGEPLAIN",`[v=\\s]*(${v[$.XRANGEIDENTIFIER]})(?:\\.(${v[$.XRANGEIDENTIFIER]})(?:\\.(${v[$.XRANGEIDENTIFIER]})(?:${v[$.PRERELEASE]})?${v[$.BUILD]}?)?)?`);O("XRANGEPLAINLOOSE",`[v=\\s]*(${v[$.XRANGEIDENTIFIERLOOSE]})(?:\\.(${v[$.XRANGEIDENTIFIERLOOSE]})(?:\\.(${v[$.XRANGEIDENTIFIERLOOSE]})(?:${v[$.PRERELEASELOOSE]})?${v[$.BUILD]}?)?)?`);O("XRANGE",`^${v[$.GTLT]}\\s*${v[$.XRANGEPLAIN]}$`);O("XRANGELOOSE",`^${v[$.GTLT]}\\s*${v[$.XRANGEPLAINLOOSE]}$`);O("COERCE",`(^|[^\\d])(\\d{1,${jn}})(?:\\.(\\d{1,${jn}}))?(?:\\.(\\d{1,${jn}}))?(?:$|[^\\d])`);O("COERCERTL",v[$.COERCE],!0);O("LONETILDE","(?:~>?)");O("TILDETRIM",`(\\s*)${v[$.LONETILDE]}\\s+`,!0);qt.tildeTrimReplace="$1~";O("TILDE",`^${v[$.LONETILDE]}${v[$.XRANGEPLAIN]}$`);O("TILDELOOSE",`^${v[$.LONETILDE]}${v[$.XRANGEPLAINLOOSE]}$`);O("LONECARET","(?:\\^)");O("CARETTRIM",`(\\s*)${v[$.LONECARET]}\\s+`,!0);qt.caretTrimReplace="$1^";O("CARET",`^${v[$.LONECARET]}${v[$.XRANGEPLAIN]}$`);O("CARETLOOSE",`^${v[$.LONECARET]}${v[$.XRANGEPLAINLOOSE]}$`);O("COMPARATORLOOSE",`^${v[$.GTLT]}\\s*(${v[$.LOOSEPLAIN]})$|^$`);O("COMPARATOR",`^${v[$.GTLT]}\\s*(${v[$.FULLPLAIN]})$|^$`);O("COMPARATORTRIM",`(\\s*)${v[$.GTLT]}\\s*(${v[$.LOOSEPLAIN]}|${v[$.XRANGEPLAIN]})`,!0);qt.comparatorTrimReplace="$1$2$3";O("HYPHENRANGE",`^\\s*(${v[$.XRANGEPLAIN]})\\s+-\\s+(${v[$.XRANGEPLAIN]})\\s*$`);O("HYPHENRANGELOOSE",`^\\s*(${v[$.XRANGEPLAINLOOSE]})\\s+-\\s+(${v[$.XRANGEPLAINLOOSE]})\\s*$`);O("STAR","(<|>)?=?\\s*\\*");O("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");O("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Gr=_((t0,ms)=>{var Sh=["includePrerelease","loose","rtl"],Ch=e=>e?typeof e!="object"?{loose:!0}:Sh.filter(t=>e[t]).reduce((t,r)=>(t[r]=!0,t),{}):{};ms.exports=Ch});var Wn=_((r0,bs)=>{var gs=/^[0-9]+$/,ys=(e,t)=>{let r=gs.test(e),o=gs.test(t);return r&&o&&(e=+e,t=+t),e===t?0:r&&!o?-1:o&&!r?1:e<t?-1:1},Th=(e,t)=>ys(t,e);bs.exports={compareIdentifiers:ys,rcompareIdentifiers:Th}});var ke=_((o0,Ss)=>{var Uo=Fr(),{MAX_LENGTH:xs,MAX_SAFE_INTEGER:Fo}=Ur(),{re:ws,t:_s}=er(),Eh=Gr(),{compareIdentifiers:wr}=Wn(),He=class{constructor(t,r){if(r=Eh(r),t instanceof He){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>xs)throw new TypeError(`version is longer than ${xs} characters`);Uo("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let o=t.trim().match(r.loose?ws[_s.LOOSE]:ws[_s.FULL]);if(!o)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+o[1],this.minor=+o[2],this.patch=+o[3],this.major>Fo||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Fo||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Fo||this.patch<0)throw new TypeError("Invalid patch version");o[4]?this.prerelease=o[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<Fo)return i}return n}):this.prerelease=[],this.build=o[5]?o[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Uo("SemVer.compare",this.version,this.options,t),!(t instanceof He)){if(typeof t=="string"&&t===this.version)return 0;t=new He(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof He||(t=new He(t,this.options)),wr(this.major,t.major)||wr(this.minor,t.minor)||wr(this.patch,t.patch)}comparePre(t){if(t instanceof He||(t=new He(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{let o=this.prerelease[r],n=t.prerelease[r];if(Uo("prerelease compare",r,o,n),o===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(o===void 0)return-1;if(o===n)continue;return wr(o,n)}while(++r)}compareBuild(t){t instanceof He||(t=new He(t,this.options));let r=0;do{let o=this.build[r],n=t.build[r];if(Uo("prerelease compare",r,o,n),o===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(o===void 0)return-1;if(o===n)continue;return wr(o,n)}while(++r)}inc(t,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r),this.inc("pre",r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r),this.inc("pre",r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);o===-1&&this.prerelease.push(0)}r&&(wr(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=[r,0]):this.prerelease=[r,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};Ss.exports=He});var tr=_((n0,vs)=>{var{MAX_LENGTH:vh}=Ur(),{re:Cs,t:Ts}=er(),Es=ke(),$h=Gr(),kh=(e,t)=>{if(t=$h(t),e instanceof Es)return e;if(typeof e!="string"||e.length>vh||!(t.loose?Cs[Ts.LOOSE]:Cs[Ts.FULL]).test(e))return null;try{return new Es(e,t)}catch{return null}};vs.exports=kh});var ks=_((i0,$s)=>{var Nh=tr(),Ih=(e,t)=>{let r=Nh(e,t);return r?r.version:null};$s.exports=Ih});var Is=_((s0,Ns)=>{var Ph=tr(),Rh=(e,t)=>{let r=Ph(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};Ns.exports=Rh});var As=_((l0,Rs)=>{var Ps=ke(),Ah=(e,t,r,o)=>{typeof r=="string"&&(o=r,r=void 0);try{return new Ps(e instanceof Ps?e.version:e,r).inc(t,o).version}catch{return null}};Rs.exports=Ah});var Qe=_((a0,Ds)=>{var Os=ke(),Oh=(e,t,r)=>new Os(e,r).compare(new Os(t,r));Ds.exports=Oh});var Go=_((c0,Ls)=>{var Dh=Qe(),Lh=(e,t,r)=>Dh(e,t,r)===0;Ls.exports=Lh});var Us=_((u0,Bs)=>{var Ms=tr(),Mh=Go(),Bh=(e,t)=>{if(Mh(e,t))return null;{let r=Ms(e),o=Ms(t),n=r.prerelease.length||o.prerelease.length,i=n?"pre":"",s=n?"prerelease":"";for(let l in r)if((l==="major"||l==="minor"||l==="patch")&&r[l]!==o[l])return i+l;return s}};Bs.exports=Bh});var Gs=_((p0,Fs)=>{var Uh=ke(),Fh=(e,t)=>new Uh(e,t).major;Fs.exports=Fh});var js=_((f0,qs)=>{var Gh=ke(),qh=(e,t)=>new Gh(e,t).minor;qs.exports=qh});var Ks=_((h0,Ws)=>{var jh=ke(),Wh=(e,t)=>new jh(e,t).patch;Ws.exports=Wh});var Hs=_((d0,Vs)=>{var Kh=tr(),Vh=(e,t)=>{let r=Kh(e,t);return r&&r.prerelease.length?r.prerelease:null};Vs.exports=Vh});var Xs=_((m0,zs)=>{var Hh=Qe(),zh=(e,t,r)=>Hh(t,e,r);zs.exports=zh});var Ys=_((g0,Js)=>{var Xh=Qe(),Jh=(e,t)=>Xh(e,t,!0);Js.exports=Jh});var qo=_((y0,Qs)=>{var Zs=ke(),Yh=(e,t,r)=>{let o=new Zs(e,r),n=new Zs(t,r);return o.compare(n)||o.compareBuild(n)};Qs.exports=Yh});var tl=_((b0,el)=>{var Zh=qo(),Qh=(e,t)=>e.sort((r,o)=>Zh(r,o,t));el.exports=Qh});var ol=_((x0,rl)=>{var ed=qo(),td=(e,t)=>e.sort((r,o)=>ed(o,r,t));rl.exports=td});var qr=_((w0,nl)=>{var rd=Qe(),od=(e,t,r)=>rd(e,t,r)>0;nl.exports=od});var jo=_((_0,il)=>{var nd=Qe(),id=(e,t,r)=>nd(e,t,r)<0;il.exports=id});var Kn=_((S0,sl)=>{var sd=Qe(),ld=(e,t,r)=>sd(e,t,r)!==0;sl.exports=ld});var Wo=_((C0,ll)=>{var ad=Qe(),cd=(e,t,r)=>ad(e,t,r)>=0;ll.exports=cd});var Ko=_((T0,al)=>{var ud=Qe(),pd=(e,t,r)=>ud(e,t,r)<=0;al.exports=pd});var Vn=_((E0,cl)=>{var fd=Go(),hd=Kn(),dd=qr(),md=Wo(),gd=jo(),yd=Ko(),bd=(e,t,r,o)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return fd(e,r,o);case"!=":return hd(e,r,o);case">":return dd(e,r,o);case">=":return md(e,r,o);case"<":return gd(e,r,o);case"<=":return yd(e,r,o);default:throw new TypeError(`Invalid operator: ${t}`)}};cl.exports=bd});var pl=_((v0,ul)=>{var xd=ke(),wd=tr(),{re:Vo,t:Ho}=er(),_d=(e,t)=>{if(e instanceof xd)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let r=null;if(!t.rtl)r=e.match(Vo[Ho.COERCE]);else{let o;for(;(o=Vo[Ho.COERCERTL].exec(e))&&(!r||r.index+r[0].length!==e.length);)(!r||o.index+o[0].length!==r.index+r[0].length)&&(r=o),Vo[Ho.COERCERTL].lastIndex=o.index+o[1].length+o[2].length;Vo[Ho.COERCERTL].lastIndex=-1}return r===null?null:wd(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,t)};ul.exports=_d});var hl=_(($0,fl)=>{"use strict";fl.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}});var ml=_((k0,dl)=>{"use strict";dl.exports=q;q.Node=rr;q.create=q;function q(e){var t=this;if(t instanceof q||(t=new q),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(n){t.push(n)});else if(arguments.length>0)for(var r=0,o=arguments.length;r<o;r++)t.push(arguments[r]);return t}q.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t};q.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};q.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};q.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)Cd(this,arguments[e]);return this.length};q.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)Td(this,arguments[e]);return this.length};q.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};q.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};q.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,o=0;r!==null;o++)e.call(t,r.value,o,this),r=r.next};q.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,o=this.length-1;r!==null;o--)e.call(t,r.value,o,this),r=r.prev};q.prototype.get=function(e){for(var t=0,r=this.head;r!==null&&t<e;t++)r=r.next;if(t===e&&r!==null)return r.value};q.prototype.getReverse=function(e){for(var t=0,r=this.tail;r!==null&&t<e;t++)r=r.prev;if(t===e&&r!==null)return r.value};q.prototype.map=function(e,t){t=t||this;for(var r=new q,o=this.head;o!==null;)r.push(e.call(t,o.value,this)),o=o.next;return r};q.prototype.mapReverse=function(e,t){t=t||this;for(var r=new q,o=this.tail;o!==null;)r.push(e.call(t,o.value,this)),o=o.prev;return r};q.prototype.reduce=function(e,t){var r,o=this.head;if(arguments.length>1)r=t;else if(this.head)o=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;o!==null;n++)r=e(r,o.value,n),o=o.next;return r};q.prototype.reduceReverse=function(e,t){var r,o=this.tail;if(arguments.length>1)r=t;else if(this.tail)o=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=this.length-1;o!==null;n--)r=e(r,o.value,n),o=o.prev;return r};q.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;r!==null;t++)e[t]=r.value,r=r.next;return e};q.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;r!==null;t++)e[t]=r.value,r=r.prev;return e};q.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new q;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=0,n=this.head;n!==null&&o<e;o++)n=n.next;for(;n!==null&&o<t;o++,n=n.next)r.push(n.value);return r};q.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new q;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=this.length,n=this.tail;n!==null&&o>t;o--)n=n.prev;for(;n!==null&&o>e;o--,n=n.prev)r.push(n.value);return r};q.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var o=0,n=this.head;n!==null&&o<e;o++)n=n.next;for(var i=[],o=0;n&&o<t;o++)i.push(n.value),n=this.removeNode(n);n===null&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var o=0;o<r.length;o++)n=Sd(this,n,r[o]);return i};q.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;r!==null;r=r.prev){var o=r.prev;r.prev=r.next,r.next=o}return this.head=t,this.tail=e,this};function Sd(e,t,r){var o=t===e.head?new rr(r,null,t,e):new rr(r,t,t.next,e);return o.next===null&&(e.tail=o),o.prev===null&&(e.head=o),e.length++,o}function Cd(e,t){e.tail=new rr(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function Td(e,t){e.head=new rr(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function rr(e,t,r,o){if(!(this instanceof rr))return new rr(e,t,r,o);this.list=o,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{hl()(q)}catch{}});var wl=_((N0,xl)=>{"use strict";var Ed=ml(),or=Symbol("max"),$t=Symbol("length"),_r=Symbol("lengthCalculator"),Wr=Symbol("allowStale"),nr=Symbol("maxAge"),vt=Symbol("dispose"),gl=Symbol("noDisposeOnSet"),ye=Symbol("lruList"),ct=Symbol("cache"),bl=Symbol("updateAgeOnGet"),Hn=()=>1,Xn=class{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");let r=this[or]=t.max||1/0,o=t.length||Hn;if(this[_r]=typeof o!="function"?Hn:o,this[Wr]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[nr]=t.maxAge||0,this[vt]=t.dispose,this[gl]=t.noDisposeOnSet||!1,this[bl]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[or]=t||1/0,jr(this)}get max(){return this[or]}set allowStale(t){this[Wr]=!!t}get allowStale(){return this[Wr]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[nr]=t,jr(this)}get maxAge(){return this[nr]}set lengthCalculator(t){typeof t!="function"&&(t=Hn),t!==this[_r]&&(this[_r]=t,this[$t]=0,this[ye].forEach(r=>{r.length=this[_r](r.value,r.key),this[$t]+=r.length})),jr(this)}get lengthCalculator(){return this[_r]}get length(){return this[$t]}get itemCount(){return this[ye].length}rforEach(t,r){r=r||this;for(let o=this[ye].tail;o!==null;){let n=o.prev;yl(this,t,o,r),o=n}}forEach(t,r){r=r||this;for(let o=this[ye].head;o!==null;){let n=o.next;yl(this,t,o,r),o=n}}keys(){return this[ye].toArray().map(t=>t.key)}values(){return this[ye].toArray().map(t=>t.value)}reset(){this[vt]&&this[ye]&&this[ye].length&&this[ye].forEach(t=>this[vt](t.key,t.value)),this[ct]=new Map,this[ye]=new Ed,this[$t]=0}dump(){return this[ye].map(t=>zo(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[ye]}set(t,r,o){if(o=o||this[nr],o&&typeof o!="number")throw new TypeError("maxAge must be a number");let n=o?Date.now():0,i=this[_r](r,t);if(this[ct].has(t)){if(i>this[or])return Sr(this,this[ct].get(t)),!1;let a=this[ct].get(t).value;return this[vt]&&(this[gl]||this[vt](t,a.value)),a.now=n,a.maxAge=o,a.value=r,this[$t]+=i-a.length,a.length=i,this.get(t),jr(this),!0}let s=new Jn(t,r,i,n,o);return s.length>this[or]?(this[vt]&&this[vt](t,r),!1):(this[$t]+=s.length,this[ye].unshift(s),this[ct].set(t,this[ye].head),jr(this),!0)}has(t){if(!this[ct].has(t))return!1;let r=this[ct].get(t).value;return!zo(this,r)}get(t){return zn(this,t,!0)}peek(t){return zn(this,t,!1)}pop(){let t=this[ye].tail;return t?(Sr(this,t),t.value):null}del(t){Sr(this,this[ct].get(t))}load(t){this.reset();let r=Date.now();for(let o=t.length-1;o>=0;o--){let n=t[o],i=n.e||0;if(i===0)this.set(n.k,n.v);else{let s=i-r;s>0&&this.set(n.k,n.v,s)}}}prune(){this[ct].forEach((t,r)=>zn(this,r,!1))}},zn=(e,t,r)=>{let o=e[ct].get(t);if(o){let n=o.value;if(zo(e,n)){if(Sr(e,o),!e[Wr])return}else r&&(e[bl]&&(o.value.now=Date.now()),e[ye].unshiftNode(o));return n.value}},zo=(e,t)=>{if(!t||!t.maxAge&&!e[nr])return!1;let r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[nr]&&r>e[nr]},jr=e=>{if(e[$t]>e[or])for(let t=e[ye].tail;e[$t]>e[or]&&t!==null;){let r=t.prev;Sr(e,t),t=r}},Sr=(e,t)=>{if(t){let r=t.value;e[vt]&&e[vt](r.key,r.value),e[$t]-=r.length,e[ct].delete(r.key),e[ye].removeNode(t)}},Jn=class{constructor(t,r,o,n,i){this.key=t,this.value=r,this.length=o,this.now=n,this.maxAge=i||0}},yl=(e,t,r,o)=>{let n=r.value;zo(e,n)&&(Sr(e,r),e[Wr]||(n=void 0)),n&&t.call(o,n.value,n.key,e)};xl.exports=Xn});var et=_((I0,Tl)=>{var ir=class{constructor(t,r){if(r=$d(r),t instanceof ir)return t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease?t:new ir(t.raw,r);if(t instanceof Yn)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=t,this.set=t.split("||").map(o=>this.parseRange(o.trim())).filter(o=>o.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){let o=this.set[0];if(this.set=this.set.filter(n=>!Sl(n[0])),this.set.length===0)this.set=[o];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&Rd(n[0])){this.set=[n];break}}}this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();let o=`parseRange:${Object.keys(this.options).join(",")}:${t}`,n=_l.get(o);if(n)return n;let i=this.options.loose,s=i?qe[Oe.HYPHENRANGELOOSE]:qe[Oe.HYPHENRANGE];t=t.replace(s,qd(this.options.includePrerelease)),oe("hyphen replace",t),t=t.replace(qe[Oe.COMPARATORTRIM],Nd),oe("comparator trim",t),t=t.replace(qe[Oe.TILDETRIM],Id),t=t.replace(qe[Oe.CARETTRIM],Pd),t=t.split(/\s+/).join(" ");let l=t.split(" ").map(p=>Ad(p,this.options)).join(" ").split(/\s+/).map(p=>Gd(p,this.options));i&&(l=l.filter(p=>(oe("loose invalid filter",p,this.options),!!p.match(qe[Oe.COMPARATORLOOSE])))),oe("range list",l);let a=new Map,c=l.map(p=>new Yn(p,this.options));for(let p of c){if(Sl(p))return[p];a.set(p.value,p)}a.size>1&&a.has("")&&a.delete("");let u=[...a.values()];return _l.set(o,u),u}intersects(t,r){if(!(t instanceof ir))throw new TypeError("a Range is required");return this.set.some(o=>Cl(o,r)&&t.set.some(n=>Cl(n,r)&&o.every(i=>n.every(s=>i.intersects(s,r)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new kd(t,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(jd(this.set[r],t,this.options))return!0;return!1}};Tl.exports=ir;var vd=wl(),_l=new vd({max:1e3}),$d=Gr(),Yn=Kr(),oe=Fr(),kd=ke(),{re:qe,t:Oe,comparatorTrimReplace:Nd,tildeTrimReplace:Id,caretTrimReplace:Pd}=er(),Sl=e=>e.value==="<0.0.0-0",Rd=e=>e.value==="",Cl=(e,t)=>{let r=!0,o=e.slice(),n=o.pop();for(;r&&o.length;)r=o.every(i=>n.intersects(i,t)),n=o.pop();return r},Ad=(e,t)=>(oe("comp",e,t),e=Ld(e,t),oe("caret",e),e=Od(e,t),oe("tildes",e),e=Bd(e,t),oe("xrange",e),e=Fd(e,t),oe("stars",e),e),De=e=>!e||e.toLowerCase()==="x"||e==="*",Od=(e,t)=>e.trim().split(/\s+/).map(r=>Dd(r,t)).join(" "),Dd=(e,t)=>{let r=t.loose?qe[Oe.TILDELOOSE]:qe[Oe.TILDE];return e.replace(r,(o,n,i,s,l)=>{oe("tilde",e,o,n,i,s,l);let a;return De(n)?a="":De(i)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:De(s)?a=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:l?(oe("replaceTilde pr",l),a=`>=${n}.${i}.${s}-${l} <${n}.${+i+1}.0-0`):a=`>=${n}.${i}.${s} <${n}.${+i+1}.0-0`,oe("tilde return",a),a})},Ld=(e,t)=>e.trim().split(/\s+/).map(r=>Md(r,t)).join(" "),Md=(e,t)=>{oe("caret",e,t);let r=t.loose?qe[Oe.CARETLOOSE]:qe[Oe.CARET],o=t.includePrerelease?"-0":"";return e.replace(r,(n,i,s,l,a)=>{oe("caret",e,n,i,s,l,a);let c;return De(i)?c="":De(s)?c=`>=${i}.0.0${o} <${+i+1}.0.0-0`:De(l)?i==="0"?c=`>=${i}.${s}.0${o} <${i}.${+s+1}.0-0`:c=`>=${i}.${s}.0${o} <${+i+1}.0.0-0`:a?(oe("replaceCaret pr",a),i==="0"?s==="0"?c=`>=${i}.${s}.${l}-${a} <${i}.${s}.${+l+1}-0`:c=`>=${i}.${s}.${l}-${a} <${i}.${+s+1}.0-0`:c=`>=${i}.${s}.${l}-${a} <${+i+1}.0.0-0`):(oe("no pr"),i==="0"?s==="0"?c=`>=${i}.${s}.${l}${o} <${i}.${s}.${+l+1}-0`:c=`>=${i}.${s}.${l}${o} <${i}.${+s+1}.0-0`:c=`>=${i}.${s}.${l} <${+i+1}.0.0-0`),oe("caret return",c),c})},Bd=(e,t)=>(oe("replaceXRanges",e,t),e.split(/\s+/).map(r=>Ud(r,t)).join(" ")),Ud=(e,t)=>{e=e.trim();let r=t.loose?qe[Oe.XRANGELOOSE]:qe[Oe.XRANGE];return e.replace(r,(o,n,i,s,l,a)=>{oe("xRange",e,o,n,i,s,l,a);let c=De(i),u=c||De(s),p=u||De(l),f=p;return n==="="&&f&&(n=""),a=t.includePrerelease?"-0":"",c?n===">"||n==="<"?o="<0.0.0-0":o="*":n&&f?(u&&(s=0),l=0,n===">"?(n=">=",u?(i=+i+1,s=0,l=0):(s=+s+1,l=0)):n==="<="&&(n="<",u?i=+i+1:s=+s+1),n==="<"&&(a="-0"),o=`${n+i}.${s}.${l}${a}`):u?o=`>=${i}.0.0${a} <${+i+1}.0.0-0`:p&&(o=`>=${i}.${s}.0${a} <${i}.${+s+1}.0-0`),oe("xRange return",o),o})},Fd=(e,t)=>(oe("replaceStars",e,t),e.trim().replace(qe[Oe.STAR],"")),Gd=(e,t)=>(oe("replaceGTE0",e,t),e.trim().replace(qe[t.includePrerelease?Oe.GTE0PRE:Oe.GTE0],"")),qd=e=>(t,r,o,n,i,s,l,a,c,u,p,f,h)=>(De(o)?r="":De(n)?r=`>=${o}.0.0${e?"-0":""}`:De(i)?r=`>=${o}.${n}.0${e?"-0":""}`:s?r=`>=${r}`:r=`>=${r}${e?"-0":""}`,De(c)?a="":De(u)?a=`<${+c+1}.0.0-0`:De(p)?a=`<${c}.${+u+1}.0-0`:f?a=`<=${c}.${u}.${p}-${f}`:e?a=`<${c}.${u}.${+p+1}-0`:a=`<=${a}`,`${r} ${a}`.trim()),jd=(e,t,r)=>{for(let o=0;o<e.length;o++)if(!e[o].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let o=0;o<e.length;o++)if(oe(e[o].semver),e[o].semver!==Yn.ANY&&e[o].semver.prerelease.length>0){let n=e[o].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}});var Kr=_((P0,Nl)=>{var Vr=Symbol("SemVer ANY"),Cr=class{static get ANY(){return Vr}constructor(t,r){if(r=Wd(r),t instanceof Cr){if(t.loose===!!r.loose)return t;t=t.value}Qn("comparator",t,r),this.options=r,this.loose=!!r.loose,this.parse(t),this.semver===Vr?this.value="":this.value=this.operator+this.semver.version,Qn("comp",this)}parse(t){let r=this.options.loose?El[vl.COMPARATORLOOSE]:El[vl.COMPARATOR],o=t.match(r);if(!o)throw new TypeError(`Invalid comparator: ${t}`);this.operator=o[1]!==void 0?o[1]:"",this.operator==="="&&(this.operator=""),o[2]?this.semver=new $l(o[2],this.options.loose):this.semver=Vr}toString(){return this.value}test(t){if(Qn("Comparator.test",t,this.options.loose),this.semver===Vr||t===Vr)return!0;if(typeof t=="string")try{t=new $l(t,this.options)}catch{return!1}return Zn(t,this.operator,this.semver,this.options)}intersects(t,r){if(!(t instanceof Cr))throw new TypeError("a Comparator is required");if((!r||typeof r!="object")&&(r={loose:!!r,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new kl(t.value,r).test(this.value);if(t.operator==="")return t.value===""?!0:new kl(this.value,r).test(t.semver);let o=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),n=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),i=this.semver.version===t.semver.version,s=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),l=Zn(this.semver,"<",t.semver,r)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),a=Zn(this.semver,">",t.semver,r)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return o||n||i&&s||l||a}};Nl.exports=Cr;var Wd=Gr(),{re:El,t:vl}=er(),Zn=Vn(),Qn=Fr(),$l=ke(),kl=et()});var Hr=_((R0,Il)=>{var Kd=et(),Vd=(e,t,r)=>{try{t=new Kd(t,r)}catch{return!1}return t.test(e)};Il.exports=Vd});var Rl=_((A0,Pl)=>{var Hd=et(),zd=(e,t)=>new Hd(e,t).set.map(r=>r.map(o=>o.value).join(" ").trim().split(" "));Pl.exports=zd});var Ol=_((O0,Al)=>{var Xd=ke(),Jd=et(),Yd=(e,t,r)=>{let o=null,n=null,i=null;try{i=new Jd(t,r)}catch{return null}return e.forEach(s=>{i.test(s)&&(!o||n.compare(s)===-1)&&(o=s,n=new Xd(o,r))}),o};Al.exports=Yd});var Ll=_((D0,Dl)=>{var Zd=ke(),Qd=et(),em=(e,t,r)=>{let o=null,n=null,i=null;try{i=new Qd(t,r)}catch{return null}return e.forEach(s=>{i.test(s)&&(!o||n.compare(s)===1)&&(o=s,n=new Zd(o,r))}),o};Dl.exports=em});var Ul=_((L0,Bl)=>{var ei=ke(),tm=et(),Ml=qr(),rm=(e,t)=>{e=new tm(e,t);let r=new ei("0.0.0");if(e.test(r)||(r=new ei("0.0.0-0"),e.test(r)))return r;r=null;for(let o=0;o<e.set.length;++o){let n=e.set[o],i=null;n.forEach(s=>{let l=new ei(s.semver.version);switch(s.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!i||Ml(l,i))&&(i=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),i&&(!r||Ml(r,i))&&(r=i)}return r&&e.test(r)?r:null};Bl.exports=rm});var Gl=_((M0,Fl)=>{var om=et(),nm=(e,t)=>{try{return new om(e,t).range||"*"}catch{return null}};Fl.exports=nm});var Xo=_((B0,Kl)=>{var im=ke(),Wl=Kr(),{ANY:sm}=Wl,lm=et(),am=Hr(),ql=qr(),jl=jo(),cm=Ko(),um=Wo(),pm=(e,t,r,o)=>{e=new im(e,o),t=new lm(t,o);let n,i,s,l,a;switch(r){case">":n=ql,i=cm,s=jl,l=">",a=">=";break;case"<":n=jl,i=um,s=ql,l="<",a="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(am(e,t,o))return!1;for(let c=0;c<t.set.length;++c){let u=t.set[c],p=null,f=null;if(u.forEach(h=>{h.semver===sm&&(h=new Wl(">=0.0.0")),p=p||h,f=f||h,n(h.semver,p.semver,o)?p=h:s(h.semver,f.semver,o)&&(f=h)}),p.operator===l||p.operator===a||(!f.operator||f.operator===l)&&i(e,f.semver))return!1;if(f.operator===a&&s(e,f.semver))return!1}return!0};Kl.exports=pm});var Hl=_((U0,Vl)=>{var fm=Xo(),hm=(e,t,r)=>fm(e,t,">",r);Vl.exports=hm});var Xl=_((F0,zl)=>{var dm=Xo(),mm=(e,t,r)=>dm(e,t,"<",r);zl.exports=mm});var Zl=_((G0,Yl)=>{var Jl=et(),gm=(e,t,r)=>(e=new Jl(e,r),t=new Jl(t,r),e.intersects(t));Yl.exports=gm});var ea=_((q0,Ql)=>{var ym=Hr(),bm=Qe();Ql.exports=(e,t,r)=>{let o=[],n=null,i=null,s=e.sort((u,p)=>bm(u,p,r));for(let u of s)ym(u,t,r)?(i=u,n||(n=u)):(i&&o.push([n,i]),i=null,n=null);n&&o.push([n,null]);let l=[];for(let[u,p]of o)u===p?l.push(u):!p&&u===s[0]?l.push("*"):p?u===s[0]?l.push(`<=${p}`):l.push(`${u} - ${p}`):l.push(`>=${u}`);let a=l.join(" || "),c=typeof t.raw=="string"?t.raw:String(t);return a.length<c.length?a:t}});var ia=_((j0,na)=>{var ta=et(),Jo=Kr(),{ANY:ti}=Jo,zr=Hr(),ri=Qe(),xm=(e,t,r={})=>{if(e===t)return!0;e=new ta(e,r),t=new ta(t,r);let o=!1;e:for(let n of e.set){for(let i of t.set){let s=wm(n,i,r);if(o=o||s!==null,s)continue e}if(o)return!1}return!0},wm=(e,t,r)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===ti){if(t.length===1&&t[0].semver===ti)return!0;r.includePrerelease?e=[new Jo(">=0.0.0-0")]:e=[new Jo(">=0.0.0")]}if(t.length===1&&t[0].semver===ti){if(r.includePrerelease)return!0;t=[new Jo(">=0.0.0")]}let o=new Set,n,i;for(let h of e)h.operator===">"||h.operator===">="?n=ra(n,h,r):h.operator==="<"||h.operator==="<="?i=oa(i,h,r):o.add(h.semver);if(o.size>1)return null;let s;if(n&&i){if(s=ri(n.semver,i.semver,r),s>0)return null;if(s===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let h of o){if(n&&!zr(h,String(n),r)||i&&!zr(h,String(i),r))return null;for(let d of t)if(!zr(h,String(d),r))return!1;return!0}let l,a,c,u,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,f=n&&!r.includePrerelease&&n.semver.prerelease.length?n.semver:!1;p&&p.prerelease.length===1&&i.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let h of t){if(u=u||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",n){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator===">"||h.operator===">="){if(l=ra(n,h,r),l===h&&l!==n)return!1}else if(n.operator===">="&&!zr(n.semver,String(h),r))return!1}if(i){if(p&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===p.major&&h.semver.minor===p.minor&&h.semver.patch===p.patch&&(p=!1),h.operator==="<"||h.operator==="<="){if(a=oa(i,h,r),a===h&&a!==i)return!1}else if(i.operator==="<="&&!zr(i.semver,String(h),r))return!1}if(!h.operator&&(i||n)&&s!==0)return!1}return!(n&&c&&!i&&s!==0||i&&u&&!n&&s!==0||f||p)},ra=(e,t,r)=>{if(!e)return t;let o=ri(e.semver,t.semver,r);return o>0?e:o<0||t.operator===">"&&e.operator===">="?t:e},oa=(e,t,r)=>{if(!e)return t;let o=ri(e.semver,t.semver,r);return o<0?e:o>0||t.operator==="<"&&e.operator==="<="?t:e};na.exports=xm});var aa=_((W0,la)=>{var oi=er(),_m=Ur(),Sm=ke(),sa=Wn(),Cm=tr(),Tm=ks(),Em=Is(),vm=As(),$m=Us(),km=Gs(),Nm=js(),Im=Ks(),Pm=Hs(),Rm=Qe(),Am=Xs(),Om=Ys(),Dm=qo(),Lm=tl(),Mm=ol(),Bm=qr(),Um=jo(),Fm=Go(),Gm=Kn(),qm=Wo(),jm=Ko(),Wm=Vn(),Km=pl(),Vm=Kr(),Hm=et(),zm=Hr(),Xm=Rl(),Jm=Ol(),Ym=Ll(),Zm=Ul(),Qm=Gl(),eg=Xo(),tg=Hl(),rg=Xl(),og=Zl(),ng=ea(),ig=ia();la.exports={parse:Cm,valid:Tm,clean:Em,inc:vm,diff:$m,major:km,minor:Nm,patch:Im,prerelease:Pm,compare:Rm,rcompare:Am,compareLoose:Om,compareBuild:Dm,sort:Lm,rsort:Mm,gt:Bm,lt:Um,eq:Fm,neq:Gm,gte:qm,lte:jm,cmp:Wm,coerce:Km,Comparator:Vm,Range:Hm,satisfies:zm,toComparators:Xm,maxSatisfying:Jm,minSatisfying:Ym,minVersion:Zm,validRange:Qm,outside:eg,gtr:tg,ltr:rg,intersects:og,simplifyRange:ng,subset:ig,SemVer:Sm,re:oi.re,src:oi.src,tokens:oi.t,SEMVER_SPEC_VERSION:_m.SEMVER_SPEC_VERSION,compareIdentifiers:sa.compareIdentifiers,rcompareIdentifiers:sa.rcompareIdentifiers}});var T=_((K0,ec)=>{"use strict";var si=Object.defineProperty,sg=Object.getOwnPropertyDescriptor,lg=Object.getOwnPropertyNames,ag=Object.prototype.hasOwnProperty,cg=(e,t)=>{for(var r in t)si(e,r,{get:t[r],enumerable:!0})},ug=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of lg(t))!ag.call(e,n)&&n!==r&&si(e,n,{get:()=>t[n],enumerable:!(o=sg(t,n))||o.enumerable});return e},pg=e=>ug(si({},"__esModule",{value:!0}),e),pa={};cg(pa,{CGRectString2CGRect:()=>za,CGRectValue2CGRect:()=>Ag,CGSizeString2CGSize:()=>Xa,CGSizeValue2CGSize:()=>Rg,DirectionOfSelection:()=>$a,DocMapSplitMode:()=>Ea,GroupMode:()=>Ca,HUDController:()=>_g,MN:()=>I,NSDataReadingOptions:()=>ha,NSDataSearchOptions:()=>ma,NSDataWritingOptions:()=>da,NSJSONReadingOptions:()=>ya,NSJSONWritingOptions:()=>ga,NSLineBreakMode:()=>Ia,NSLocaleLanguageDirection:()=>ba,NSNull2Null:()=>kg,NSStringEncoding:()=>fa,NSTextAlignment:()=>Ga,NSURLBookmarkCreationOptions:()=>_a,NSURLBookmarkFileCreationOptions:()=>wa,NSURLBookmarkResolutionOptions:()=>xa,NSValue2String:()=>ai,NodeNote:()=>Xr,NotebookType:()=>va,OSType:()=>Sa,RefreshAfterDBChange:()=>Ya,StudyMode:()=>Ta,UIAlertViewStyle:()=>ka,UIButtonType:()=>Na,UIControlEvents:()=>Ra,UIControlState:()=>Pa,UIGestureRecognizerState:()=>Wa,UIImageOrientation:()=>Aa,UISwipeGestureRecognizerDirection:()=>Ka,UITableViewCellAccessoryTypeStyle:()=>Ua,UITableViewCellSelectionStyle:()=>Ba,UITableViewCellSeparatorStyle:()=>Da,UITableViewCellStyle:()=>Fa,UITableViewRowAnimation:()=>Ma,UITableViewScrollPosition:()=>La,UITableViewStyle:()=>Oa,UITextBorderStyle:()=>qa,UIViewAutoresizing:()=>ja,alert:()=>Tg,confirm:()=>Bg,copy:()=>Ng,copyFile:()=>zg,defineEventHandlers:()=>gg,defineGestureHandlers:()=>yg,defineLifecycleHandler:()=>dg,delay:()=>li,delayBreak:()=>Ig,dev:()=>hg,evaluateJavaScript:()=>vg,eventHandlerController:()=>mg,exportPic:()=>Qo,fetch:()=>Lg,genURL:()=>Zo,gestureHandlerController:()=>Zg,getDocURL:()=>Kg,getLocalDataByKey:()=>Sg,getObjCClassDeclar:()=>Eg,i18n:()=>bg,initGesture:()=>Qg,isNSNull:()=>Ha,isNoteExist:()=>qg,isNoteLink:()=>Gg,isfileExists:()=>Vg,openFile:()=>Yg,openUrl:()=>$g,popup:()=>en,postNotification:()=>Va,readJSON:()=>Hg,removeHighlight:()=>Wg,saveFile:()=>Qa,saveTextFile:()=>Jg,select:()=>Ug,selectIndex:()=>Fg,setLocalDataByKey:()=>Cg,setTimeInterval:()=>Pg,showHUD:()=>Yo,undoGrouping:()=>Ja,undoGroupingWithRefresh:()=>jg,writeJSON:()=>Xg,writeTextFile:()=>Za});ec.exports=pg(pa);var fa=(e=>(e[e.ASCIIStringEncoding=1]="ASCIIStringEncoding",e[e.ISO2022JP=21]="ISO2022JP",e[e.ISOLatin1=5]="ISOLatin1",e[e.ISOLatin2=9]="ISOLatin2",e[e.JapaneseEUC=3]="JapaneseEUC",e[e.MacOSRoman=30]="MacOSRoman",e[e.NEXTSTEP=2]="NEXTSTEP",e[e.NonLossyASCII=7]="NonLossyASCII",e[e.ShiftJIS=8]="ShiftJIS",e[e.Symbol=6]="Symbol",e[e.Unicode=10]="Unicode",e[e.UTF16BigEndian=2415919360]="UTF16BigEndian",e[e.UTF16LittleEndian=2483028224]="UTF16LittleEndian",e[e.UTF32=2348810496]="UTF32",e[e.UTF32BigEndian=2550137088]="UTF32BigEndian",e[e.UTF32LittleEndian=2617245952]="UTF32LittleEndian",e[e.UTF8=4]="UTF8",e[e.WindowsCP1250=15]="WindowsCP1250",e[e.WindowsCP1251=11]="WindowsCP1251",e[e.WindowsCP1252=12]="WindowsCP1252",e[e.WindowsCP1253=13]="WindowsCP1253",e[e.WindowsCP1254=14]="WindowsCP1254",e))(fa||{}),ha=(e=>(e[e.Coordinated=4]="Coordinated",e[e.Mapped=1]="Mapped",e[e.MappedAlways=8]="MappedAlways",e[e.Uncached=2]="Uncached",e))(ha||{}),da=(e=>(e[e.Atomic=1]="Atomic",e[e.FileProtectionComplete=536870912]="FileProtectionComplete",e[e.FileProtectionCompleteUnlessOpen=805306368]="FileProtectionCompleteUnlessOpen",e[e.FileProtectionCompleteUntilFirstUserAuthentication=1073741824]="FileProtectionCompleteUntilFirstUserAuthentication",e[e.FileProtectionMask=4026531840]="FileProtectionMask",e[e.FileProtectionNone=268435456]="FileProtectionNone",e[e.WithoutOverwriting=2]="WithoutOverwriting",e))(da||{}),ma=(e=>(e[e.SearchAnchored=2]="SearchAnchored",e[e.SearchBackwards=1]="SearchBackwards",e))(ma||{}),ga=(e=>(e[e.PrettyPrinted=0]="PrettyPrinted",e[e.SortedKeys=1]="SortedKeys",e[e.FragmentsAllowed=2]="FragmentsAllowed",e[e.WithoutEscapingSlashes=3]="WithoutEscapingSlashes",e))(ga||{}),ya=(e=>(e[e.MutableContainers=1]="MutableContainers",e[e.MutableLeaves=2]="MutableLeaves",e[e.FragmentsAllowed=4]="FragmentsAllowed",e[e.JSON5Allowed=8]="JSON5Allowed",e[e.TopLevelDictionaryAssumed=16]="TopLevelDictionaryAssumed",e))(ya||{}),ba=(e=>(e[e.BottomToTop=4]="BottomToTop",e[e.LeftToRight=1]="LeftToRight",e[e.RightToLeft=2]="RightToLeft",e[e.TopToBottom=3]="TopToBottom",e[e.Unknown=0]="Unknown",e))(ba||{}),xa=(e=>(e[e.WithoutMounting=512]="WithoutMounting",e[e.WithoutUI=256]="WithoutUI",e[e.WithSecurityScope=1024]="WithSecurityScope",e))(xa||{}),wa=(e=>(e[e.MinimalBookmark=512]="MinimalBookmark",e[e.PreferFileIDResolution=256]="PreferFileIDResolution",e[e.SecurityScopeAllowOnlyReadAccess=4096]="SecurityScopeAllowOnlyReadAccess",e[e.SuitableForBookmarkFile=1024]="SuitableForBookmarkFile",e[e.WithSecurityScope=2048]="WithSecurityScope",e))(wa||{}),_a=(e=>(e[e.MinimalBookmark=512]="MinimalBookmark",e[e.PreferFileIDResolution=256]="PreferFileIDResolution",e[e.SecurityScopeAllowOnlyReadAccess=4096]="SecurityScopeAllowOnlyReadAccess",e[e.SuitableForBookmarkFile=1024]="SuitableForBookmarkFile",e[e.WithSecurityScope=2048]="WithSecurityScope",e))(_a||{}),Sa=(e=>(e[e.iPadOS=0]="iPadOS",e[e.iPhoneOS=1]="iPhoneOS",e[e.macOS=2]="macOS",e))(Sa||{}),Ca=(e=>(e[e.Tree=0]="Tree",e[e.Frame=1]="Frame",e))(Ca||{}),Ta=(e=>(e[e.doc0=0]="doc0",e[e.doc1=1]="doc1",e[e.study=2]="study",e[e.review=3]="review",e))(Ta||{}),Ea=(e=>(e[e.allMap=0]="allMap",e[e.half=1]="half",e[e.allDoc=2]="allDoc",e))(Ea||{}),va=(e=>(e[e.Hiden=0]="Hiden",e[e.Doc=1]="Doc",e[e.MindMap=2]="MindMap",e[e.FlashCard=3]="FlashCard",e))(va||{}),$a=(e=>(e[e.toRight=1]="toRight",e[e.toLeft=2]="toLeft",e))($a||{}),ka=(e=>(e[e.Default=0]="Default",e[e.SecureTextInput=1]="SecureTextInput",e[e.PlainTextInput=2]="PlainTextInput",e[e.LoginAndPasswordInput=3]="LoginAndPasswordInput",e))(ka||{}),Na=(e=>(e[e.system=0]="system",e))(Na||{}),Ia=(e=>{})(Ia||{}),Pa=(e=>{})(Pa||{}),Ra=(e=>{})(Ra||{}),Aa=(e=>(e[e.Down=1]="Down",e[e.DownMirrored=5]="DownMirrored",e[e.Left=2]="Left",e[e.LeftMirrored=6]="LeftMirrored",e[e.Right=3]="Right",e[e.RightMirrored=7]="RightMirrored",e[e.Up=0]="Up",e[e.UpMirrored=4]="UpMirrored",e))(Aa||{}),Oa=(e=>{})(Oa||{}),Da=(e=>{})(Da||{}),La=(e=>(e[e.Bottom=3]="Bottom",e[e.Middle=2]="Middle",e[e.None=0]="None",e[e.Top=1]="Top",e))(La||{}),Ma=(e=>(e[e.Fade=0]="Fade",e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.Top=3]="Top",e[e.Bottom=4]="Bottom",e[e.None=5]="None",e[e.Middle=6]="Middle",e[e.Automatic=7]="Automatic",e))(Ma||{}),Ba=(e=>{})(Ba||{}),Ua=(e=>{})(Ua||{}),Fa=(e=>(e[e.Default=0]="Default",e[e.Value1=1]="Value1",e[e.Value2=2]="Value2",e[e.Subtitle=3]="Subtitle",e))(Fa||{}),Ga=(e=>(e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right",e[e.Justified=3]="Justified",e[e.Natural=4]="Natural",e))(Ga||{}),qa=(e=>{})(qa||{}),ja=(e=>{})(ja||{}),Wa=(e=>{})(Wa||{}),Ka=(e=>(e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.Up=4]="Up",e[e.Down=8]="Down",e))(Ka||{}),ca=aa(),ua,fg=class{constructor(){var e;this.app=Application.sharedInstance(),this.isZH=(ua=NSLocale.preferredLanguages())==null?void 0:ua[0].startsWith("zh"),this.db=Database.sharedInstance(),this.version=(e=this.app.appVersion)!=null?e:"3.7.21",this.isMNE=(0,ca.gte)(this.version,"4.0.0"),this.isMac=this.app.osType==2,this.isMacMNE=this.isMac&&(0,ca.gte)(this.version,"4.0.2"),this.isMacMN3=this.isMac&&!this.isMacMNE,this.themeColor={Gray:UIColor.colorWithHexString("#414141"),Default:UIColor.colorWithHexString("#FFFFFF"),Dark:UIColor.colorWithHexString("#000000"),Green:UIColor.colorWithHexString("#E9FBC7"),Sepia:UIColor.colorWithHexString("#F5EFDC")}}get studyController(){return this.app.studyController(this.app.focusWindow)}get notebookController(){return this.studyController.notebookController}get currentDocumentController(){return this.studyController.readerController.currentDocumentController}get currentWindow(){return this.app.focusWindow}get currentThemeColor(){return this.themeColor[this.app.currentTheme]}get currentAddon(){var r,o;var e,t;return{key:(r=(e=self.addon)==null?void 0:e.key)!=null?r:"mnaddon",title:(o=(t=self.addon)==null?void 0:t.title)!=null?o:"MarginNote"}}get currnetNotebookid(){try{return this.notebookController.notebookId}catch{return}}get currentDocmd5(){try{let{docMd5:e}=this.currentDocumentController;return e&&e.length===32?"00000000":e}catch{return}}},I=new fg,hg={log(e,t="normal",...r){self.useConsole?console.log(e,`${I.currentAddon.key}-${t}`,...r):JSB.log(`${I.currentAddon.key}-${t} %@`,e)},error(e,t="error",...r){self.useConsole?console.error(e,`${I.currentAddon.key}-${t}`,...r):JSB.log(`${I.currentAddon.key}-${t} %@`,String(e)==="[object Object]"?JSON.stringify(e,void 0,2):String(e))},assert(e,t="normal",...r){self.useConsole?console.log(e,`${I.currentAddon.key}-${t}`,...r):JSB.log(`${I.currentAddon.key}-${t} %@`,JSON.stringify(e,void 0,2))}};function dg(e){return e}function mg(e){return{add:()=>{e.forEach(o=>{var i;o=typeof o=="string"?{event:o}:o;let n=(i=o.handler)!=null?i:`on${o.event}`;NSNotificationCenter.defaultCenter().addObserverSelectorName(self,`${n}:`,o.event)})},remove:()=>{e.forEach(o=>{NSNotificationCenter.defaultCenter().removeObserverName(self,typeof o=="string"?o:o.event)})}}}function gg(e){return e}function yg(e){return e}function bg(e){return I.isZH?e.zh:e.en}var xg={copy_success:"\u590D\u5236\u6210\u529F, \u5FEB\u53BB\u7C98\u8D34\u5427!",copy_empty:"\u8981\u590D\u5236\u7684\u5185\u5BB9\u4E3A\u7A7A",sure:"\u786E\u5B9A",cancel:"\u{1F645} \u53D6\u6D88",not_JSON:"\u8FD4\u56DE\u503C\u4E0D\u662F\u6709\u6548\u7684 JSON \u683C\u5F0F",not_receive:"\u6CA1\u6709\u6536\u5230\u8FD4\u56DE\u503C\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC",make_your_choice:"\u505A\u51FA\u4F60\u7684\u9009\u62E9"},wg={copy_success:"Copy successfully, go ahead and paste",copy_empty:"The content to be copied is empty",sure:"Confirm",cancel:"\u{1F645}\u200D\u2640\uFE0F Cancel",not_JSON:"The returned value is not a valid JSON format",not_receive:"No return value received, please check the network",make_your_choice:"Make your choice"},jt=I.isZH?xg:wg;function Yo(e,t=2,r=I.currentWindow){I.app.showHUD(e,r,t)}var _g={show(e,t=I.currentWindow){I.app.waitHUDOnView(e,t)},hidden(e,t=2,r=I.currentWindow){I.app.stopWaitHUDOnView(r),e&&Yo(e,t,r)}};function Sg(e){return NSUserDefaults.standardUserDefaults().objectForKey(e)}function Cg(e,t){NSUserDefaults.standardUserDefaults().setObjectForKey(e,t)}function Tg(e){I.app.alert(e)}function Eg(e,t){return`${e} : ${t}`}function vg(e,t){return new Promise(r=>e.evaluateJavaScript(t,r))}function Zo(e,t=!1){return e=e.trim(),/^[\w\-]+:\/\//.test(e)||(e=`https://${e}`),NSURL.URLWithString(t?encodeURI(e):e)}function $g(e,t=!1){I.app.openURL(Zo(e,t))}function Va(e,t){NSNotificationCenter.defaultCenter().postNotificationNameObjectUserInfo(e,self,t)}function Ha(e){return e===NSNull.new()}function kg(e){return Ha(e)?null:e}function Ng(e,t=!0){e?(UIPasteboard.generalPasteboard().string=e.trim(),t&&Yo(jt.copy_success)):t&&Yo(jt.copy_empty)}function li(e){return new Promise(t=>NSTimer.scheduledTimerWithTimeInterval(e,!1,t))}async function Ig(e,t,r){for(let o=0;o<e;o++){if(r())return!0;await li(t)}return!1}async function Pg(e,t){let r=async(n,i,s)=>{for(;!s.stop;)i(),await li(n)},o={stop:!1};return r(e,t,o),{invalidate:()=>{o.stop=!0}}}function ai(e){return Database.transArrayToJSCompatible([e])[0]}function za(e){let t=e.match(/\d+/g).map(r=>Number(r));return{x:t[0],y:t[1],height:t[2],width:t[3]}}function Xa(e){let t=e.match(/\d+/g).map(r=>Number(r));return{width:t[0],height:t[1]}}function Rg(e){return Xa(ai(e))}function Ag(e){return za(ai(e))}var Og=class{constructor(e){this.data=e}json(){if(this.data.length()===0)return{};let e=NSJSONSerialization.JSONObjectWithDataOptions(this.data,1);if(NSJSONSerialization.isValidJSONObject(e))return e;throw jt.not_JSON}text(){return this.data.length()===0,""}};function Dg(e,t){var n,i;let r=NSMutableURLRequest.requestWithURL(Zo(e));r.setHTTPMethod((n=t.method)!=null?n:"GET"),r.setTimeoutInterval((i=t.timeout)!=null?i:3);let o={"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15","Content-Type":"application/json",Accept:"application/json"};return r.setAllHTTPHeaderFields(t.headers?Object.assign(o,t.headers):o),t.search?r.setURL(Zo(`${e.trim()}?${Object.entries(t.search).reduce((s,l)=>{let[a,c]=l;return`${s?s+"&":""}${a}=${encodeURIComponent(c)}`},"")}`)):t.form?r.setHTTPBody(NSData.dataWithStringEncoding(Object.entries(t.form).reduce((s,l)=>{let[a,c]=l;return`${s?s+"&":""}${a}=${encodeURIComponent(c)}`},""),4)):t.json&&r.setHTTPBody(NSJSONSerialization.dataWithJSONObjectOptions(t.json,1)),r}function Lg(e,t={}){return new Promise((r,o)=>{let n=NSOperationQueue.mainQueue(),i=Dg(e,t);NSURLConnection.sendAsynchronousRequestQueueCompletionHandler(i,n,(s,l,a)=>{a.localizedDescription&&o(a.localizedDescription),r(new Og(l))})})}function Mg(e){return Array.from(e).reduce((t,r)=>(t+=r.charCodeAt(0)>255?2:1,t),0)}function ni(e,t,...r){let o=[t,...r].map(n=>(n<0&&(n=Mg(e)+n),n===0||n===1?n:Array.from(e).reduce((i,s,l)=>{let a=i.byte+(s.charCodeAt(0)>255?2:1);return!i.enough&&a<=n?i={index:l,byte:a,enough:!1}:i={...i,enough:!0},i},{index:0,byte:0,enough:!1}).index+1));return e.slice(...o)}var sr=(e,t=!1)=>{let r=[];return e.length<=1?r=e:r=Array.from(new Set(e)),t&&(r=r.filter(o=>o)),r};function en({title:e=I.currentAddon.title,message:t,type:r=0,buttons:o=[jt.sure],canCancel:n=!0,multiLine:i=!1},s){return new Promise(l=>n?UIAlertView.showWithTitleMessageStyleCancelButtonTitleOtherButtonTitlesTapBlock(e,t,r,jt.cancel,i?o.map(a=>ni(a.replace(/\n/g,""),0,40)):o,(a,c)=>{l(s({alert:a,buttonIndex:c-1}))}):UIAlertView.showWithTitleMessageStyleCancelButtonTitleOtherButtonTitlesTapBlock(e,t,r,i?ni(o[0].replace(/\n/g,""),0,40):o[0],i?o.slice(1).map(a=>ni(a.replace(/\n/g,""),0,40)):o.slice(1),(a,c)=>{l(s({alert:a,buttonIndex:c}))}))}async function Bg(e=I.currentAddon.title,t=""){let{option:r}=await en({title:e,message:t,buttons:[jt.sure],multiLine:!1,canCancel:!0},({buttonIndex:o})=>({option:o}));return r===0}async function Ug(e,t=I.currentAddon.title,r=jt.make_your_choice,o=!1){let{option:n}=await en({title:t,message:r,buttons:e,multiLine:!0,canCancel:o},({buttonIndex:i})=>({option:i}));return e[n]}async function Fg(e,t=I.currentAddon.title,r=jt.make_your_choice,o=!1){let{option:n}=await en({title:t,message:r,buttons:e,multiLine:!0,canCancel:o},({buttonIndex:i})=>({option:i}));return n}function Gg(e){return e.startsWith("marginnote3app://note/")}function qg(e){return typeof e=="string"?!!I.db.getNoteById(e):!!I.db.getNoteById(e.noteId)}function Ja(e){I.currnetNotebookid&&UndoManager.sharedInstance().undoGrouping(String(Date.now()),I.currnetNotebookid,e)}function jg(e){Ja(e),Ya()}function Ya(){I.currnetNotebookid&&(I.db.setNotebookSyncDirty(I.currnetNotebookid),Va("RefreshAfterDBChange",{topicid:I.currnetNotebookid}))}function Wg(e){return e&&e.replace(/\*\*/g,"")}function Kg(){var e;if(I.studyController.studyMode!==2||!I.currentDocmd5||I.currentDocmd5==="00000000"||!I.currnetNotebookid)return;let r=(e=I.db.getNotebookById(I.currnetNotebookid).notes)==null?void 0:e.find(o=>o.docMd5===I.currentDocmd5&&o.modifiedDate);return r!=null&&r.noteId?`marginnote3app://note/${r.noteId}`:`marginnote3app://notebook/${I.currnetNotebookid}`}function Vg(e){return NSFileManager.defaultManager().fileExistsAtPath(e)}function Za(e,t){NSData.dataWithStringEncoding(t,4).writeToFileAtomically(e,!1)}function Hg(e){let t=NSJSONSerialization.JSONObjectWithDataOptions(NSData.dataWithContentsOfFile(e),1);if(NSJSONSerialization.isValidJSONObject(t))return t;throw"Invalid JSON"}function zg(e,t){return NSFileManager.defaultManager().copyItemAtPathToPath(e,t)}function Xg(e,t){NSData.dataWithStringEncoding(JSON.stringify(t,void 0,2),4).writeToFileAtomically(e,!1)}function Qa(e,t){I.app.saveFileWithUti(e,t)}function Jg(e,t,r){let o=`${I.app.tempPath}/${t}`;Za(o,e),Qa(o,r)}async function Yg(...e){return new Promise(t=>{I.app.openFileWithUTIs(e,I.studyController,r=>{t(r)}),t(void 0)})}function Zg(e){return{add:()=>{e.forEach(o=>{o.view.addGestureRecognizer(o.gesture)})},remove:()=>{e.forEach(o=>{o.view.removeGestureRecognizer(o.gesture)})}}}var Qg={swipe(e,t,r){let o=new UISwipeGestureRecognizer(self,`on${r}:`);return o.numberOfTouchesRequired=e,o.direction=t,o},tap(e,t,r){let o=new UITapGestureRecognizer(self,`on${r}:`);return o.numberOfTapsRequired=t,o.numberOfTouchesRequired=e,o}};function Qo(e){var t;let r=(t=I.db.getMediaByHash(e.paint))==null?void 0:t.base64Encoding();return r?{html:`<img class="MNPic" src="data:image/jpeg;base64,${r}"/>`,md:`![MNPic](data:image/jpeg;base64,${r})`}:void 0}function ii(e){var t;let r={ocr:[],html:[],md:[]},o=(t=e.excerptText)==null?void 0:t.trim();if(e.excerptPic){let n=Qo(e.excerptPic);n&&Object.entries(n).forEach(([i,s])=>{i in r&&r[i].push(s)}),o&&r.ocr.push(o)}else o&&Object.values(r).forEach(n=>n.push(o));return r}var Xr=class{constructor(e){this.note=e.groupNoteId?I.db.getNoteById(e.groupNoteId):e}static getSelectedNodes(){let e=I.notebookController.mindmapView.selViewLst;return e!=null&&e.length?e.map(t=>new Xr(t.note.note)):[]}get nodeid(){return this.note.noteId}get descendantNodes(){let{childNodes:e}=this;if(e.length){let r=function(o,n=0,i=[],s={descendant:[],treeIndex:[]}){return n++,o.forEach((l,a)=>{var c;s.descendant.push(l),i=i.slice(0,n-1),i.push(a),s.treeIndex.push(i),(c=l.childNodes)!=null&&c.length&&r(l.childNodes,n,i,s)}),s};var t=r;return r(e)}else return{descendant:[],treeIndex:[]}}get ancestorNodes(){function e(t,r){if(t.note.parentNote){let o=new Xr(t.note.parentNote);r=e(o,[...r,o])}return r}return e(this,[])}get childNodes(){var t;var e;return(t=(e=this.note.childNotes)==null?void 0:e.map(r=>new Xr(r)))!=null?t:[]}get parentNode(){return this.note.parentNote&&new Xr(this.note.parentNote)}get notes(){return this.note.comments.reduce((e,t)=>(t.type=="LinkNote"&&e.push(I.db.getNoteById(t.noteid)),e),[this.note])}set titles(e){let t=sr(e,!0).join("; ");this.note.excerptText===this.note.noteTitle?(this.note.noteTitle=t,this.note.excerptText=t):this.note.noteTitle=t}get isOCR(){var e;if((e=this.note.excerptPic)!=null&&e.paint)return this.note.textFirst}get title(){var e;return(e=this.note.noteTitle)!=null?e:""}set title(e){this.note.noteTitle=e}get mainExcerptText(){var e;return(e=this.note.excerptText)!=null?e:""}set mainExcerptText(e){this.note.excerptText=e}get titles(){var t;var e;return sr((t=(e=this.note.noteTitle)==null?void 0:e.split(/\s*[;；]\s*/))!=null?t:[],!0)}appendTitles(...e){let t=sr([...this.titles,...e],!0).join("; ");this.note.excerptText===this.note.noteTitle?(this.note.noteTitle=t,this.note.excerptText=t):this.note.noteTitle=t}get tags(){return this.note.comments.reduce((t,r)=>(r.type=="TextNote"&&r.text.startsWith("#")&&t.push(...r.text.split(/\s+/).filter(o=>o.startsWith("#"))),t),[]).map(t=>t.slice(1))}set tags(e){this.tidyupTags(),e=sr(e,!0);let t=this.note.comments[this.note.comments.length-1];(t==null?void 0:t.type)=="TextNote"&&t.text.startsWith("#")&&this.note.removeCommentByIndex(this.note.comments.length-1),this.appendTextComments(e.map(r=>`#${r}`).join(" "))}appendTags(...e){this.tidyupTags(),e=sr([...this.tags,...e],!0);let t=this.note.comments[this.note.comments.length-1];return(t==null?void 0:t.type)=="TextNote"&&t.text.startsWith("#")&&this.note.removeCommentByIndex(this.note.comments.length-1),this.appendTextComments(e.map(r=>`#${r}`).join(" ")),this}tidyupTags(){let e=[],t=[];return this.note.comments.forEach((r,o)=>{if(r.type=="TextNote"&&r.text.startsWith("#")){let n=r.text.split(" ").filter(i=>i.startsWith("#"));e.push(...n.map(i=>i.slice(1))),t.unshift(o)}}),t.forEach(r=>{this.note.removeCommentByIndex(r)}),this.appendTextComments(sr(e).map(r=>`#${r}`).join(" ")),this}getCommentIndex(e){let t=this.note.comments;for(let r=0;r<t.length;r++){let o=t[r];if(typeof e=="string"){if(o.type=="TextNote"&&o.text==e)return r}else if(o.type=="LinkNote"&&o.noteid==e.noteId)return r}return-1}get excerptsTextPic(){return this.notes.reduce((e,t)=>(Object.entries(ii(t)).forEach(([r,o])=>{r in e&&e[r].push(o)}),e),{ocr:[],html:[],md:[]})}get commentsTextPic(){return this.note.comments.reduce((e,t)=>{if(t.type==="PaintNote"){let r=Qo(t);r&&Object.entries(r).forEach(([o,n])=>{o in e&&e[o].push(n)})}else if(t.type=="TextNote"||t.type=="HtmlNote"){let r=t.text.trim();r&&!r.includes("marginnote3app")&&!r.startsWith("#")&&Object.values(e).map(o=>o.push(r))}return e},{html:[],md:[]})}get excerptsText(){return this.notes.reduce((e,t)=>{var r,o;let n=(r=t.excerptText)==null?void 0:r.trim();return n&&(!((o=t.excerptPic)!=null&&o.paint)||this.isOCR)&&e.push(n),e},[])}get commentsText(){return this.note.comments.reduce((e,t)=>{if(t.type=="TextNote"||t.type=="HtmlNote"){let r=t.text.trim();r&&!r.includes("marginnote3app")&&!r.startsWith("#")&&e.push(r)}return e},[])}get allTextPic(){let e=ii(this.note);return this.note.comments.forEach(t=>{if(t.type==="PaintNote"){let r=Qo(t);r&&Object.entries(r).forEach(([o,n])=>{o in e&&e[o].push(n)})}else if(t.type=="TextNote"||t.type=="HtmlNote"){let r=t.text.trim();r&&Object.values(e).map(o=>o.push(r))}else if(t.type=="LinkNote"){let r=I.db.getNoteById(t.noteid);r&&Object.entries(ii(r)).forEach(([o,n])=>{o in e&&e[o].push(n)})}}),{html:e.html.join(`

`),ocr:e.ocr.join(`

`),md:e.md.join(`

`)}}get allText(){var e;let{mainExcerptText:t}=this,r=t&&(!((e=this.note.excerptPic)!=null&&e.paint)||this.isOCR)?[t]:[];return this.note.comments.forEach(o=>{var n,i;if(o.type=="TextNote"||o.type=="HtmlNote"){let s=o.text.trim();s&&r.push(s)}else if(o.type=="LinkNote"){let s=I.db.getNoteById(o.noteid),l=(n=s==null?void 0:s.excerptText)==null?void 0:n.trim();l&&(!((i=s==null?void 0:s.excerptPic)!=null&&i.paint)||this.isOCR)&&r.push(l)}}),r.join(`

`)}get excerptsCommentsText(){var e;let{mainExcerptText:t}=this,r=t&&(!((e=this.note.excerptPic)!=null&&e.paint)||this.isOCR)?[t]:[];return this.note.comments.forEach(o=>{var n,i;if(o.type=="TextNote"||o.type=="HtmlNote"){let s=o.text.trim();s&&!s.includes("marginnote3app")&&!s.startsWith("#")&&r.push(s)}else if(o.type=="LinkNote"){let s=I.db.getNoteById(o.noteid),l=(n=s==null?void 0:s.excerptText)==null?void 0:n.trim();l&&(!((i=s==null?void 0:s.excerptPic)!=null&&i.paint)||this.isOCR)&&r.push(l)}}),r}appendTextComments(...e){e=sr(e,!0);let t=this.note.comments.filter(r=>r.type==="TextNote");return e.forEach(r=>{r&&t.every(o=>o.type==="TextNote"&&o.text!==r)&&this.note.appendTextComment(r)}),this}async removeCommentButLinkTag(e,t){let{removedIndex:r,linkTags:o}=this.note.comments.reduce((n,i,s)=>(i.type=="TextNote"&&(i.text.includes("marginnote3app://note/")||i.text.startsWith("#"))?(n.linkTags.push(i.text),n.removedIndex.unshift(s)):e(i)||n.removedIndex.unshift(s),n),{removedIndex:[],linkTags:[]});return r.forEach(n=>{this.note.removeCommentByIndex(n)}),t&&await t(this),this.appendTextComments(...o),this}}});var Jr=_((o_,tc)=>{var ey="2.0.0",ty=Number.MAX_SAFE_INTEGER||9007199254740991,ry=16;tc.exports={SEMVER_SPEC_VERSION:ey,MAX_LENGTH:256,MAX_SAFE_INTEGER:ty,MAX_SAFE_COMPONENT_LENGTH:ry}});var Yr=_((n_,rc)=>{var oy=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};rc.exports=oy});var lr=_((Wt,oc)=>{var{MAX_SAFE_COMPONENT_LENGTH:pi}=Jr(),ny=Yr();Wt=oc.exports={};var iy=Wt.re=[],k=Wt.src=[],N=Wt.t={},sy=0,D=(e,t,r)=>{let o=sy++;ny(e,o,t),N[e]=o,k[o]=t,iy[o]=new RegExp(t,r?"g":void 0)};D("NUMERICIDENTIFIER","0|[1-9]\\d*");D("NUMERICIDENTIFIERLOOSE","[0-9]+");D("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");D("MAINVERSION",`(${k[N.NUMERICIDENTIFIER]})\\.(${k[N.NUMERICIDENTIFIER]})\\.(${k[N.NUMERICIDENTIFIER]})`);D("MAINVERSIONLOOSE",`(${k[N.NUMERICIDENTIFIERLOOSE]})\\.(${k[N.NUMERICIDENTIFIERLOOSE]})\\.(${k[N.NUMERICIDENTIFIERLOOSE]})`);D("PRERELEASEIDENTIFIER",`(?:${k[N.NUMERICIDENTIFIER]}|${k[N.NONNUMERICIDENTIFIER]})`);D("PRERELEASEIDENTIFIERLOOSE",`(?:${k[N.NUMERICIDENTIFIERLOOSE]}|${k[N.NONNUMERICIDENTIFIER]})`);D("PRERELEASE",`(?:-(${k[N.PRERELEASEIDENTIFIER]}(?:\\.${k[N.PRERELEASEIDENTIFIER]})*))`);D("PRERELEASELOOSE",`(?:-?(${k[N.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${k[N.PRERELEASEIDENTIFIERLOOSE]})*))`);D("BUILDIDENTIFIER","[0-9A-Za-z-]+");D("BUILD",`(?:\\+(${k[N.BUILDIDENTIFIER]}(?:\\.${k[N.BUILDIDENTIFIER]})*))`);D("FULLPLAIN",`v?${k[N.MAINVERSION]}${k[N.PRERELEASE]}?${k[N.BUILD]}?`);D("FULL",`^${k[N.FULLPLAIN]}$`);D("LOOSEPLAIN",`[v=\\s]*${k[N.MAINVERSIONLOOSE]}${k[N.PRERELEASELOOSE]}?${k[N.BUILD]}?`);D("LOOSE",`^${k[N.LOOSEPLAIN]}$`);D("GTLT","((?:<|>)?=?)");D("XRANGEIDENTIFIERLOOSE",`${k[N.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);D("XRANGEIDENTIFIER",`${k[N.NUMERICIDENTIFIER]}|x|X|\\*`);D("XRANGEPLAIN",`[v=\\s]*(${k[N.XRANGEIDENTIFIER]})(?:\\.(${k[N.XRANGEIDENTIFIER]})(?:\\.(${k[N.XRANGEIDENTIFIER]})(?:${k[N.PRERELEASE]})?${k[N.BUILD]}?)?)?`);D("XRANGEPLAINLOOSE",`[v=\\s]*(${k[N.XRANGEIDENTIFIERLOOSE]})(?:\\.(${k[N.XRANGEIDENTIFIERLOOSE]})(?:\\.(${k[N.XRANGEIDENTIFIERLOOSE]})(?:${k[N.PRERELEASELOOSE]})?${k[N.BUILD]}?)?)?`);D("XRANGE",`^${k[N.GTLT]}\\s*${k[N.XRANGEPLAIN]}$`);D("XRANGELOOSE",`^${k[N.GTLT]}\\s*${k[N.XRANGEPLAINLOOSE]}$`);D("COERCE",`(^|[^\\d])(\\d{1,${pi}})(?:\\.(\\d{1,${pi}}))?(?:\\.(\\d{1,${pi}}))?(?:$|[^\\d])`);D("COERCERTL",k[N.COERCE],!0);D("LONETILDE","(?:~>?)");D("TILDETRIM",`(\\s*)${k[N.LONETILDE]}\\s+`,!0);Wt.tildeTrimReplace="$1~";D("TILDE",`^${k[N.LONETILDE]}${k[N.XRANGEPLAIN]}$`);D("TILDELOOSE",`^${k[N.LONETILDE]}${k[N.XRANGEPLAINLOOSE]}$`);D("LONECARET","(?:\\^)");D("CARETTRIM",`(\\s*)${k[N.LONECARET]}\\s+`,!0);Wt.caretTrimReplace="$1^";D("CARET",`^${k[N.LONECARET]}${k[N.XRANGEPLAIN]}$`);D("CARETLOOSE",`^${k[N.LONECARET]}${k[N.XRANGEPLAINLOOSE]}$`);D("COMPARATORLOOSE",`^${k[N.GTLT]}\\s*(${k[N.LOOSEPLAIN]})$|^$`);D("COMPARATOR",`^${k[N.GTLT]}\\s*(${k[N.FULLPLAIN]})$|^$`);D("COMPARATORTRIM",`(\\s*)${k[N.GTLT]}\\s*(${k[N.LOOSEPLAIN]}|${k[N.XRANGEPLAIN]})`,!0);Wt.comparatorTrimReplace="$1$2$3";D("HYPHENRANGE",`^\\s*(${k[N.XRANGEPLAIN]})\\s+-\\s+(${k[N.XRANGEPLAIN]})\\s*$`);D("HYPHENRANGELOOSE",`^\\s*(${k[N.XRANGEPLAINLOOSE]})\\s+-\\s+(${k[N.XRANGEPLAINLOOSE]})\\s*$`);D("STAR","(<|>)?=?\\s*\\*");D("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");D("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Zr=_((i_,nc)=>{var ly=["includePrerelease","loose","rtl"],ay=e=>e?typeof e!="object"?{loose:!0}:ly.filter(t=>e[t]).reduce((t,r)=>(t[r]=!0,t),{}):{};nc.exports=ay});var tn=_((s_,lc)=>{var ic=/^[0-9]+$/,sc=(e,t)=>{let r=ic.test(e),o=ic.test(t);return r&&o&&(e=+e,t=+t),e===t?0:r&&!o?-1:o&&!r?1:e<t?-1:1},cy=(e,t)=>sc(t,e);lc.exports={compareIdentifiers:sc,rcompareIdentifiers:cy}});var Ne=_((l_,pc)=>{var rn=Yr(),{MAX_LENGTH:ac,MAX_SAFE_INTEGER:on}=Jr(),{re:cc,t:uc}=lr(),uy=Zr(),{compareIdentifiers:Tr}=tn(),ze=class{constructor(t,r){if(r=uy(r),t instanceof ze){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>ac)throw new TypeError(`version is longer than ${ac} characters`);rn("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let o=t.trim().match(r.loose?cc[uc.LOOSE]:cc[uc.FULL]);if(!o)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+o[1],this.minor=+o[2],this.patch=+o[3],this.major>on||this.major<0)throw new TypeError("Invalid major version");if(this.minor>on||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>on||this.patch<0)throw new TypeError("Invalid patch version");o[4]?this.prerelease=o[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<on)return i}return n}):this.prerelease=[],this.build=o[5]?o[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(rn("SemVer.compare",this.version,this.options,t),!(t instanceof ze)){if(typeof t=="string"&&t===this.version)return 0;t=new ze(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof ze||(t=new ze(t,this.options)),Tr(this.major,t.major)||Tr(this.minor,t.minor)||Tr(this.patch,t.patch)}comparePre(t){if(t instanceof ze||(t=new ze(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{let o=this.prerelease[r],n=t.prerelease[r];if(rn("prerelease compare",r,o,n),o===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(o===void 0)return-1;if(o===n)continue;return Tr(o,n)}while(++r)}compareBuild(t){t instanceof ze||(t=new ze(t,this.options));let r=0;do{let o=this.build[r],n=t.build[r];if(rn("prerelease compare",r,o,n),o===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(o===void 0)return-1;if(o===n)continue;return Tr(o,n)}while(++r)}inc(t,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r),this.inc("pre",r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r),this.inc("pre",r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);o===-1&&this.prerelease.push(0)}r&&(Tr(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=[r,0]):this.prerelease=[r,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};pc.exports=ze});var ar=_((a_,mc)=>{var{MAX_LENGTH:py}=Jr(),{re:fc,t:hc}=lr(),dc=Ne(),fy=Zr(),hy=(e,t)=>{if(t=fy(t),e instanceof dc)return e;if(typeof e!="string"||e.length>py||!(t.loose?fc[hc.LOOSE]:fc[hc.FULL]).test(e))return null;try{return new dc(e,t)}catch{return null}};mc.exports=hy});var yc=_((c_,gc)=>{var dy=ar(),my=(e,t)=>{let r=dy(e,t);return r?r.version:null};gc.exports=my});var xc=_((u_,bc)=>{var gy=ar(),yy=(e,t)=>{let r=gy(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};bc.exports=yy});var Sc=_((p_,_c)=>{var wc=Ne(),by=(e,t,r,o)=>{typeof r=="string"&&(o=r,r=void 0);try{return new wc(e instanceof wc?e.version:e,r).inc(t,o).version}catch{return null}};_c.exports=by});var tt=_((f_,Tc)=>{var Cc=Ne(),xy=(e,t,r)=>new Cc(e,r).compare(new Cc(t,r));Tc.exports=xy});var nn=_((h_,Ec)=>{var wy=tt(),_y=(e,t,r)=>wy(e,t,r)===0;Ec.exports=_y});var kc=_((d_,$c)=>{var vc=ar(),Sy=nn(),Cy=(e,t)=>{if(Sy(e,t))return null;{let r=vc(e),o=vc(t),n=r.prerelease.length||o.prerelease.length,i=n?"pre":"",s=n?"prerelease":"";for(let l in r)if((l==="major"||l==="minor"||l==="patch")&&r[l]!==o[l])return i+l;return s}};$c.exports=Cy});var Ic=_((m_,Nc)=>{var Ty=Ne(),Ey=(e,t)=>new Ty(e,t).major;Nc.exports=Ey});var Rc=_((g_,Pc)=>{var vy=Ne(),$y=(e,t)=>new vy(e,t).minor;Pc.exports=$y});var Oc=_((y_,Ac)=>{var ky=Ne(),Ny=(e,t)=>new ky(e,t).patch;Ac.exports=Ny});var Lc=_((b_,Dc)=>{var Iy=ar(),Py=(e,t)=>{let r=Iy(e,t);return r&&r.prerelease.length?r.prerelease:null};Dc.exports=Py});var Bc=_((x_,Mc)=>{var Ry=tt(),Ay=(e,t,r)=>Ry(t,e,r);Mc.exports=Ay});var Fc=_((w_,Uc)=>{var Oy=tt(),Dy=(e,t)=>Oy(e,t,!0);Uc.exports=Dy});var sn=_((__,qc)=>{var Gc=Ne(),Ly=(e,t,r)=>{let o=new Gc(e,r),n=new Gc(t,r);return o.compare(n)||o.compareBuild(n)};qc.exports=Ly});var Wc=_((S_,jc)=>{var My=sn(),By=(e,t)=>e.sort((r,o)=>My(r,o,t));jc.exports=By});var Vc=_((C_,Kc)=>{var Uy=sn(),Fy=(e,t)=>e.sort((r,o)=>Uy(o,r,t));Kc.exports=Fy});var Qr=_((T_,Hc)=>{var Gy=tt(),qy=(e,t,r)=>Gy(e,t,r)>0;Hc.exports=qy});var ln=_((E_,zc)=>{var jy=tt(),Wy=(e,t,r)=>jy(e,t,r)<0;zc.exports=Wy});var fi=_((v_,Xc)=>{var Ky=tt(),Vy=(e,t,r)=>Ky(e,t,r)!==0;Xc.exports=Vy});var an=_(($_,Jc)=>{var Hy=tt(),zy=(e,t,r)=>Hy(e,t,r)>=0;Jc.exports=zy});var cn=_((k_,Yc)=>{var Xy=tt(),Jy=(e,t,r)=>Xy(e,t,r)<=0;Yc.exports=Jy});var hi=_((N_,Zc)=>{var Yy=nn(),Zy=fi(),Qy=Qr(),eb=an(),tb=ln(),rb=cn(),ob=(e,t,r,o)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return Yy(e,r,o);case"!=":return Zy(e,r,o);case">":return Qy(e,r,o);case">=":return eb(e,r,o);case"<":return tb(e,r,o);case"<=":return rb(e,r,o);default:throw new TypeError(`Invalid operator: ${t}`)}};Zc.exports=ob});var eu=_((I_,Qc)=>{var nb=Ne(),ib=ar(),{re:un,t:pn}=lr(),sb=(e,t)=>{if(e instanceof nb)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let r=null;if(!t.rtl)r=e.match(un[pn.COERCE]);else{let o;for(;(o=un[pn.COERCERTL].exec(e))&&(!r||r.index+r[0].length!==e.length);)(!r||o.index+o[0].length!==r.index+r[0].length)&&(r=o),un[pn.COERCERTL].lastIndex=o.index+o[1].length+o[2].length;un[pn.COERCERTL].lastIndex=-1}return r===null?null:ib(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,t)};Qc.exports=sb});var ru=_((P_,tu)=>{"use strict";tu.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}});var nu=_((R_,ou)=>{"use strict";ou.exports=j;j.Node=cr;j.create=j;function j(e){var t=this;if(t instanceof j||(t=new j),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(n){t.push(n)});else if(arguments.length>0)for(var r=0,o=arguments.length;r<o;r++)t.push(arguments[r]);return t}j.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t};j.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};j.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};j.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)ab(this,arguments[e]);return this.length};j.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)cb(this,arguments[e]);return this.length};j.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};j.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};j.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,o=0;r!==null;o++)e.call(t,r.value,o,this),r=r.next};j.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,o=this.length-1;r!==null;o--)e.call(t,r.value,o,this),r=r.prev};j.prototype.get=function(e){for(var t=0,r=this.head;r!==null&&t<e;t++)r=r.next;if(t===e&&r!==null)return r.value};j.prototype.getReverse=function(e){for(var t=0,r=this.tail;r!==null&&t<e;t++)r=r.prev;if(t===e&&r!==null)return r.value};j.prototype.map=function(e,t){t=t||this;for(var r=new j,o=this.head;o!==null;)r.push(e.call(t,o.value,this)),o=o.next;return r};j.prototype.mapReverse=function(e,t){t=t||this;for(var r=new j,o=this.tail;o!==null;)r.push(e.call(t,o.value,this)),o=o.prev;return r};j.prototype.reduce=function(e,t){var r,o=this.head;if(arguments.length>1)r=t;else if(this.head)o=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;o!==null;n++)r=e(r,o.value,n),o=o.next;return r};j.prototype.reduceReverse=function(e,t){var r,o=this.tail;if(arguments.length>1)r=t;else if(this.tail)o=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=this.length-1;o!==null;n--)r=e(r,o.value,n),o=o.prev;return r};j.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;r!==null;t++)e[t]=r.value,r=r.next;return e};j.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;r!==null;t++)e[t]=r.value,r=r.prev;return e};j.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new j;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=0,n=this.head;n!==null&&o<e;o++)n=n.next;for(;n!==null&&o<t;o++,n=n.next)r.push(n.value);return r};j.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new j;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=this.length,n=this.tail;n!==null&&o>t;o--)n=n.prev;for(;n!==null&&o>e;o--,n=n.prev)r.push(n.value);return r};j.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var o=0,n=this.head;n!==null&&o<e;o++)n=n.next;for(var i=[],o=0;n&&o<t;o++)i.push(n.value),n=this.removeNode(n);n===null&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var o=0;o<r.length;o++)n=lb(this,n,r[o]);return i};j.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;r!==null;r=r.prev){var o=r.prev;r.prev=r.next,r.next=o}return this.head=t,this.tail=e,this};function lb(e,t,r){var o=t===e.head?new cr(r,null,t,e):new cr(r,t,t.next,e);return o.next===null&&(e.tail=o),o.prev===null&&(e.head=o),e.length++,o}function ab(e,t){e.tail=new cr(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function cb(e,t){e.head=new cr(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function cr(e,t,r,o){if(!(this instanceof cr))return new cr(e,t,r,o);this.list=o,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{ru()(j)}catch{}});var cu=_((A_,au)=>{"use strict";var ub=nu(),ur=Symbol("max"),Nt=Symbol("length"),Er=Symbol("lengthCalculator"),to=Symbol("allowStale"),pr=Symbol("maxAge"),kt=Symbol("dispose"),iu=Symbol("noDisposeOnSet"),be=Symbol("lruList"),ut=Symbol("cache"),lu=Symbol("updateAgeOnGet"),di=()=>1,gi=class{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");let r=this[ur]=t.max||1/0,o=t.length||di;if(this[Er]=typeof o!="function"?di:o,this[to]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[pr]=t.maxAge||0,this[kt]=t.dispose,this[iu]=t.noDisposeOnSet||!1,this[lu]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[ur]=t||1/0,eo(this)}get max(){return this[ur]}set allowStale(t){this[to]=!!t}get allowStale(){return this[to]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[pr]=t,eo(this)}get maxAge(){return this[pr]}set lengthCalculator(t){typeof t!="function"&&(t=di),t!==this[Er]&&(this[Er]=t,this[Nt]=0,this[be].forEach(r=>{r.length=this[Er](r.value,r.key),this[Nt]+=r.length})),eo(this)}get lengthCalculator(){return this[Er]}get length(){return this[Nt]}get itemCount(){return this[be].length}rforEach(t,r){r=r||this;for(let o=this[be].tail;o!==null;){let n=o.prev;su(this,t,o,r),o=n}}forEach(t,r){r=r||this;for(let o=this[be].head;o!==null;){let n=o.next;su(this,t,o,r),o=n}}keys(){return this[be].toArray().map(t=>t.key)}values(){return this[be].toArray().map(t=>t.value)}reset(){this[kt]&&this[be]&&this[be].length&&this[be].forEach(t=>this[kt](t.key,t.value)),this[ut]=new Map,this[be]=new ub,this[Nt]=0}dump(){return this[be].map(t=>fn(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[be]}set(t,r,o){if(o=o||this[pr],o&&typeof o!="number")throw new TypeError("maxAge must be a number");let n=o?Date.now():0,i=this[Er](r,t);if(this[ut].has(t)){if(i>this[ur])return vr(this,this[ut].get(t)),!1;let a=this[ut].get(t).value;return this[kt]&&(this[iu]||this[kt](t,a.value)),a.now=n,a.maxAge=o,a.value=r,this[Nt]+=i-a.length,a.length=i,this.get(t),eo(this),!0}let s=new yi(t,r,i,n,o);return s.length>this[ur]?(this[kt]&&this[kt](t,r),!1):(this[Nt]+=s.length,this[be].unshift(s),this[ut].set(t,this[be].head),eo(this),!0)}has(t){if(!this[ut].has(t))return!1;let r=this[ut].get(t).value;return!fn(this,r)}get(t){return mi(this,t,!0)}peek(t){return mi(this,t,!1)}pop(){let t=this[be].tail;return t?(vr(this,t),t.value):null}del(t){vr(this,this[ut].get(t))}load(t){this.reset();let r=Date.now();for(let o=t.length-1;o>=0;o--){let n=t[o],i=n.e||0;if(i===0)this.set(n.k,n.v);else{let s=i-r;s>0&&this.set(n.k,n.v,s)}}}prune(){this[ut].forEach((t,r)=>mi(this,r,!1))}},mi=(e,t,r)=>{let o=e[ut].get(t);if(o){let n=o.value;if(fn(e,n)){if(vr(e,o),!e[to])return}else r&&(e[lu]&&(o.value.now=Date.now()),e[be].unshiftNode(o));return n.value}},fn=(e,t)=>{if(!t||!t.maxAge&&!e[pr])return!1;let r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[pr]&&r>e[pr]},eo=e=>{if(e[Nt]>e[ur])for(let t=e[be].tail;e[Nt]>e[ur]&&t!==null;){let r=t.prev;vr(e,t),t=r}},vr=(e,t)=>{if(t){let r=t.value;e[kt]&&e[kt](r.key,r.value),e[Nt]-=r.length,e[ut].delete(r.key),e[be].removeNode(t)}},yi=class{constructor(t,r,o,n,i){this.key=t,this.value=r,this.length=o,this.now=n,this.maxAge=i||0}},su=(e,t,r,o)=>{let n=r.value;fn(e,n)&&(vr(e,r),e[to]||(n=void 0)),n&&t.call(o,n.value,n.key,e)};au.exports=gi});var rt=_((O_,hu)=>{var fr=class{constructor(t,r){if(r=fb(r),t instanceof fr)return t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease?t:new fr(t.raw,r);if(t instanceof bi)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=t,this.set=t.split("||").map(o=>this.parseRange(o.trim())).filter(o=>o.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){let o=this.set[0];if(this.set=this.set.filter(n=>!pu(n[0])),this.set.length===0)this.set=[o];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&yb(n[0])){this.set=[n];break}}}this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();let o=`parseRange:${Object.keys(this.options).join(",")}:${t}`,n=uu.get(o);if(n)return n;let i=this.options.loose,s=i?je[Le.HYPHENRANGELOOSE]:je[Le.HYPHENRANGE];t=t.replace(s,$b(this.options.includePrerelease)),ne("hyphen replace",t),t=t.replace(je[Le.COMPARATORTRIM],db),ne("comparator trim",t),t=t.replace(je[Le.TILDETRIM],mb),t=t.replace(je[Le.CARETTRIM],gb),t=t.split(/\s+/).join(" ");let l=t.split(" ").map(p=>bb(p,this.options)).join(" ").split(/\s+/).map(p=>vb(p,this.options));i&&(l=l.filter(p=>(ne("loose invalid filter",p,this.options),!!p.match(je[Le.COMPARATORLOOSE])))),ne("range list",l);let a=new Map,c=l.map(p=>new bi(p,this.options));for(let p of c){if(pu(p))return[p];a.set(p.value,p)}a.size>1&&a.has("")&&a.delete("");let u=[...a.values()];return uu.set(o,u),u}intersects(t,r){if(!(t instanceof fr))throw new TypeError("a Range is required");return this.set.some(o=>fu(o,r)&&t.set.some(n=>fu(n,r)&&o.every(i=>n.every(s=>i.intersects(s,r)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new hb(t,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(kb(this.set[r],t,this.options))return!0;return!1}};hu.exports=fr;var pb=cu(),uu=new pb({max:1e3}),fb=Zr(),bi=ro(),ne=Yr(),hb=Ne(),{re:je,t:Le,comparatorTrimReplace:db,tildeTrimReplace:mb,caretTrimReplace:gb}=lr(),pu=e=>e.value==="<0.0.0-0",yb=e=>e.value==="",fu=(e,t)=>{let r=!0,o=e.slice(),n=o.pop();for(;r&&o.length;)r=o.every(i=>n.intersects(i,t)),n=o.pop();return r},bb=(e,t)=>(ne("comp",e,t),e=_b(e,t),ne("caret",e),e=xb(e,t),ne("tildes",e),e=Cb(e,t),ne("xrange",e),e=Eb(e,t),ne("stars",e),e),Me=e=>!e||e.toLowerCase()==="x"||e==="*",xb=(e,t)=>e.trim().split(/\s+/).map(r=>wb(r,t)).join(" "),wb=(e,t)=>{let r=t.loose?je[Le.TILDELOOSE]:je[Le.TILDE];return e.replace(r,(o,n,i,s,l)=>{ne("tilde",e,o,n,i,s,l);let a;return Me(n)?a="":Me(i)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:Me(s)?a=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:l?(ne("replaceTilde pr",l),a=`>=${n}.${i}.${s}-${l} <${n}.${+i+1}.0-0`):a=`>=${n}.${i}.${s} <${n}.${+i+1}.0-0`,ne("tilde return",a),a})},_b=(e,t)=>e.trim().split(/\s+/).map(r=>Sb(r,t)).join(" "),Sb=(e,t)=>{ne("caret",e,t);let r=t.loose?je[Le.CARETLOOSE]:je[Le.CARET],o=t.includePrerelease?"-0":"";return e.replace(r,(n,i,s,l,a)=>{ne("caret",e,n,i,s,l,a);let c;return Me(i)?c="":Me(s)?c=`>=${i}.0.0${o} <${+i+1}.0.0-0`:Me(l)?i==="0"?c=`>=${i}.${s}.0${o} <${i}.${+s+1}.0-0`:c=`>=${i}.${s}.0${o} <${+i+1}.0.0-0`:a?(ne("replaceCaret pr",a),i==="0"?s==="0"?c=`>=${i}.${s}.${l}-${a} <${i}.${s}.${+l+1}-0`:c=`>=${i}.${s}.${l}-${a} <${i}.${+s+1}.0-0`:c=`>=${i}.${s}.${l}-${a} <${+i+1}.0.0-0`):(ne("no pr"),i==="0"?s==="0"?c=`>=${i}.${s}.${l}${o} <${i}.${s}.${+l+1}-0`:c=`>=${i}.${s}.${l}${o} <${i}.${+s+1}.0-0`:c=`>=${i}.${s}.${l} <${+i+1}.0.0-0`),ne("caret return",c),c})},Cb=(e,t)=>(ne("replaceXRanges",e,t),e.split(/\s+/).map(r=>Tb(r,t)).join(" ")),Tb=(e,t)=>{e=e.trim();let r=t.loose?je[Le.XRANGELOOSE]:je[Le.XRANGE];return e.replace(r,(o,n,i,s,l,a)=>{ne("xRange",e,o,n,i,s,l,a);let c=Me(i),u=c||Me(s),p=u||Me(l),f=p;return n==="="&&f&&(n=""),a=t.includePrerelease?"-0":"",c?n===">"||n==="<"?o="<0.0.0-0":o="*":n&&f?(u&&(s=0),l=0,n===">"?(n=">=",u?(i=+i+1,s=0,l=0):(s=+s+1,l=0)):n==="<="&&(n="<",u?i=+i+1:s=+s+1),n==="<"&&(a="-0"),o=`${n+i}.${s}.${l}${a}`):u?o=`>=${i}.0.0${a} <${+i+1}.0.0-0`:p&&(o=`>=${i}.${s}.0${a} <${i}.${+s+1}.0-0`),ne("xRange return",o),o})},Eb=(e,t)=>(ne("replaceStars",e,t),e.trim().replace(je[Le.STAR],"")),vb=(e,t)=>(ne("replaceGTE0",e,t),e.trim().replace(je[t.includePrerelease?Le.GTE0PRE:Le.GTE0],"")),$b=e=>(t,r,o,n,i,s,l,a,c,u,p,f,h)=>(Me(o)?r="":Me(n)?r=`>=${o}.0.0${e?"-0":""}`:Me(i)?r=`>=${o}.${n}.0${e?"-0":""}`:s?r=`>=${r}`:r=`>=${r}${e?"-0":""}`,Me(c)?a="":Me(u)?a=`<${+c+1}.0.0-0`:Me(p)?a=`<${c}.${+u+1}.0-0`:f?a=`<=${c}.${u}.${p}-${f}`:e?a=`<${c}.${u}.${+p+1}-0`:a=`<=${a}`,`${r} ${a}`.trim()),kb=(e,t,r)=>{for(let o=0;o<e.length;o++)if(!e[o].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let o=0;o<e.length;o++)if(ne(e[o].semver),e[o].semver!==bi.ANY&&e[o].semver.prerelease.length>0){let n=e[o].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}});var ro=_((D_,bu)=>{var oo=Symbol("SemVer ANY"),$r=class{static get ANY(){return oo}constructor(t,r){if(r=Nb(r),t instanceof $r){if(t.loose===!!r.loose)return t;t=t.value}wi("comparator",t,r),this.options=r,this.loose=!!r.loose,this.parse(t),this.semver===oo?this.value="":this.value=this.operator+this.semver.version,wi("comp",this)}parse(t){let r=this.options.loose?du[mu.COMPARATORLOOSE]:du[mu.COMPARATOR],o=t.match(r);if(!o)throw new TypeError(`Invalid comparator: ${t}`);this.operator=o[1]!==void 0?o[1]:"",this.operator==="="&&(this.operator=""),o[2]?this.semver=new gu(o[2],this.options.loose):this.semver=oo}toString(){return this.value}test(t){if(wi("Comparator.test",t,this.options.loose),this.semver===oo||t===oo)return!0;if(typeof t=="string")try{t=new gu(t,this.options)}catch{return!1}return xi(t,this.operator,this.semver,this.options)}intersects(t,r){if(!(t instanceof $r))throw new TypeError("a Comparator is required");if((!r||typeof r!="object")&&(r={loose:!!r,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new yu(t.value,r).test(this.value);if(t.operator==="")return t.value===""?!0:new yu(this.value,r).test(t.semver);let o=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),n=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),i=this.semver.version===t.semver.version,s=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),l=xi(this.semver,"<",t.semver,r)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),a=xi(this.semver,">",t.semver,r)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return o||n||i&&s||l||a}};bu.exports=$r;var Nb=Zr(),{re:du,t:mu}=lr(),xi=hi(),wi=Yr(),gu=Ne(),yu=rt()});var no=_((L_,xu)=>{var Ib=rt(),Pb=(e,t,r)=>{try{t=new Ib(t,r)}catch{return!1}return t.test(e)};xu.exports=Pb});var _u=_((M_,wu)=>{var Rb=rt(),Ab=(e,t)=>new Rb(e,t).set.map(r=>r.map(o=>o.value).join(" ").trim().split(" "));wu.exports=Ab});var Cu=_((B_,Su)=>{var Ob=Ne(),Db=rt(),Lb=(e,t,r)=>{let o=null,n=null,i=null;try{i=new Db(t,r)}catch{return null}return e.forEach(s=>{i.test(s)&&(!o||n.compare(s)===-1)&&(o=s,n=new Ob(o,r))}),o};Su.exports=Lb});var Eu=_((U_,Tu)=>{var Mb=Ne(),Bb=rt(),Ub=(e,t,r)=>{let o=null,n=null,i=null;try{i=new Bb(t,r)}catch{return null}return e.forEach(s=>{i.test(s)&&(!o||n.compare(s)===1)&&(o=s,n=new Mb(o,r))}),o};Tu.exports=Ub});var ku=_((F_,$u)=>{var _i=Ne(),Fb=rt(),vu=Qr(),Gb=(e,t)=>{e=new Fb(e,t);let r=new _i("0.0.0");if(e.test(r)||(r=new _i("0.0.0-0"),e.test(r)))return r;r=null;for(let o=0;o<e.set.length;++o){let n=e.set[o],i=null;n.forEach(s=>{let l=new _i(s.semver.version);switch(s.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!i||vu(l,i))&&(i=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),i&&(!r||vu(r,i))&&(r=i)}return r&&e.test(r)?r:null};$u.exports=Gb});var Iu=_((G_,Nu)=>{var qb=rt(),jb=(e,t)=>{try{return new qb(e,t).range||"*"}catch{return null}};Nu.exports=jb});var hn=_((q_,Ou)=>{var Wb=Ne(),Au=ro(),{ANY:Kb}=Au,Vb=rt(),Hb=no(),Pu=Qr(),Ru=ln(),zb=cn(),Xb=an(),Jb=(e,t,r,o)=>{e=new Wb(e,o),t=new Vb(t,o);let n,i,s,l,a;switch(r){case">":n=Pu,i=zb,s=Ru,l=">",a=">=";break;case"<":n=Ru,i=Xb,s=Pu,l="<",a="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Hb(e,t,o))return!1;for(let c=0;c<t.set.length;++c){let u=t.set[c],p=null,f=null;if(u.forEach(h=>{h.semver===Kb&&(h=new Au(">=0.0.0")),p=p||h,f=f||h,n(h.semver,p.semver,o)?p=h:s(h.semver,f.semver,o)&&(f=h)}),p.operator===l||p.operator===a||(!f.operator||f.operator===l)&&i(e,f.semver))return!1;if(f.operator===a&&s(e,f.semver))return!1}return!0};Ou.exports=Jb});var Lu=_((j_,Du)=>{var Yb=hn(),Zb=(e,t,r)=>Yb(e,t,">",r);Du.exports=Zb});var Bu=_((W_,Mu)=>{var Qb=hn(),ex=(e,t,r)=>Qb(e,t,"<",r);Mu.exports=ex});var Gu=_((K_,Fu)=>{var Uu=rt(),tx=(e,t,r)=>(e=new Uu(e,r),t=new Uu(t,r),e.intersects(t));Fu.exports=tx});var ju=_((V_,qu)=>{var rx=no(),ox=tt();qu.exports=(e,t,r)=>{let o=[],n=null,i=null,s=e.sort((u,p)=>ox(u,p,r));for(let u of s)rx(u,t,r)?(i=u,n||(n=u)):(i&&o.push([n,i]),i=null,n=null);n&&o.push([n,null]);let l=[];for(let[u,p]of o)u===p?l.push(u):!p&&u===s[0]?l.push("*"):p?u===s[0]?l.push(`<=${p}`):l.push(`${u} - ${p}`):l.push(`>=${u}`);let a=l.join(" || "),c=typeof t.raw=="string"?t.raw:String(t);return a.length<c.length?a:t}});var zu=_((H_,Hu)=>{var Wu=rt(),dn=ro(),{ANY:Si}=dn,io=no(),Ci=tt(),nx=(e,t,r={})=>{if(e===t)return!0;e=new Wu(e,r),t=new Wu(t,r);let o=!1;e:for(let n of e.set){for(let i of t.set){let s=ix(n,i,r);if(o=o||s!==null,s)continue e}if(o)return!1}return!0},ix=(e,t,r)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===Si){if(t.length===1&&t[0].semver===Si)return!0;r.includePrerelease?e=[new dn(">=0.0.0-0")]:e=[new dn(">=0.0.0")]}if(t.length===1&&t[0].semver===Si){if(r.includePrerelease)return!0;t=[new dn(">=0.0.0")]}let o=new Set,n,i;for(let h of e)h.operator===">"||h.operator===">="?n=Ku(n,h,r):h.operator==="<"||h.operator==="<="?i=Vu(i,h,r):o.add(h.semver);if(o.size>1)return null;let s;if(n&&i){if(s=Ci(n.semver,i.semver,r),s>0)return null;if(s===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let h of o){if(n&&!io(h,String(n),r)||i&&!io(h,String(i),r))return null;for(let d of t)if(!io(h,String(d),r))return!1;return!0}let l,a,c,u,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,f=n&&!r.includePrerelease&&n.semver.prerelease.length?n.semver:!1;p&&p.prerelease.length===1&&i.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let h of t){if(u=u||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",n){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator===">"||h.operator===">="){if(l=Ku(n,h,r),l===h&&l!==n)return!1}else if(n.operator===">="&&!io(n.semver,String(h),r))return!1}if(i){if(p&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===p.major&&h.semver.minor===p.minor&&h.semver.patch===p.patch&&(p=!1),h.operator==="<"||h.operator==="<="){if(a=Vu(i,h,r),a===h&&a!==i)return!1}else if(i.operator==="<="&&!io(i.semver,String(h),r))return!1}if(!h.operator&&(i||n)&&s!==0)return!1}return!(n&&c&&!i&&s!==0||i&&u&&!n&&s!==0||f||p)},Ku=(e,t,r)=>{if(!e)return t;let o=Ci(e.semver,t.semver,r);return o>0?e:o<0||t.operator===">"&&e.operator===">="?t:e},Vu=(e,t,r)=>{if(!e)return t;let o=Ci(e.semver,t.semver,r);return o<0?e:o>0||t.operator==="<"&&e.operator==="<="?t:e};Hu.exports=nx});var Ei=_((z_,Xu)=>{var Ti=lr();Xu.exports={re:Ti.re,src:Ti.src,tokens:Ti.t,SEMVER_SPEC_VERSION:Jr().SEMVER_SPEC_VERSION,SemVer:Ne(),compareIdentifiers:tn().compareIdentifiers,rcompareIdentifiers:tn().rcompareIdentifiers,parse:ar(),valid:yc(),clean:xc(),inc:Sc(),diff:kc(),major:Ic(),minor:Rc(),patch:Oc(),prerelease:Lc(),compare:tt(),rcompare:Bc(),compareLoose:Fc(),compareBuild:sn(),sort:Wc(),rsort:Vc(),gt:Qr(),lt:ln(),eq:nn(),neq:fi(),gte:an(),lte:cn(),cmp:hi(),coerce:eu(),Comparator:ro(),Range:rt(),satisfies:no(),toComparators:_u(),maxSatisfying:Cu(),minSatisfying:Eu(),minVersion:ku(),validRange:Iu(),outside:hn(),gtr:Lu(),ltr:Bu(),intersects:Gu(),simplifyRange:ju(),subset:zu()}});var Vf=_(os=>{"use strict";var Nw=Object.prototype.hasOwnProperty,Iw;function Wf(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function Kf(e){try{return encodeURIComponent(e)}catch{return null}}function Pw(e){for(var t=/([^=?#&]+)=?([^&]*)/g,r={},o;o=t.exec(e);){var n=Wf(o[1]),i=Wf(o[2]);n===null||i===null||n in r||(r[n]=i)}return r}function Rw(e,t){t=t||"";var r=[],o,n;typeof t!="string"&&(t="?");for(n in e)if(Nw.call(e,n)){if(o=e[n],!o&&(o===null||o===Iw||isNaN(o))&&(o=""),n=Kf(n),o=Kf(o),n===null||o===null)continue;r.push(n+"="+o)}return r.length?t+r.join("&"):""}os.stringify=Rw;os.parse=Pw});var us="MarginNote<https://github.com/marginnoteapp>";var ps="4.1.1";var Ae={author:us,version:ps,key:"ohmymn",title:"OhMyMN",minMarginNoteVersion:"3.7.21",profileKey:{global:"ohmymn_profile_global_v4",doc:"ohmymn_profile_doc_v4",notebook:"ohmymn_profile_notebook_v4"},color:{border:"#8A95A2",button:"#8A95A2"},github:"https://github.com/marginnoteapp/ohmymn",forumZH:"https://bbs.marginnote.cn/t/topic/20501",forum:"https://forum.marginnote.com/t/5883",docZH:"https://ohmymn.marginnote.cn",doc:"https://ohmymn.vercel.app",files:["assets/logo.png","assets/icon","assets/AutoSimplifyData.json"]};var ci=C(T()),ui=class{constructor(){this.textColor=UIColor.blackColor();this.key=Ae.key;this.title=Ae.title;this.author=Ae.author;this.version=Ae.version;this.globalProfileKey=Ae.profileKey.global;this.docProfileKey=Ae.profileKey.doc;this.notebookProfileKey=Ae.profileKey.notebook;this.borderColor=UIColor.colorWithHexString(Ae.color.border);this.buttonColor=UIColor.colorWithHexString(Ae.color.button);this.github=Ae.github;this.forum=ci.MN.isZH?Ae.forumZH:Ae.forum;this.doc=ci.MN.isZH?Ae.docZH:Ae.doc}},g=new ui;var ih=C(T());var So=C(T()),Ve=C(T());var $e=C(T());var wp=C(T());var vi=C(T()),Zu=C(T()),mn=C(Ei());var Ju=[{version:{from:"4.0.0",to:">=4.0.6"},global:{addon:{quickSwitch:e=>e.map(t=>t+1),panelPosition:e=>[e[0]>=1?e[0]+2:e[0]],cardAction:e=>{let t=e[0],r=t;return t>=5&&(r+=2),t>=18&&(r+=2),[r]},textAction:e=>[e[0]>=10?e[0]+1:e[0]]},autoformat:{preset:e=>e.map(t=>t>1?t-1:t)}}},{version:{from:"4.0.6 - 4.0.9",to:">=4.0.10"},global:{addon:{removeExcerpt:e=>[e[0]===2?0:e[0]]}}},{version:{from:"4.0.10",to:">=4.0.11"},global:{autocomment:{preset:e=>e.filter(t=>t!==1)}}},{version:{from:"4.0.11 - 4.0.13",to:">=4.0.14"},global:{addon:{cardAction:e=>[e[0]>0?e[0]+1:e[0]],textAction:e=>[e[0]>0?e[0]+1:e[0]]}}},{version:{from:"4.0.14 - 4.0.15",to:">=4.0.16"},global:{addon:{cardAction:e=>[e[0]>=56?e[0]+1:e[0]]}}},{version:{from:"4.0.16",to:">=4.1.0"},global:{addon:{panelControl:e=>e.filter(t=>t!==1).map(t=>t>1?t-1:t),textAction:e=>[e[0]===2?3:e[0]===3?2:e[0]]}}}];function Kt(e){var t;try{let r=e.replace("marginnote3app://note/","");if(r===e)return e;let o=Zu.MN.db.getNoteById(r);if(o&&((t=o.childNotes)==null?void 0:t.length)){let n=o.childNotes.reduce((i,s)=>{if(s.comments.length){let l=s.comments[0];if(s.colorIndex!==13&&l.type==="TextNote"&&l.text)return[...i,l.text]}return i},[]);if(n.length)return n.join(";")}}catch(r){vi.dev.error(r);return}}function Qu(e,t){var r;for(let[o,n]of Object.entries(e))for(let[i,s]of Object.entries(n))if(((r=t==null?void 0:t[o])==null?void 0:r[i])===void 0)return!0;return!1}var Vt={to(e){var t;return[e[0],(t=e[5])!=null?t:"",e[e.length-1]]},tell(e,t){let[r,o,n]=e;return t[0]===r&&t[5]===(o===""?void 0:o)&&t[t.length-1]===n}};function Se(e,t){function r(n,i,s,l){var a;if(((a=n[i])==null?void 0:a[s])!==void 0)n[i][s]=l(n[i][s],n);else if(s==="cardAction")n.gesture&&["single","muilt"].forEach(c=>["Up","Down","Left","Right"].forEach(u=>{n.gesture[`${c}BarSwipe${u}`]=l(n.gesture[`${c}BarSwipe${u}`],n)})),n.shortcut&&Array.from({length:8}).forEach((c,u)=>{n.shortcut[`cardShortcut${u}`]=l(n.shortcut[`cardShortcut${u}`],n)});else if(s==="textAction")n.gesture&&["Up","Down","Left","Right"].forEach(c=>{n.gesture[`selectionBarSwipe${c}`]=l(n.gesture[`selectionBarSwipe${c}`],n)}),n.shortcut&&Array.from({length:4}).forEach((c,u)=>{n.shortcut[`textShortcut${u}`]=l(n.shortcut[`textShortcut${u}`],n)});else return!1;return!0}let{lastVersion:o}=g;return Ju.forEach(n=>{(function(){var c,u;let{version:i,global:s,doc:l,notebook:a}=n;if(mn.default.satisfies(o,i.from)&&mn.default.satisfies(g.version,i.to))switch(o=mn.default.minVersion(n.version.to).version,e){case 0:if(l){let p=Object.values(t);for(let[f,h]of Object.entries(l))for(let[d,y]of Object.entries(h))for(let E of p)if(((c=E[f])==null?void 0:c[d])!==void 0)E[f][d]=y(E[f][d],E);else return}break;case 1:if(s){for(let[p,f]of Object.entries(s))for(let[h,d]of Object.entries(f))for(let y of t)if(!r(y,p,h,d))return}break;case 2:if(s){vi.dev.assert(t);for(let[p,f]of Object.entries(s))for(let[h,d]of Object.entries(f))if(!r(t,p,h,d))return}break;case 3:if(a){let p=Object.values(t);for(let[f,h]of Object.entries(a))for(let[d,y]of Object.entries(h))for(let E of p)if(((u=E[f])==null?void 0:u[d])!==void 0)E[f][d]=y(E[f][d],E);else return}break}})()}),t}var pp=C(T());var dt=C(T()),gn=C(T());function mt(e=self.globalProfile.addon.panelHeight[0],t=self.globalProfile.addon.panelPosition[0]){let{studyController:r}=dt.MN,o=r.readerController.view;self.panel.lastReaderViewWidth=o.frame.width;let n=r.view.bounds,i=300,s=[600,450,300][e],u=[()=>{let p=o.hidden;if(r.rightMapMode){let f=o.frame.width-i-40;return f<50||p?50:f}else{let f=n.width-o.frame.width+40;return f>n.width-i-50||p?n.width-i-50:f}},()=>{let p=o.hidden;if(r.rightMapMode){let f=o.frame.width-i/2;return f<50||p?50:f>n.width-i-50?n.width-i-50:f}else{let f=n.width-o.frame.width-i/2;return f>n.width-i-50||p?n.width-i-50:f<50?50:f}},()=>{let p=o.hidden;if(r.rightMapMode){let f=o.frame.width+40;return f<50||p?50:f>n.width-i-50?n.width-i-50:f}else{let f=n.width-o.frame.width-i-40;return f>n.width-i-50||p?n.width-i-50:f<50?50:f}},()=>50,()=>(n.width-i)/2,()=>n.width-i-50][t]();self.settingViewController.view.frame={x:u,y:dt.MN.isMNE?150:110,height:s,width:i}}function hr(){!self.panel.status||(self.settingViewController.view.removeFromSuperview(),self.panel.status=!1,dt.MN.studyController.refreshAddonCommands())}function ep(){if(self.panel.status)return;let{studyController:e}=dt.MN;e.view.addSubview(self.settingViewController.view),self.panel.status=!0,e.refreshAddonCommands(),self.panel.lastOpenPanel=Date.now(),(0,gn.delay)(.2).then(()=>void e.view.becomeFirstResponder())}function so(){if(self.panel.status)hr();else if(self.globalProfile.addon.panelControl.includes(0)){let e=Date.now();self.panel.lastClickButton&&e-self.panel.lastClickButton<300?ep():self.panel.lastClickButton=e}else ep()}function sx(e){e==dt.MN.studyController&&(!self.panel.status||(Date.now()-self.panel.lastOpenPanel<200||self.panel.lastReaderViewWidth!==dt.MN.studyController.readerController.view.frame.width&&[0,1,2].includes(self.globalProfile.addon.panelPosition[0]))&&mt())}function lx(){return dt.MN.studyController.studyMode!==gn.StudyMode.review&&dt.MN.currnetNotebookid&&dt.MN.currentDocmd5?{image:"logo.png",object:self,selector:"switchPanel:",checked:self.panel.status}:null}var rp={queryAddonCommandStatus:lx,switchPanel:so,controllerWillLayoutSubviews:sx};var It="\u2E80-\u2EFF\u2F00-\u2FDF\u3040-\u309F\u30A0-\u30FA\u30FC-\u30FF\u3100-\u312F\u3200-\u32FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF",yn=new RegExp(`([${It}])`,"g"),bn=e=>/^[\u0000-\u00ff]*$/.test(e),$i=e=>yn.test(e),gt=e=>!$i(e),lo={Cyrillic:e=>/\p{sc=Cyrillic}/u.test(e),Latin:e=>/\p{sc=Latin}/u.test(e),CJK:e=>yn.test(e),Han:e=>/\p{sc=Han}/u.test(e),Janpanese:e=>/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff]/u.test(e),Korea:e=>/\p{sc=Hangul}/u.test(e)};function kr(e){var o;let t=e.split(new RegExp(`[^\\p{L}0-9\\-'.]|[${It}]`,"u")).reduce((n,i)=>(i&&(/\D\.\D/.test(i)?n.push(...i.split(".")):n.push(i)),n),[]),r=(o=e.match(new RegExp(`[${It}]`,"g")))!=null?o:[];return t.length+r.length}function Nr(e){return Array.from(e).reduce((t,r)=>(t+=r.charCodeAt(0)>255?2:1,t),0)}function op(e,t,...r){let o=[t,...r].map(n=>(n<0&&(n=Nr(e)+n),n===0||n===1?n:Array.from(e).reduce((i,s,l)=>{let a=i.byte+(s.charCodeAt(0)>255?2:1);return!i.enough&&a<=n?i={index:l,byte:a,enough:!1}:i={...i,enough:!0},i},{index:0,byte:0,enough:!1}).index+1));return e.slice(...o)}function np(e,t){let{str:r,segments:o}=Array.from(e).reduce((n,i)=>{let s=n.byte+(i.charCodeAt(0)>255?2:1);if(s>t)return{str:i,segments:[...n.segments,n.str],byte:i.charCodeAt(0)>255?2:1};let l=n.str+i;return s===t?{str:"",segments:[...n.segments,l],byte:0}:{str:l,segments:n.segments,byte:s}},{str:"",segments:[],byte:0});return r===""?o:[...o,r]}var lp=C(T());var ip=C(T()),ot=(0,ip.i18n)({zh:{no_profile_in_card:"\u81EA\u5B9A\u4E49\u5185\u5BB9\u8BFB\u53D6\u5931\u8D25",input_number:"\u8BF7\u8F93\u5165\u6570\u5B57",input_integer:"\u8BF7\u8F93\u5165\u6574\u6570",parse_error:"\u5B57\u7B26\u4E32\u89E3\u6790\u9519\u8BEF\uFF0C\u8BF7\u6CE8\u610F\u5B57\u7B26\u8F6C\u4E49\u95EE\u9898",input_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570",not_support_symbol:"\u4E0D\u652F\u6301\u8BE5\u7B26\u53F7",no_item:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u5143\u7D20\uFF0C\u5E76\u4E14\u7B2C\u4E00\u4E2A\u5143\u7D20\u5FC5\u987B\u662F\u5B57\u7B26",require_number:"\u5FC5\u987B\u8F93\u5165\u6570\u5B57\u548C\u5355\u4E2A\u5B57\u7B26",ban_1:'\u7981\u6B62\u4F7F\u7528 "//"',ban_2:'\u7981\u6B62\u4F7F\u7528 "/./" \uFF0C\u8BF7\u4F7F\u7528 "/^.+$/gs" \u6765\u8FDB\u884C\u4EFB\u610F\u975E\u7A7A\u5339\u914D',not_support_format:"\u4E0D\u7B26\u5408\u8F93\u5165\u683C\u5F0F\u8981\u6C42",not_mnlink:"\u4E0D\u662F MN \u7684\u5361\u7247\u94FE\u63A5",not_exist:"\u5361\u7247\u4E0D\u5B58\u5728"},en:{no_profile_in_card:"Failed to read custom content",input_number:"Please enter a number",parse_error:"String parsing error, please note character escape problems",input_integer:"Please enter an integer",input_positive:"Please enter a positive integer",not_support_symbol:"Symbol not supported",ban_1:'Do not use "//"',ban_2:'Do not use "/./" , please use "/^.+$/gs" to match any non-empty',no_item:"There must be elements in the array, and the first element must be a character",require_number:"You must enter a number and a single character",not_support_format:"Does not meet the input format requirements",not_mnlink:"Not a MN card link",not_exist:"Card does not exist"}});function M(e,t=!1){try{return JSON.parse(t?`"${e}"`:e)}catch(r){throw lp.dev.error(r),ot.parse_error}}function ce(e){return e.replace(/"/g,'\\"')}var sp=e=>/^[0-9]+$/.test(e);function xe(e){let t=e.split(/\s*;\s*(?=\()/),r=[];for(let o of t){let[n,i,s]=o.replace(/\((\/.*\/[gimsuy]*)\x20*,\x20*"(.*")\x20*\)?/,'$1orogxng"$2').replace(/"\x20*,\x20*(\d)\)/g,'"orogxng$1').split("orogxng");if(s&&!sp(s)||!s&&sp(i))throw"invalid replace param";r.push({regexp:ap(n),newSubStr:M(i),fnKey:s?Number(s):0})}return r}function ap(e){if(e=e.trim(),e.startsWith("//"))throw ot.ban_1;if(e.startsWith("/./"))throw ot.ban_2;if(!e.startsWith("/"))return new RegExp(ax(e));let t=e.match(/^\/(.+?)\/([gimsuy]*)$/);if(!t)throw"";return new RegExp(t[1],t[2])}function ax(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Ht(e){if(/^\(.+\)$/.test(e))throw"";return e.split(/\s*;\s*(?=(?:\[\s*\/|\/\s*[^\]gimsuy,]))/).map(r=>r.replace(/^\s*\[(.+?)\]\s*$/,"$1").split(/\s*,\s*(?=\/[^\s,gimsuy]+)/).map(o=>ap(o)))}var Pt={add(e,t){return e.flags.includes(t)?e:new RegExp(e.source,e.flags+t)},remove(e,t){return e.flags.includes(t)?new RegExp(e.source,e.flags.replace(t,"")):e}};function ao(e,t){return Rt(t.reduce((r,{newSubStr:o,regexp:n})=>(n=Pt.add(n,"g"),n.test(e)&&r.push(...e.match(n).map(i=>i.replace(n,o))),r),[]))}var Be={hollow_circle_number:"\u2460\u2461\u2462\u2463\u2464\u2465\u2466\u2467\u2468\u2469\u246A\u246B\u246C\u246D\u246E\u246F\u2470\u2471\u2472\u2473\u3251\u3252\u3253\u3254\u3255\u3256\u3257\u3258\u3259\u325A\u325B\u325C\u325D\u325E\u325F\u32B1\u32B2\u32B3\u32B4\u32B5\u32B6\u32B7\u32B8\u32B9\u32BA\u32BB\u32BC\u32BD\u32BE\u32BF",solid_circle_number:"\u2776\u2777\u2778\u2779\u277A\u277B\u277C\u277D\u277E\u277F\u24EB\u24EC\u24ED\u24EE\u24EF\u24F0\u24F1\u24F2\u24F3\u24F4",capital_letter:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase_letter:"abcdefghijklmnopqrstuvwxyz",chinese_capital_number:"\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396\u62FE",chinese_number:"\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341",greek_capital_number:"\u2160\u2161\u2162\u2163\u2164\u2165\u2166\u2167\u2168\u2169",greek_number:"\u2170\u2171\u2172\u2173\u2174\u2175\u2176\u2177\u2178\u2179"};function cx(e,t,r=1){let o=Object.values(Be).filter(s=>s.includes(e))[0];if(!o)throw"";let n=[],i=o.search(e);for(let s=i,l=i+t*r-1;s<=l;s=s+r)n.push(o[s%o.length]);return n}function ux(e,t,r=1,o=0){let n=[];for(let i=e,s=e+t*r-1;i<=s;i=i+r)n.push(String(i).padStart(o,"0"));return n}function yt(e,t,r="%"){let o=M(e.replace(new RegExp(`^.*${r}(\\[.+\\]).*$`),"$1").replace(/'/g,'"')),n=o.length;if(n==0||typeof o[0]!="string")throw ot.no_item;if(n==1||n==2&&typeof o[1]=="number"){let i=n==1?1:o[1],s=o[0];if(/^[0-9]+$/.test(s))return ux(Number(s),t,i,s.length);if(s.length===1)return cx(s,t,i);throw ot.require_number}else{if(n>1&&o.every(i=>typeof i=="string"))return o;throw ot.not_support_format}}function cp(e,t){if(/^[0-9]+$/.test(e))return String(Number(e)+t).padStart(e.length,"0");let r=Object.values(Be).filter(i=>i.includes(e))[0];if(!r)throw ot.not_support_symbol;let o=r.length,n=r.search(e);return r[(n+t)%o]}var px=C(T());function Xe(e){M(`${ce(e)}`,!0)}function ki(e){for(let t of Ht(e).flat())t.test("test")}function co(e){let t=Kt(e);if(!t)throw ot.no_profile_in_card;ki(t)}function At(e){for(let t of xe(e))"test".replace(t.regexp,t.newSubStr)}function bt(e){let t=Kt(e);if(!t)throw ot.no_profile_in_card;At(t)}var he=e=>JSON.parse(JSON.stringify(e)),Rt=e=>e.length<=1?e:Array.from(new Set(e));function Ir(e,t="YYYY-mm-dd HH:MM"){let r,o={"Y+":e.getFullYear().toString(),"m+":(e.getMonth()+1).toString(),"d+":e.getDate().toString(),"H+":e.getHours().toString(),"M+":e.getMinutes().toString(),"S+":e.getSeconds().toString()};return Object.entries(o).forEach(([n,i])=>{r=new RegExp("("+n+")").exec(t),r&&(t=t.replace(r[1],r[1].length==1?i:i.padStart(r[1].length,"0")))}),t}function up(e,t=!1){return t?/\w+:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e):/^\w+:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]$/.test(e)}function S(e,t){return`${g.doc}/guide/modules/${e}.html${t?"#"+t:""}`}function Ni(e,t){let r=hp.includes(e)?Kt(t):t;if(e in self.tempProfile.regArray){let o;try{o=r?Ht(r):void 0}catch{o=void 0}self.tempProfile.regArray[e]=o}else if(e in self.tempProfile.replaceParam){let o;try{o=r?xe(r):void 0}catch{o=void 0}self.tempProfile.replaceParam[e]=o}}function uo(e,t){var r,o,n,i,s,l;for(let[a,c]of Object.entries(e))if(a==="additional")for(let[u,p]of Object.entries(c))c[u]=he((o=(r=t==null?void 0:t[a])==null?void 0:r[u])!=null?o:p);else for(let[u,p]of Object.entries(c)){if(!((i=(n=nt)==null?void 0:n[a])!=null&&i[u]))continue;let[f,h]=nt[a][u],d=(l=(s=t==null?void 0:t[a])==null?void 0:s[u])!=null?l:p;switch(typeof d){case"boolean":self.dataSource[f].rows[h].status=d,c[u]=d;break;case"string":self.dataSource[f].rows[h].content=d,c[u]=d,Ni(u,d);break;default:Array.isArray(d)&&(self.dataSource[f].rows[h].selections=[...d],c[u]=[...d])}}}function fp(){var e;(e=self.settingViewController.tableView)==null||e.reloadData(),mt(),pp.dev.log("Refresh Panel","profile")}var Pr={addon:{quickSwitch:[],lockExcerpt:!1,dragMerge:[1],hasTitleThen:[1],removeExcerpt:[0],panelControl:[],panelPosition:[0],panelHeight:[1],autoBackup:!1,backupID:""},magicaction4card:{smartSelection:!1,defaultMergeText:'%["1"]. $&\\n\\n'},magicaction4text:{showCopyContent:!1,noteOptions:[]},gesture:{showY:!1,selectionBarY:"[0, 70]",singleBarSwipeUpShortcut:"",singleBarSwipeDownShortcut:"",singleBarSwipeRightShortcut:"",singleBarSwipeLeftShortcut:"",muiltBarSwipeUpShortcut:"",muiltBarSwipeDownShortcut:"",muiltBarSwipeRightShortcut:"",muiltBarSwipeLeftShortcut:"",selectionBarSwipeUpShortcut:"",selectionBarSwipeDownShortcut:"",selectionBarSwipeRightShortcut:"",selectionBarSwipeLeftShortcut:"",singleBarSwipeUp:[0],singleBarSwipeDown:[0],singleBarSwipeRight:[0],singleBarSwipeLeft:[0],muiltBarSwipeUp:[0],muiltBarSwipeDown:[0],muiltBarSwipeRight:[0],muiltBarSwipeLeft:[0],selectionBarSwipeUp:[0],selectionBarSwipeDown:[0],selectionBarSwipeRight:[0],selectionBarSwipeLeft:[0]},shortcut:{shortcutPro:!1,cardShortcut0:[0],cardShortcut1:[0],cardShortcut2:[0],cardShortcut3:[0],cardShortcut4:[0],cardShortcut5:[0],cardShortcut6:[0],cardShortcut7:[0],textShortcut0:[0],textShortcut1:[0],textShortcut2:[0],textShortcut3:[0]},autocomplete:{on:!1,fillWordInfo:[0],dataSource:[0],customFillFront:"{{#phonetic}}\u{1F508}[{{phonetic}}] {{/phonetic}} {{collins}}{{#tags}}\\n\u{1F3F7} {{tags}}{{/tags}}",customFill:"\u270D\u{1F3FB}\\n{{zh}}\\n\u{1F440}",selectLemma:!1,selectMeanings:[],autoContext:!1,translateContext:!1,collins:[0,1,2,3,4,5]},autoformat:{on:!1,preset:[],customFormat:"",formatTitle:!1},anotherautotitle:{on:!1,preset:[],wordCount:"[10, 5]",customBeTitle:""},anotherautodef:{on:!1,preset:[],toTitleLink:!1,titleLinkSplit:[1],customTitleSplit:"",customDefLink:"",customExtractTitle:""},autolist:{on:!1,preset:[],customList:""},autoreplace:{on:!1,preset:[],customReplace:""},autosimplify:{variant:[0],taiwanIdiom:!0,customSimplify:'(/\u58F9/g, "\u4E00"); (/\u59B3/g, "\u4F60")'},autotag:{on:!1,preset:[],customTag:""},autocomment:{on:!1,preset:[],customComment:""},autostyle:{on:!1,preset:[],wordCountArea:"[10, 5, 10]",showArea:!1,defaultTextExcerptColor:[0],defaultPicExcerptColor:[0],defaultTextExcerptStyle:[0],defaultPicExcerptStyle:[0]},copysearch:{multipleTitles:[0],multipleExcerpts:[0],customContent:"[{{titles.0}}]({{url.pure}})",customSearchContent:"[{{titles.0}}]({{url.pure}})",showSearchEngine:!1,modifySymbols:'%["1"]. $&\\n\\n',whichPartofCard:[0],searchChineseText:"https://www.bing.com/search?q={{keyword}}&ensearch=0",searchEnglishText:"https://www.bing.com/search?q={{keyword}}&ensearch=1",searchAcademic:"https://scholar.google.com.hk/scholar?q={{keyword}}",searchQuestion:"https://www.zhihu.com/search?q={{keyword}}",searchWord:"eudic://dict/{{keyword}}",searchTranslation:"https://www.deepl.com/zh/translator#en/zh/{{keyword}}",searchOtherText:""},autoocr:{baiduSecretKey:"",baiduApiKey:"",lang:[0],formulaOCRProviders:[0],markdown:[2],mathpixAppKey:"",showKey:!0},autotranslate:{on:!1,wordCount:"[10, 5]",baiduSecretKey:"",baiduAppID:"",baiduThesaurus:!1,baiduAdvance:!1,translateProviders:[0],caiyunToken:"",showKey:!0,baiduFromLang:[2],caiyunFromLang:[2],baiduToLang:[0],caiyunToLang:[0]},additional:{lastVision:g.version,autoocr:{lastGetToken:0,baiduToken:""}}},dr={magicaction4text:{preOCR:!1,preSimplify:!1,preFormat:!1},autoocr:{on:!1,lang:[0]},autoformat:{removeSpace:!1},autosimplify:{on:!1},additional:{needOCRWait:!0}},mr={addon:{profile:[0]},additional:{cacheTitle:{},cacheComment:{},cacheTag:{}}},xn={replaceParam:{customTag:[],customComment:[],customList:[],customReplace:[],customExtractTitle:[],customSimplify:[],customFormat:[]},regArray:{customTitleSplit:[],customBeTitle:[],customDefLink:[]}},hp=[...Object.keys(xn.regArray),...Object.keys(xn.replaceParam)];var yp=C(T()),B=C(T()),bp=C(Ei());var zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ii(e){let t="",r=0,o,n,i,s,l,a,c;for(e=fx(e);r<e.length;)o=e.charCodeAt(r++),n=e.charCodeAt(r++),i=e.charCodeAt(r++),s=o>>2,l=(o&3)<<4|n>>4,a=(n&15)<<2|i>>6,c=i&63,Number.isNaN(n)?a=c=64:Number.isNaN(i)&&(c=64),t=t+zt.charAt(s)+zt.charAt(l)+zt.charAt(a)+zt.charAt(c);return t}function dp(e){let t="",r=0,o,n,i,s,l,a,c;for(;r<e.length;)s=zt.indexOf(e.charAt(r++)),l=zt.indexOf(e.charAt(r++)),a=zt.indexOf(e.charAt(r++)),c=zt.indexOf(e.charAt(r++)),o=s<<2|l>>4,n=(l&15)<<4|a>>2,i=(a&3)<<6|c,t=t+String.fromCharCode(o),a!=64&&(t=t+String.fromCharCode(n)),c!=64&&(t=t+String.fromCharCode(i));return t=hx(t),t}function fx(e){let t="";for(let r=0;r<e.length;r++){let o=e.charCodeAt(r);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(o&63|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(o&63|128))}return t}function hx(e){let t="",r=0,o=0,n=0,i=0;for(;r<e.length;)o=e.charCodeAt(r),o<128?(t+=String.fromCharCode(o),r++):o>191&&o<224?(n=e.charCodeAt(r+1),t+=String.fromCharCode((o&31)<<6|n&63),r+=2):(n=e.charCodeAt(r+1),i=e.charCodeAt(r+2),t+=String.fromCharCode((o&15)<<12|(n&63)<<6|i&63),r+=3);return t}var mp=C(T()),L=(0,mp.i18n)({zh:{note_title:`${g.title} \u914D\u7F6E`,note_content:(e,t,r)=>`\u{1F6AB} \u8BF7\u52FF\u4FEE\u6539
\u8303\u56F4\uFF1A${e}
${r?"\u6A21\u5757\uFF1A"+r+`
`:""}\u7248\u672C\uFF1A${g.version}
\u65F6\u95F4\uFF1A${t}`,one_module_global:(e,t)=>`\u68C0\u6D4B\u5230\u5168\u5C40\u914D\u7F6E ${e}\uFF0C\u53EA\u5305\u62EC\u6A21\u5757 ${t}\uFF0C\u5199\u5165\u5230\u54EA\u4E00\u5957\u5168\u5C40\u914D\u7F6E\u4E2D\uFF1F`,profile_management:`${g.title} \u914D\u7F6E\u7BA1\u7406`,detecte_doc_profile:"\u68C0\u6D4B\u5230\u6587\u6863\u914D\u7F6E\uFF0C\u8BFB\u53D6\u540E\u4F1A\u8986\u76D6\u5F53\u524D\u914D\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",detecte_notebook_profile:"\u68C0\u6D4B\u5230\u7B14\u8BB0\u672C\u914D\u7F6E\uFF0C\u8BFB\u53D6\u540E\u4F1A\u8986\u76D6\u5F53\u524D\u914D\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",detecte_all_profile:"\u68C0\u6D4B\u5230\u6240\u6709\u914D\u7F6E\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u90E8\u5206\u5BFC\u5165",detecte_all_notebook_profile:"\u68C0\u6D4B\u5230\u6240\u6709\u5168\u5C40\u914D\u7F6E\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u90E8\u5206\u5BFC\u5165",detecte_global_profile:e=>e?`\u68C0\u6D4B\u5230\u5168\u5C40\u914D\u7F6E ${e}\uFF0C\u5305\u542B\u6240\u6709\u6A21\u5757\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u6A21\u5757\u914D\u7F6E\u5BFC\u5165`:"\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u6A21\u5757\u914D\u7F6E\u5BFC\u5165",which_part_profile:"\u60F3\u8981\u5199\u5165\u54EA\u90E8\u5206\u7684\u914D\u7F6E?",which_module_profile_write:"\u60F3\u8981\u5199\u5165\u54EA\u4E2A\u6A21\u5757\u7684\u914D\u7F6E?",which_global_profile_read_into:"\u60F3\u8981\u8BFB\u53D6\u8FDB\u54EA\u4E00\u5957\u5168\u5C40\u914D\u7F6E\u91CC?",parse_failed:"\u89E3\u6790\u5931\u8D25\uFF0C\u53EF\u80FD\u88AB\u4FEE\u6539",all_modules:"\u6240\u6709\u6A21\u5757",no_children:"\u8BE5\u5361\u7247\u6CA1\u6709\u5B50\u5361\u7247",success:"\u8BFB\u53D6\u6210\u529F",fail:"\u8BFB\u53D6\u5931\u8D25",profile_reset:"\u914D\u7F6E\u5DF2\u91CD\u7F6E",profile_sync:"\u914D\u7F6E\u5DF2\u540C\u6B65",old_version:"\u8B66\u544A\uFF1A\u5BFC\u5165\u7684\u914D\u7F6E\u7248\u672C\u6BD4\u5F53\u524D\u63D2\u4EF6\u7248\u672C\u65B0\uFF0C\u53EF\u80FD\u4F1A\u51FA\u73B0\u95EE\u9898\uFF0C\u8BF7\u8C28\u614E\u5BFC\u5165",not_this_profile:`\u4E0D\u662F ${g.title} \u7684\u914D\u7F6E`,range:{all_profile:"\u6240\u6709\u914D\u7F6E",global_profile:"\u5168\u5C40\u914D\u7F6E",all_global_profile:"\u6240\u6709\u5168\u5C40\u914D\u7F6E",doc_profile:"\u6587\u6863\u914D\u7F6E",notebook_profile:"\u7B14\u8BB0\u672C\u914D\u7F6E"},$profile_select_items9:["\u6240\u6709\u914D\u7F6E","\u5168\u5C40\u914D\u7F6E 1","\u5168\u5C40\u914D\u7F6E 2","\u5168\u5C40\u914D\u7F6E 3","\u5168\u5C40\u914D\u7F6E 4","\u5168\u5C40\u914D\u7F6E 5","\u6240\u6709\u5168\u5C40\u914D\u7F6E","\u6587\u6863\u914D\u7F6E","\u7B14\u8BB0\u672C\u914D\u7F6E"],$global_profile_items5:["\u5168\u5C40\u914D\u7F6E 1","\u5168\u5C40\u914D\u7F6E 2","\u5168\u5C40\u914D\u7F6E 3","\u5168\u5C40\u914D\u7F6E 4","\u5168\u5C40\u914D\u7F6E 5"]},en:{note_title:`${g.title} Profile`,note_content:(e,t)=>`\u{1F6AB} Do Not Modify
Range: ${e}
${module?"Module: "+module+`
`:""}Version: ${g.version}
Time: ${t}`,one_module_global:(e,t)=>`Global profile ${e} was detected, including module ${t} only, and which global profile was written to?`,profile_management:`${g.title} Profile Management`,profile_sync:"Profile has been synced",which_part_profile:"Which part of the profile do you want to write?",which_global_profile_read_into:"Which global profile do you want to read into?",which_module_profile_write:"Which module do you want to write?",parse_failed:"Parse failed, maybe modified",detecte_doc_profile:"Detected document profile, reading will overwrite the current profile, continue?",detecte_notebook_profile:"Detected notebook profile, reading will overwrite the current profile, continue?",detecte_all_profile:"Detected all profile, you can choose one part you need to import",detecte_all_notebook_profile:"Detected all notebook profile, you can choose one part you need to import",all_modules:"All Modules",success:"Read successfully",profile_reset:"Profile has been reset",fail:"Read failed",old_version:"Warning: The imported profile version is newer than the current plugin version, which may cause problems. Please import it with caution.",not_this_profile:`Not ${g.title}'s profile`,detecte_global_profile:e=>e?`Detected global profile ${e}, including all modules, you can choose one module you need to import`:"You can choose one module you need to import",range:{all_profile:"All Profile",global_profile:"Global Profile",all_global_profile:"All Global Profile",doc_profile:"Doc Profile",notebook_profile:"Notebook Profile"},$profile_select_items9:["All Profile","Global Profile 1","Global Profile 2","Global Profile 3","Global Profile 4","Global Profile 5","All Global Profile","Doc Profile","Notebook Profile"],$global_profile_items5:["Global Profile 1","Global Profile 2","Global Profile 3","Global Profile 4","Global Profile 5"],no_children:"This card has no child card."}});function Pi(){NSUserDefaults.standardUserDefaults().removeObjectForKey(g.globalProfileKey),NSUserDefaults.standardUserDefaults().removeObjectForKey(g.docProfileKey),NSUserDefaults.standardUserDefaults().removeObjectForKey(g.notebookProfileKey)}async function Ri(e,t=!0){let{childNotes:r}=e;if(!(r!=null&&r.length))return;let o,n,i;if(t)n=L.range.all_profile,o=Ii(JSON.stringify({key:g.key,version:g.version,profiles:{allDocProfileTemp:self.allDocProfile,allGlobalProfileTemp:self.allGlobalProfile,allNotebookProfileTemp:self.allNotebookProfile}}));else{let a=await(0,B.selectIndex)(L.$profile_select_items9,L.profile_management,L.which_part_profile,!0);if(a===-1)return;let c=await(async()=>{switch(a){case 0:return{allDocProfileTemp:self.allDocProfile,allGlobalProfileTemp:self.allGlobalProfile,allNotebookProfileTemp:self.allNotebookProfile};case 1:case 2:case 3:case 4:case 5:{let u=[L.all_modules,...Ot.name],p=await(0,B.selectIndex)(u,L.profile_management,L.which_module_profile_write);return i=u[p],p===0?{allGlobalProfileTemp:{[a-1]:self.allGlobalProfile[a-1]}}:{allGlobalProfileTemp:{[a-1]:{[Ot.key[p-1]]:self.allGlobalProfile[a-1][Ot.key[p-1]]}}}}case 6:return{allGlobalProfileTemp:self.allGlobalProfile};case 7:return{allDocProfileTemp:self.allDocProfile};default:return{allNotebookProfileTemp:self.allNotebookProfile}}})();n=L.$profile_select_items9[a],o=Ii(JSON.stringify({key:g.key,version:g.version,profiles:c}))}let s=o.length,l=Math.ceil(s/r.length);(0,B.undoGroupingWithRefresh)(()=>{e.noteTitle=L.note_title,e.excerptText=L.note_content(n,Ir(new Date),i);for(let a=0,c=0;a<s;a+=l,c++)r[c].excerptText=o.slice(a,a+l),r[c].noteTitle=String(c+1)})}async function dx(e){var t,r,o;try{if(!B.MN.currentDocmd5||!B.MN.currnetNotebookid)return;if(!((t=e.childNotes)!=null&&t.length))throw L.no_children;async function n(c,u){let p=Object.keys(c),f=Ot.key.filter(d=>p.includes(d)),h=f.map(d=>Ot.name[Ot.key.indexOf(d)]);if(f.length===1){let d=await(0,B.selectIndex)(L.$global_profile_items5,L.profile_management,L.one_module_global(u,Ot.name[Ot.key.indexOf(f[0])]),!0);return d===-1?void 0:{index:d,profile:{...self.allGlobalProfile[d],...Se(2,c)}}}else{let d=await(0,B.selectIndex)([L.all_modules,...h],L.profile_management,L.detecte_global_profile(u)),y=await(0,B.selectIndex)(L.$global_profile_items5,L.profile_management,L.which_global_profile_read_into,!0);return y===-1?void 0:{index:y,profile:d===0?Se(2,c):{...self.allGlobalProfile[y],...Se(2,{[f[d-1]]:c[f[d-1]]})}}}}let i=e.childNotes.map(c=>({text:c.excerptText,title:c.noteTitle})).sort((c,u)=>Number(c.title)-Number(u.title)).reduce((c,u)=>(c+=u.text,c),""),s=(()=>{try{return JSON.parse(dp(i))}catch{throw L.parse_failed}})();if(s.key!==void 0&&s.key!==g.key)throw L.not_this_profile;let l=(r=s.profiles)!=null?r:s;g.lastVersion=(o=s.version)!=null?o:"4.0.0",bp.default.gt(g.lastVersion,g.version)&&(0,B.showHUD)(L.old_version);let a=Object.keys(l);if(a.length===3){let{allDocProfileTemp:c,allGlobalProfileTemp:u,allNotebookProfileTemp:p}=l,f=await(0,B.selectIndex)(L.$profile_select_items9,L.profile_management,L.detecte_all_profile,!0);if(f===-1)return;switch(f){case 0:self.allGlobalProfile=Se(1,u),self.allDocProfile=Se(0,c),self.allNotebookProfile=Se(3,p);break;case 1:case 2:case 3:case 4:case 5:{let h=await n(u[f-1]);if(h)self.allGlobalProfile[h.index]=h.profile;else return;break}case 6:self.allGlobalProfile=Se(1,u);break;case 7:self.allDocProfile=Se(0,c);break;case 8:self.allNotebookProfile=Se(3,p);break}}else if(a.length===1){let c=a[0];if(c==="allDocProfileTemp")if(await(0,B.confirm)(L.profile_management,L.detecte_doc_profile))self.allDocProfile=Se(0,l[c]);else return;else if(c==="allGlobalProfileTemp"){let u=l[c];if(Array.isArray(u)){let p=await(0,B.selectIndex)([L.range.all_global_profile,...L.$global_profile_items5],L.profile_management,L.detecte_all_notebook_profile,!0);if(p===-1)return;if(p===0)self.allGlobalProfile=Se(1,u);else{let f=await n(u[p-1]);if(f)self.allGlobalProfile[f.index]=f.profile;else return}}else{let p=Object.keys(u)[0],f=await n(u[0],Number(p)+1);if(f)self.allGlobalProfile[f.index]=f.profile;else return}}else if(c==="allNotebookProfileTemp")if(await(0,B.confirm)(L.profile_management,L.detecte_notebook_profile))self.allNotebookProfile=Se(3,l[c]);else return}else throw"";self.allGlobalProfile.forEach(c=>{c.additional.lastVision=g.version}),(0,B.setLocalDataByKey)(self.allNotebookProfile,g.notebookProfileKey),(0,B.setLocalDataByKey)(self.allGlobalProfile,g.globalProfileKey),(0,B.setLocalDataByKey)(self.allDocProfile,g.docProfileKey),pt({range:0,docmd5:B.MN.currentDocmd5,notebookid:B.MN.currnetNotebookid}),mt(),(0,B.showHUD)(L.success)}catch(n){yp.dev.error(n),(0,B.showHUD)(`${L.fail}\uFF1A${n}`)}}async function Ai(e,t){if(!(!B.MN.currentDocmd5||!B.MN.currnetNotebookid))switch(t){case 0:dx(e.note);break;case 1:e.childNodes.length?(Dt({range:0,docmd5:B.MN.currentDocmd5,notebookid:B.MN.currnetNotebookid}),Ri(e.note,!1)):(0,B.showHUD)(L.no_children);break;case 2:Pi(),pt({range:0,docmd5:B.MN.currentDocmd5,notebookid:B.MN.currnetNotebookid}),(0,B.showHUD)(L.profile_reset);break;case 3:pt({range:0,docmd5:B.MN.currentDocmd5,notebookid:B.MN.currnetNotebookid}),(0,B.showHUD)(L.profile_sync);break}}var Ie=C(T()),de=C(T());var pt=({range:e,notebookid:t,docmd5:r,profileNO:o})=>{var n;try{let i=a=>{uo(self.globalProfile,self.allGlobalProfile[a]),Ie.dev.log("Read current global profile","profile")},s=a=>{var c,u,p,f;uo(self.notebookProfile,(f=(p=(c=self.allNotebookProfile)==null?void 0:c[a])!=null?p:(u=self.allNotebookProfile)==null?void 0:u.default)!=null?f:mr),Ie.dev.log("Read currect notebook profile","profile")},l=a=>{var c,u,p,f;uo(self.docProfile,(f=(p=(c=self.allDocProfile)==null?void 0:c[a])!=null?p:(u=self.allDocProfile)==null?void 0:u.default)!=null?f:dr),Ie.dev.log("Read currect doc profile","profile")};switch(e){case 0:{let a=(0,de.getLocalDataByKey)(g.globalProfileKey),c=(0,de.getLocalDataByKey)(g.docProfileKey),u=(0,de.getLocalDataByKey)(g.notebookProfileKey);a?(g.lastVersion=(n=a[0].additional.lastVision)!=null?n:"4.0.0",self.allGlobalProfile=Se(1,a),Qu(Pr,self.allGlobalProfile[0])&&(self.allGlobalProfile.forEach((p,f)=>{let h=he(Pr);uo(h,self.allGlobalProfile[f]),self.allGlobalProfile[f]=h}),(0,de.setLocalDataByKey)(self.allGlobalProfile,g.globalProfileKey))):(Ie.dev.log("Initialize global profile","profile"),self.allGlobalProfile=Array(5).fill(he(Pr))),c?self.allDocProfile=Se(0,c):(Ie.dev.log("Initialize doc profile","profile"),self.allDocProfile={[r]:he(dr),default:he(dr)}),u?self.allNotebookProfile=Se(3,u):(Ie.dev.log("Initialize notebook profile","profile"),self.allNotebookProfile={[t]:he(mr),default:he(mr)}),self.allGlobalProfile.forEach(p=>{p.additional.lastVision=g.version}),g.lastVersion=g.version,s(t),l(r),i(self.notebookProfile.addon.profile[0]);break}case 3:{s(t),i(self.notebookProfile.addon.profile[0]);break}case 1:{l(r);break}case 2:{i(o);break}}fp()}catch(i){Ie.dev.error(i)}},Dt=({range:e,notebookid:t,docmd5:r,profileNO:o})=>{let n=l=>{self.allDocProfile[l]=he(self.docProfile),(0,de.setLocalDataByKey)(self.allDocProfile,g.docProfileKey),Ie.dev.log("Write current doc profile","profile")},i=l=>{self.allGlobalProfile[l]=he(self.globalProfile),(0,de.setLocalDataByKey)(self.allGlobalProfile,g.globalProfileKey),Ie.dev.log("Write global profile","profile")},s=l=>{self.allNotebookProfile[l]=he(self.notebookProfile),(0,de.setLocalDataByKey)(self.allNotebookProfile,g.notebookProfileKey),Ie.dev.log("Write notebook profile","profile")};switch(e){case 0:{s(t),n(r),i(self.notebookProfile.addon.profile[0]);break}case 3:{s(t),i(self.notebookProfile.addon.profile[0]);break}case 1:{n(r);break}case 2:{i(o);break}}};async function wn(e,t,r){var o,n,i,s;try{if(!de.MN.currentDocmd5||!de.MN.currnetNotebookid)return;switch(t){case"quickSwitch":self.globalProfile.addon.quickSwitch=r;break;case"profile":let a=self.notebookProfile.addon.profile[0];self.notebookProfile.addon.profile=r,Dt({range:2,profileNO:a}),pt({range:2,profileNO:r[0]});break;default:((n=(o=self.globalProfile)==null?void 0:o[e])==null?void 0:n[t])!==void 0?(self.globalProfile[e][t]=r,self.notebookProfile.addon.profile[0]===4&&Object.entries(self.allGlobalProfile).forEach(([c,u])=>{var p;((p=u[e])==null?void 0:p[t])!==void 0&&(self.allGlobalProfile[c][e][t]=r)})):((s=(i=self.notebookProfile)==null?void 0:i[e])==null?void 0:s[t])!==void 0?(self.notebookProfile[e][t]=r,self.notebookProfile.addon.profile[0]===4&&("default"in self.allNotebookProfile||(self.allNotebookProfile.default=he(mr)),Object.entries(self.allNotebookProfile).forEach(([c,u])=>{var p;((p=u[e])==null?void 0:p[t])!==void 0&&(self.allNotebookProfile[c][e][t]=r)}))):(self.docProfile[e][t]=r,self.notebookProfile.addon.profile[0]===4&&("default"in self.allDocProfile||(self.allDocProfile.default=he(dr)),Object.entries(self.allDocProfile).forEach(([c,u])=>{var p;((p=u[e])==null?void 0:p[t])!==void 0&&(self.allDocProfile[c][e][t]=r)})))}let l=3;if(self.backupWaitTimes===void 0){Ie.dev.log("Save profile: start new timer","profile"),self.backupWaitTimes=0;let a=l;for(;a;)self.backupWaitTimes?(a=self.backupWaitTimes,self.backupWaitTimes=0):a--,Ie.dev.log(a,"profile"),await(0,de.delay)(1);self.backupWaitTimes=void 0,Ie.dev.log("Save profile completed","profile"),Dt({range:0,docmd5:de.MN.currentDocmd5,notebookid:de.MN.currnetNotebookid});let{backupID:c,autoBackup:u}=self.globalProfile.addon;if(c&&u){Ie.dev.log("Auto backup to card","profile");let p=de.MN.db.getNoteById(c.replace("marginnote3app://note/",""));p&&Ri(p)}}else self.backupWaitTimes=self.backupWaitTimes+1}catch(l){Ie.dev.error(String(l))}}function _n(){let{cacheTitle:e,cacheComment:t,cacheTag:r}=self.notebookProfile.additional,o={cacheTitle:{},cacheComment:{},cacheTag:{}};Object.entries(e).forEach(([n,i])=>{de.MN.db.getNoteById(n)&&i!==void 0&&(o.cacheTitle[n]=i)}),Object.entries(t).forEach(([n,i])=>{de.MN.db.getNoteById(n)&&i!==void 0&&(o.cacheComment[n]=i)}),Object.entries(r).forEach(([n,i])=>{de.MN.db.getNoteById(n)&&i!==void 0&&(o.cacheTag[n]=i)}),self.notebookProfile.additional.cacheComment=o.cacheComment,self.notebookProfile.additional.cacheTag=o.cacheTag,self.notebookProfile.additional.cacheTitle=o.cacheTitle}var xp=C(T());var te=(0,xp.i18n)({zh:{intro:`\u5F53\u524D\u7248\u672C\uFF1A${g.version}`,profile:{$option5:["\u914D\u7F6E 1","\u914D\u7F6E 2","\u914D\u7F6E 3","\u914D\u7F6E 4","\u521D\u59CB\u5316"],label:"\u9009\u62E9\u5168\u5C40\u914D\u7F6E",help:"\u3010\u4EC5\u5F53\u524D\u7B14\u8BB0\u672C\u3011\u4E0D\u540C\u573A\u666F\uFF0C\u4E0D\u540C\u914D\u7F6E\u3002"},quick_switch:{label:"\u6A21\u5757\u5FEB\u6377\u5F00\u5173"},panel_position:{$option6:["\u6587\u6863\u9760\u5185","\u6587\u6863\u8111\u56FE\u4E2D\u95F4","\u8111\u56FE\u9760\u5185","\u9760\u5DE6","\u5C45\u4E2D","\u9760\u53F3"],label:"\u9762\u677F\u663E\u793A\u4F4D\u7F6E"},panel_height:{$option3:["\u9AD8\u70B9","\u6807\u51C6","\u77EE\u70B9"],label:"\u9762\u677F\u663E\u793A\u9AD8\u5EA6"},panle_control:{$option2:["\u53CC\u51FB\u56FE\u6807\u6253\u5F00\u9762\u677F","\u52A8\u4F5C\u6267\u884C\u5B8C\u5173\u95ED\u9762\u677F"],label:"\u9762\u677F\u663E\u793A\u63A7\u5236"},drag_merge:{label:"\u62D6\u62FD\u5408\u5E76\u751F\u6210\u6807\u9898",help:"\u3010AutoTitle\u3001AutoDef\u3001AutoComplete\u3011\u5982\u679C\u5361\u7247\u4E2D\u6709\u6458\u5F55\uFF0C\u4F7F\u7528\u624B\u578B\u5DE5\u5177\u62D6\u62FD\u9009\u533A\u5408\u5E76\u5230\u8BE5\u5361\u7247\u4E2D\u3002",$option2:["\u59CB\u7EC8\u4E0D\u751F\u6210\u6807\u9898","\u6EE1\u8DB3\u6761\u4EF6\u65F6\u751F\u6210\u6807\u9898","\u59CB\u7EC8\u8F6C\u6807\u9898"]},has_title_then:{$option3:["\u4E0D\u8F6C\u6807\u9898","\u5408\u5E76\u6807\u9898","\u8986\u76D6\u6807\u9898"],label:"> \u5DF2\u7ECF\u6709\u6807\u9898"},remove_excerpt:{$option2:["\u7ACB\u5373\u5220\u9664","\u7B49\u4F1A\u5220\u9664"],label:"> \u62D6\u5165\u7684\u6458\u5F55\u5C06"},lock_excerpt:{label:"\u9501\u5B9A\u6458\u5F55\u6587\u5B57"},auto_backup:{label:"\u81EA\u52A8\u5907\u4EFD\u914D\u7F6E"},backup_ID:{help:"\u8F93\u5165\u5907\u4EFD\u5361\u7247\u94FE\u63A5\uFF0C\u8BF7\u786E\u4FDD\u8BE5\u5361\u7247\u6709\u5B50\u5361\u7247\uFF0C\u5426\u5219\u65E0\u6CD5\u5199\u5165\u3002\u5B50\u5361\u7247\u8D8A\u591A\u8D8A\u597D\u3002",not_link:"\u4E0D\u662F\u5361\u7247\u94FE\u63A5",not_exit:"\u5361\u7247\u4E0D\u5B58\u5728",no_child:"\u5361\u7247\u6CA1\u6709\u5B50\u5361\u7247"}},en:{intro:`Current Version: ${g.version}`,profile:{$option5:["Profile 1","Profile 2","Profile 3","Profile 4","Initialize"],label:"Select Global Profile",help:"[Only Current Notebook] Different Scenes, Different Profile."},quick_switch:{label:"Module Quick Switch"},panel_position:{$option6:["Document Inner Side","Document MindMap Middle","MindMap Inner Side","Left","Center","Right"],label:"Panel Position"},panel_height:{$option3:["Taller","Standard","Shorter"],label:"Panel Height"},panle_control:{$option2:["Double Click Icon to Open Panel","Close Panel After Action"],label:"Panel Control"},drag_merge:{label:"Drag Merge to Generate Title",help:"[AutoTitle, AutoDef, AutoComplete] If the card has an excerpt, use the hand tool to drag the selection area to merge into the card.",$option2:["Never Generate Title","Always Generate Title","Generate Title When Conditions Are Met"]},has_title_then:{$option3:["Not Turn to Title","Merge Title","Override Title"],label:"> Has Title"},remove_excerpt:{$option2:["Remove Immediately","Remove Later"],label:"> The Dragged Excerpt Will"},lock_excerpt:{label:"Lock Excerpt Text"},auto_backup:{label:"Auto Backup Profile"},backup_ID:{help:"Enter the backup card link, please make sure that the card has subcards, otherwise it cannot be written. The more subcards, the better.        ",not_link:"Not a card url",not_exit:"Card does not exist",no_child:"Card has no subcards"}}});var _p={name:g.title,key:"addon",link:g.forum,intro:te.intro,settings:[{help:te.profile.help,key:"profile",type:6,option:te.profile.$option5,label:te.profile.label},{label:te.quick_switch.label,key:"quickSwitch",type:7,option:[]},{key:"panelPosition",type:6,option:te.panel_position.$option6,label:te.panel_position.label},{key:"panelHeight",type:6,option:te.panel_height.$option3,label:te.panel_height.label},{key:"panelControl",type:7,option:te.panle_control.$option2,label:te.panle_control.label},{key:"dragMerge",type:6,label:te.drag_merge.label,option:te.drag_merge.$option2,help:te.drag_merge.help,bind:["quickSwitch",[2,3,5]]},{key:"hasTitleThen",type:6,label:te.has_title_then.label,option:te.has_title_then.$option3,bind:[["quickSwitch",[2,3,5]],["dragMerge",[1,2]]]},{key:"removeExcerpt",type:6,label:te.remove_excerpt.label,option:te.remove_excerpt.$option2,bind:[["quickSwitch",[2,3,5]],["dragMerge",[1,2]]]},{key:"lockExcerpt",type:1,label:te.lock_excerpt.label},{key:"autoBackup",type:1,label:te.auto_backup.label},{key:"backupID",type:4,help:te.backup_ID.help,bind:["autoBackup",!0],check:({input:e})=>{var o;let t=e.replace("marginnote3app://note/","");if(t===e)throw te.backup_ID.not_link;let r=wp.MN.db.getNoteById(t);if(!r)throw te.backup_ID.not_exit;if(!((o=r.childNotes)!=null&&o.length))throw te.backup_ID.no_child}}]};var Sp=C(T());var Ue=(0,Sp.i18n)({zh:{intro:"\u3010\u4EC5 iPad \u53EF\u7528\u3011\u4F7F\u7528\u624B\u52BF\u6765\u89E6\u53D1 MagicAction \u4E2D\u7684\u52A8\u4F5C\u3002\u8BE5\u529F\u80FD\u5B8C\u5168\u7531 OhMyMN \u63D0\u4F9B\uFF0C\u4E0E MN \u65E0\u5173\u3002\u70B9\u51FB\u67E5\u770B\u624B\u52BF\u76D1\u6D4B\u533A\u57DF\u53CA\u6CE8\u610F\u4E8B\u9879\u3002             ",single_bar:"\u5361\u7247\u5355\u9009\u5DE5\u5177\u680F",muilt_bar:"\u5361\u7247\u591A\u9009\u5DE5\u5177\u680F",selection_bar:"\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F",action_not_work:"\u6A21\u5757\u672A\u542F\u7528\uFF0C\u8BE5\u52A8\u4F5C\u65E0\u6CD5\u6267\u884C",custom_shortcut:"\u81EA\u5B9A\u4E49\u6377\u5F84",only_mn:"\u4EC5\u652F\u6301 MarginNote \u63D2\u4EF6\u7684 URL Scheme\uFF0C\u4F46\u4E0D\u9650\u4E8E OhMyMN",show_y:{label:"\u663E\u793A Y \u8F74\u5750\u6807",help:"\u9488\u5BF9\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u533A\u57DF\u624B\u52BF\u65E0\u6CD5\u8BC6\u522B\u7684\u95EE\u9898\uFF0C\u5F00\u542F\u540E\u4F1A\u663E\u793A\u6ED1\u52A8\u4F4D\u7F6E\u7684 Y \u8F74\u5750\u6807\uFF0C\u65B9\u4FBF\u81EA\u884C\u8C03\u6574\u3002     "},selection_bar_y:{help:"[\u4ECE\u5DE6\u5230\u53F3\u9009\u62E9\u65F6\u5728\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u9876\u90E8\u6ED1\u52A8\u65F6\u7684 Y \u8F74\u5750\u6807, \u4ECE\u53F3\u5230\u5DE6\u9009\u62E9\u65F6\u5728\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u9876\u90E8\u6ED1\u52A8\u65F6\u7684 Y \u8F74\u5750\u6807]\u3002\u70B9\u51FB\u67E5\u770B\u8BBE\u7F6E\u65B9\u6CD5\u3002                   ",enter_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570",input_array:"\u8BF7\u8F93\u5165\u6570\u7EC4\uFF0C\u6BD4\u5982 [0,70]",input_two_number:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u4E24\u4E2A\u6570\u5B57\uFF0C\u6BD4\u5982 [0,70]",link:S("gesture","\u8C03\u6574\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u8BC6\u522B\u533A\u57DF")}},en:{intro:"\u3010iPad only\u3011Trigger MagicAction by gesture. This feature is provided by OhMyMN, not MarginNote. Click to view the gesture detection area and precautions.",single_bar:"Card Selection Toolbar",muilt_bar:"Card Multi-Select Toolbar",selection_bar:"Text Selection Toolbar",action_not_work:"Module is not enabled, the action cannot be run",custom_shortcut:"Custom Shortcuts",only_mn:"Only support MarginNote addon's URL Scheme, but not limited to OhMyMN.",selection_bar_y:{help:"[Y axis coordinate when swiping in the top of text select toolbar when selecting from left to right, Y axis coordinate when swiping in the top of text select toolbar when selecting from right to left].",enter_positive:"Please enter a positive integer",input_array:"Please enter an array, such as [0,70]",input_two_number:"There must be two numbers in the array, such as [0,70]",link:S("gesture","adjust-the-text-selection-toolbar-recognition-area")},show_y:{label:"Show Y coordinate",help:"For the problem that the gesture in the text selection toolbar area cannot be recognized, the Y coordinate of the sliding position will be displayed after turning on, which is convenient for self-adjustment."}}});var Cp={name:"Gesture",key:"gesture",intro:Ue.intro,link:S("gesture"),settings:[{key:"selectionBarY",type:4,help:Ue.selection_bar_y.help,link:Ue.selection_bar_y.link,check({input:e}){if(e=M(e),!Array.isArray(e))throw Ue.selection_bar_y.input_array;if(e.length!==2)throw Ue.selection_bar_y.input_two_number;if(e.some(t=>!Number.isInteger(t)))throw Ue.selection_bar_y.enter_positive}},{key:"showY",type:1,label:Ue.show_y.label,help:Ue.show_y.help},...[[Ue.single_bar,"single"],[Ue.muilt_bar,"muilt"],[Ue.selection_bar,"selection"]].map(e=>[["\u2191","Up"],["\u2193","Down"],["\u2190","Left"],["\u2192","Right"]].map(t=>[{label:`${e[0]} ${t[0]}`,key:`${e[1]}BarSwipe${t[1]}`,type:6,option:[]},{key:`${e[1]}BarSwipe${t[1]}Shortcut`,type:4,bind:[`${e[1]}BarSwipe${t[1]}`,1],check({input:r}){if(!r.startsWith("marginnote3app://addon"))throw Ue.only_mn}}])).flat(1/0)]};var we=C(T());var Tp=C(T());var U=(0,Tp.i18n)({zh:{intro:"\u6240\u6709\u52A8\u4F5C\u5747\u9700\u8981\u5148\u9009\u4E2D\u5361\u7247\u3002\u52A8\u4F5C\u6765\u81EA\u4E8E\u5404\u4E2A\u6A21\u5757\uFF0C\u9700\u8981\u542F\u7528\u5BF9\u5E94\u7684\u6A21\u5757\u3002\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u7684\u4F7F\u7528\u65B9\u6CD5\u548C\u6CE8\u610F\u4E8B\u9879\u3002",default_merge_text:{help:"\u5408\u5E76\u5361\u7247\u5185\u6587\u5B57\u65F6\u7684\u524D\u540E\u4FEE\u9970\uFF0C\u9ED8\u8BA4\u6DFB\u52A0\u5E8F\u53F7\u548C\u6362\u884C\uFF08$&\u4EE3\u8868\u6BCF\u4E00\u6BB5\uFF09\uFF0C\u70B9\u51FB\u67E5\u770B\u81EA\u5B9A\u4E49\u65B9\u6CD5\u3002                 ",error:"\u7F3A\u5C11 $&",link:S("magicaction4card","\u5408\u5E76\u5361\u7247\u5185\u6587\u5B57")},rename_title:{label:"\u91CD\u547D\u540D\u6807\u9898",help:`$& \u6307\u4EE3\u539F\u6807\u9898\u3002\u8F93\u5165 "%['1'] $&" \u53EF\u5FEB\u901F\u4E3A\u9009\u4E2D\u5361\u7247\u6807\u9898\u7F16\u53F7\u3002`},smart_selection:{label:"\u667A\u80FD\u9009\u62E9",help:"\u5E2E\u52A9\u4F60\u5FEB\u901F\u9009\u4E2D\u5B50\u5361\u7247\uFF0C\u540E\u4EE3\u5361\u7247\u3002"},filter_cards:{label:"\u7B5B\u9009\u5361\u7247",$option5:["\u6240\u6709","\u6807\u9898","\u6458\u5F55","\u8BC4\u8BBA","\u6807\u7B7E"]},switch_title:{label:"\u5207\u6362\u6458\u5F55\u6807\u9898",help:"\u5F53\u4E24\u8005\u90FD\u5B58\u5728\u65F6\u8BF7\u4F7F\u7528\u300C\u4EA4\u6362\u6807\u9898\u548C\u6458\u5F55\u300D\u3002",$option2:["\u5207\u6362\u4E3A\u4E0D\u5B58\u5728\u7684","\u4EA4\u6362\u6807\u9898\u548C\u6458\u5F55"],swap_title_excerpt:"\u4EA4\u6362\u6807\u9898\u548C\u6458\u5F55",swap_help:"\u68C0\u6D4B\u5230\u6240\u9009\u5361\u7247\u4E2D\u6709\u6807\u9898\u548C\u6458\u5F55\u540C\u65F6\u5B58\u5728\u7684\u60C5\u51B5\uFF0C\u8BF7\u9009\u62E9\u4EA4\u6362\u65B9\u5F0F",$both_option3:["\u6458\u5F55 \u21C4 \u6807\u9898","\u6458\u5F55 \u2192 \u6807\u9898","\u6458\u5F55 \u2190 \u6807\u9898"]},merge_text:{label:"\u5408\u5E76\u5361\u7247\u5185\u6587\u5B57",help:"\u4EC5\u652F\u6301\u5408\u5E76\u6587\u5B57\u6458\u5F55\u548C\u6587\u5B57\u8BC4\u8BBA\uFF0C\u4E0D\u5408\u5E76\u6807\u7B7E\u548C\u94FE\u63A5\uFF0C\u5176\u4F59\u5185\u5BB9\u4F1A\u5728\u5408\u5E76\u540E\u7F6E\u9876\u3002",is_excerpt_pic_text:"\u68C0\u6D4B\u5230\u5F53\u524D\u6458\u5F55\u4E3A\u56FE\u7247 OCR \u7684\u6587\u5B57\uFF0C\u5408\u5E76\u4E3A\u8BC4\u8BBA\u65E0\u6CD5\u5220\u9664\u8BE5\u6458\u5F55\uFF0C\u662F\u5426\u7EE7\u7EED\u5408\u5E76\u4E3A\u8BC4\u8BBA\uFF1F",$excerpt_pic_text_option2:["\u7EE7\u7EED","\u5408\u5E76\u4E3A\u6458\u5F55"],is_excerpt_pic:"\u68C0\u6D4B\u5230\u5F53\u524D\u6458\u5F55\u4E3A\u56FE\u7247\uFF0C\u5408\u5E76\u4E3A\u6458\u5F55\u540E\u4ECD\u65E7\u662F\u56FE\u7247\uFF0C\u662F\u5426\u7EE7\u7EED\u5408\u5E76\u4E3A\u6458\u5F55\uFF1F",$excerpt_pic_option2:["\u7EE7\u7EED","\u5408\u5E76\u4E3A\u8BC4\u8BBA"],$option2:["\u5408\u5E76\u4E3A\u6458\u5F55","\u5408\u5E76\u4E3A\u8BC4\u8BBA"]},merge_cards:{label:"\u5408\u5E76\u5361\u7247",$option2:["\u540C\u65F6\u5408\u5E76\u6807\u9898","\u4E0D\u5408\u5E76\u6807\u9898"]},manage_profile:{label:"\u914D\u7F6E\u7BA1\u7406",$option4:["\u8BFB\u53D6\u914D\u7F6E","\u5199\u5165\u914D\u7F6E","\u91CD\u7F6E\u914D\u7F6E","\u540C\u6B65\u5176\u4ED6\u7A97\u53E3\u7684\u914D\u7F6E"],help:"\u5199\u5165\u914D\u7F6E\u65F6\u8BF7\u786E\u4FDD\u8BE5\u5361\u7247\u81F3\u5C11\u6709\u4E00\u5F20\u5B50\u5361\u7247\u3002\u591A\u5F20\u5B50\u5361\u7247\u53EF\u4EE5\u4E00\u8D77\u5206\u62C5\u914D\u7F6E\uFF0C\u9632\u6B62\u5355\u5F20\u5361\u7247\u5B57\u6570\u8FC7\u591A\u3002"},is_selected:"\u60A8\u9700\u8981\u7684\u5361\u7247\u5DF2\u9009\u4E2D\uFF0C\u8BF7\u7EE7\u7EED\u64CD\u4F5C",none_card:"\u672A\u627E\u5230\u7B26\u5408\u7684\u5361\u7247",hierarchical_numbering:"\u8BF7\u786E\u4FDD\u9009\u4E2D\u7684\u6BCF\u5F20\u5361\u7247\u5747\u4E3A\u540C\u5C42\u7EA7\u4E14\u90FD\u6709\u5B50\u5361\u7247"},en:{intro:"All actions require the card to be selected first. The actions come from various modules and require the corresponding modules to be enabled. Click to view the specific usage method and precautions.",smart_selection:{label:"Smart Selector",help:"Help you quickly select the child card and descendant card."},default_merge_text:{help:"The front and rear decoration of the text in the card when merging, the default adds a serial number and a line break ($& represents each paragraph), click to view the custom method.                 ",error:"Missing $&",link:S("magicaction4card","merge-text")},switch_title:{help:"Use [Swap Title and Excerpt] when both are present\u300D",label:"Switch Excerpt / Title",$option2:["Switch to Non-Existent","Swap Title and Excerpt"],swap_title_excerpt:"Swap Title and Excerpt",swap_help:"It is detected that there are both title and excerpt in the selected card. Please select the swap method",$both_option3:["Excerpt \u21C4 Title","Excerpt \u2192 Title","Excerpt \u2190 Title"]},filter_cards:{label:"Filter Cards",$option5:["All","Title","Excerpt","Comment","Tag"]},merge_text:{label:"Merge Text",is_excerpt_pic_text:"The current excerpt is a picture OCR text. If you merge it as a comment, you cannot delete the excerpt. Do you want to continue to merge it as a comment?",$excerpt_pic_text_option2:["Continue","Merge as Comment"],help:"Only support merging text excerpt and text comment, not merging tags and link, other content will be pinned after merging",$excerpt_pic_option2:["Continue","Merge as Comment"],is_excerpt_pic:"The excerpt is a picture, continue to merge as excerpt?",$option2:["Merged as Excerpt","Merged as Comment"]},merge_cards:{label:"Merge Multiple Cards",$option2:["Merge Title","Not Merge Titles"]},manage_profile:{label:"Manage Profile",$option4:["Read Profile","Write Profile","Reset Profile","Sync Profile with Other Windows"],help:"Please make sure that the card has at least one child card when writing the profile. Multiple child cards can share the profile together to prevent a single card from having too many words."},rename_title:{help:`$& refers to the original title. Enter "%['1'] $&" to Quickly number the selected card title.`,label:"Rename Titles"},is_selected:"The card is selected, please continue",none_card:"No matching cards found",hierarchical_numbering:"Ensure that each selected card is at the same level and has child node"}});var it=C(T()),ft=C(T());var mx=Object.prototype.toString,Xt=Array.isArray||function(t){return mx.call(t)==="[object Array]"};function Di(e){return typeof e=="function"}function gx(e){return Xt(e)?"array":typeof e}function Oi(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ep(e,t){return e!=null&&typeof e=="object"&&t in e}function yx(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var bx=RegExp.prototype.test;function xx(e,t){return bx.call(e,t)}var wx=/\S/;function _x(e){return!xx(wx,e)}function Sx(e){return encodeURIComponent(e)}var Cx=/\s*/,Tx=/\s+/,vp=/\s*=/,Ex=/\s*\}/,vx=/#|\^|\/|>|\{|&|=|!/;function $x(e,t){if(!e)return[];var r=!1,o=[],n=[],i=[],s=!1,l=!1,a="",c=0;function u(){if(s&&!l)for(;i.length;)delete n[i.pop()];else i=[];s=!1,l=!1}var p,f,h;function d(se){if(typeof se=="string"&&(se=se.split(Tx,2)),!Xt(se)||se.length!==2)throw new Error("Invalid tags: "+se);p=new RegExp(Oi(se[0])+"\\s*"),f=new RegExp("\\s*"+Oi(se[1])),h=new RegExp("\\s*"+Oi("}"+se[1]))}d(t||xt.tags);for(var y=new fo(e),E,R,F,ie,m,b;!y.eos();){if(E=y.pos,F=y.scanUntil(p),F)for(var w=0,x=F.length;w<x;++w)ie=F.charAt(w),_x(ie)?(i.push(n.length),a+=ie):(l=!0,r=!0,a+=" "),n.push(["text",ie,E,E+1]),E+=1,ie===`
`&&(u(),a="",c=0,r=!1);if(!y.scan(p))break;if(s=!0,R=y.scan(vx)||"name",y.scan(Cx),R==="="?(F=y.scanUntil(vp),y.scan(vp),y.scanUntil(f)):R==="{"?(F=y.scanUntil(h),y.scan(Ex),y.scanUntil(f),R="&"):F=y.scanUntil(f),!y.scan(f))throw new Error("Unclosed tag at "+y.pos);if(R==">"?m=[R,F,E,y.pos,a,c,r]:m=[R,F,E,y.pos],c++,n.push(m),R==="#"||R==="^")o.push(m);else if(R==="/"){if(b=o.pop(),!b)throw new Error('Unopened section "'+F+'" at '+E);if(b[1]!==F)throw new Error('Unclosed section "'+b[1]+'" at '+E)}else R==="name"||R==="{"||R==="&"?l=!0:R==="="&&d(F)}if(u(),b=o.pop(),b)throw new Error('Unclosed section "'+b[1]+'" at '+y.pos);return Nx(kx(n))}function kx(e){for(var t=[],r,o,n=0,i=e.length;n<i;++n)r=e[n],r&&(r[0]==="text"&&o&&o[0]==="text"?(o[1]+=r[1],o[3]=r[3]):(t.push(r),o=r));return t}function Nx(e){for(var t=[],r=t,o=[],n,i,s=0,l=e.length;s<l;++s)switch(n=e[s],n[0]){case"#":case"^":r.push(n),o.push(n),r=n[4]=[];break;case"/":i=o.pop(),i[5]=n[2],r=o.length>0?o[o.length-1][4]:t;break;default:r.push(n)}return t}function fo(e){this.string=e,this.tail=e,this.pos=0}fo.prototype.eos=function(){return this.tail===""};fo.prototype.scan=function(t){var r=this.tail.match(t);if(!r||r.index!==0)return"";var o=r[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};fo.prototype.scanUntil=function(t){var r=this.tail.search(t),o;switch(r){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=o.length,o};function Rr(e,t){this.view=e,this.cache={".":this.view},this.parent=t}Rr.prototype.push=function(t){return new Rr(t,this)};Rr.prototype.lookup=function(t){var r=this.cache,o;if(r.hasOwnProperty(t))o=r[t];else{for(var n=this,i,s,l,a=!1;n;){if(t.indexOf(".")>0)for(i=n.view,s=t.split("."),l=0;i!=null&&l<s.length;)l===s.length-1&&(a=Ep(i,s[l])||yx(i,s[l])),i=i[s[l++]];else i=n.view[t],a=Ep(n.view,t);if(a){o=i;break}n=n.parent}r[t]=o}return Di(o)&&(o=o.call(this.view)),a?o:""};function Fe(){this.templateCache={_cache:{},set:function(t,r){this._cache[t]=r},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}Fe.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Fe.prototype.parse=function(t,r){var o=this.templateCache,n=t+":"+(r||xt.tags).join(":"),i=typeof o<"u",s=i?o.get(n):void 0;return s==null&&(s=$x(t,r),i&&o.set(n,s)),s};Fe.prototype.render=function(t,r,o,n){var i=this.getConfigTags(n),s=this.parse(t,i),l=r instanceof Rr?r:new Rr(r,void 0);return this.renderTokens(s,l,o,t,n)};Fe.prototype.renderTokens=function(t,r,o,n,i){for(var s="",l,a,c,u=0,p=t.length;u<p;++u)c=void 0,l=t[u],a=l[0],a==="#"?c=this.renderSection(l,r,o,n,i):a==="^"?c=this.renderInverted(l,r,o,n,i):a===">"?c=this.renderPartial(l,r,o,i):a==="&"?c=this.escapedValue(l,r,i):a==="name"?c=this.unescapedValue(l,r):a==="text"&&(c=this.rawValue(l)),c&&(Xt(c)?c=c.join("; "):typeof c=="object"&&(c=JSON.stringify(c)),c&&(s+=c));return s};Fe.prototype.renderSection=function(t,r,o,n,i){var s=this,l="",a=r.lookup(t[1]);function c(f){return s.render(f,r,o,i)}if(!!a){if(Xt(a))for(var u=0,p=a.length;u<p;++u)l+=this.renderTokens(t[4],r.push(a[u]),o,n,i);else if(typeof a=="object"||typeof a=="string"||typeof a=="number")l+=this.renderTokens(t[4],r.push(a),o,n,i);else if(Di(a)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");a=a.call(r.view,n.slice(t[3],t[5]),c),a!=null&&(l+=a)}else l+=this.renderTokens(t[4],r,o,n,i);return l}};Fe.prototype.renderInverted=function(t,r,o,n,i){var s=r.lookup(t[1]);if(!s||Xt(s)&&s.length===0)return this.renderTokens(t[4],r,o,n,i)};Fe.prototype.indentPartial=function(t,r,o){for(var n=r.replace(/[^ \t]/g,""),i=t.split(`
`),s=0;s<i.length;s++)i[s].length&&(s>0||!o)&&(i[s]=n+i[s]);return i.join(`
`)};Fe.prototype.renderPartial=function(t,r,o,n){if(!!o){var i=this.getConfigTags(n),s=Di(o)?o(t[1]):o[t[1]];if(s!=null){var l=t[6],a=t[5],c=t[4],u=s;a==0&&c&&(u=this.indentPartial(s,c,l));var p=this.parse(u,i);return this.renderTokens(p,r,o,u,n)}}};Fe.prototype.unescapedValue=function(t,r){var o=r.lookup(t[1]);if(o)return o};Fe.prototype.escapedValue=function(t,r,o){var n=this.getConfigEscape(o)||xt.escape,i=r.lookup(t[1]);if(o!=null&&o.escape)return i;if(i!=null&&(Xt(i)?i=i.join("; "):typeof i=="object"?i=JSON.stringify(i):typeof i=="number"&&(i=String(i)),i))return n(i)};Fe.prototype.rawValue=function(t){return t[1]};Fe.prototype.getConfigTags=function(t){return Xt(t)?t:t&&typeof t=="object"?t.tags:void 0};Fe.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!Xt(t))return t.escape};var xt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){po.templateCache=e},get templateCache(){return po.templateCache}},po=new Fe;xt.clearCache=function(){return po.clearCache()};xt.parse=function(t,r){return po.parse(t,r)};function ho(e,t,r,o){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+gx(e)+'" was given as the first argument for mustache#render(template, view, partials)');return po.render(e.replace(/{{\s*(.+?)\s*}}/g,"{{$1}}"),t,r,o)}xt.render=ho;xt.escape=Sx;xt.Scanner=fo;xt.Context=Rr;xt.Writer=Fe;var ue=(e,t)=>{if(!e||Array.isArray(e)&&e.length===0)return;let r=t(e);if(!!r&&!(Array.isArray(r)&&r.length===0))return r},Ix={escape:()=>(e,t)=>encodeURIComponent(t(e)),nohl:()=>(e,t)=>(0,ft.removeHighlight)(t(e)),blod:()=>(e,t)=>t(e).replace(/\*\*(.+?)\*\*/g,"<b>$1</b>"),clozeSync:()=>(e,t)=>t(e).replace(/\*\*(.+?)\*\*/g,"{{c1::$1}}"),cloze:()=>(e,t)=>{let r=1;return t(e).replace(/\*\*(.+?)\*\*/g,(o,n)=>`{{c${r++}::${n}}}}`)},lower:()=>(e,t)=>t(e).toLowerCase(),upper:()=>(e,t)=>t(e).toUpperCase(),join:()=>(e,t)=>{var s;if(((s=e.match(/{{.+}}/g))==null?void 0:s.length)!==1)return t(e);let[r,o,n]=e.trimStart().split(/({{.+?}})/,3),i=t(o).split(/; /);if(/\$\[.+\]/.test(r)){let l=yt(r,i.length,"\\$");return i.map((a,c)=>r.replace(/\$\[(.+)\]/,l[c])+a).join(n)}return i.map(l=>r+l).join(n)}},Li=()=>{var e;try{if(self.metadata.lastFetch&&Date.now()-self.metadata.lastFetch<100)self.metadata.lastFetch=Date.now();else{self.metadata.lastFetch=Date.now();let t=(e=(0,ft.getLocalDataByKey)("metadata_profile_doc"))==null?void 0:e[it.MN.currentDocmd5];if(t===void 0)self.metadata.data=void 0;else{let{pageOffset:r,reference:o}=t.addon,{citeKey:n}=t.additional,i=JSON.parse(t.additional.data||"{}");self.metadata.data={pageOffset:r,citeKey:n,reference:o,metadata:i}}}}catch(t){it.dev.error(t)}finally{return self.metadata.data}},Mi=(e,t)=>{var n;let r=i=>t.includes(i),o=e.note;return{...Ix,titles:r("titles")&&ue(o.noteTitle,i=>i.split(/\s*[;；]\s*/)),id:r("id")&&o.noteId,url:r("url")&&{pure:ue(o.noteId,i=>"marginnote3app://note/"+i),md:ue(o.noteId,i=>{var s;return`[${(s=o.noteTitle)!=null?s:"MarginNote"}](marginnote3app://note/${i}`}),html:ue(o.noteId,i=>{var s;return`<a href="marginnote3app://note/${i}" class="MNLink">${(s=o.noteTitle)!=null?s:"MarginNote"}</a>`})},page:r("page.")&&{start:o.startPage,end:o.endPage===o.startPage?void 0:o.endPage,real:r("page.")&&{start:ue(o.startPage,i=>{var s,l;return i-Number((l=(s=Li())==null?void 0:s.pageOffset)!=null?l:0)}),end:ue(o.endPage,i=>{var s,l;return i===o.startPage?void 0:i-Number((l=(s=Li())==null?void 0:s.pageOffset)!=null?l:0)})}},tags:r("tags")&&e.tags,allTextPic:r("allTextPic")&&{...e.allTextPic,text:e.allText},excerpts:r("excerpts.")&&{...e.excerptsTextPic,text:e.excerptsText},comments:r("comments.")&&{...e.commentsTextPic,text:e.commentsText},time:r("time.")&&{creat:ue(o.createDate,Ir),modify:ue(o.modifiedDate,Ir),now:Ir(new Date)},doc:r("doc.")&&{md5:o.docMd5,title:ue(o.docMd5,i=>{var s;return(s=it.MN.db.getDocumentById(i))==null?void 0:s.docTitle}),url:r("url.")&&{pure:ue((0,ft.getDocURL)(),i=>i),md:ue((0,ft.getDocURL)(),i=>{var s,l;return`[${o.docMd5&&(l=(s=it.MN.db.getDocumentById(o.docMd5))==null?void 0:s.docTitle)!=null?l:"MarginNote"}](marginnote3app://note/${i}`}),html:ue((0,ft.getDocURL)(),i=>{var s,l;return`<a href="marginnote3app://note/${i}" class="MNDoc">${o.docMd5&&(l=(s=it.MN.db.getDocumentById(o.docMd5))==null?void 0:s.docTitle)!=null?l:"MarginNote"}</a>`})},path:ue(o.docMd5,i=>{var s;return(s=it.MN.db.getDocumentById(i))==null?void 0:s.pathFile}),...(n=Li())!=null?n:{}},notebook:r("notebook.")&&{title:ue(o.notebookId,i=>{var s;return(s=it.MN.db.getNotebookById(i))==null?void 0:s.title}),id:o.notebookId,url:r("url.")&&{pure:ue(o.notebookId,i=>"marginnote3app://notebook/"+i),md:ue(o.notebookId,i=>{var s;return`[${(s=ue(o.notebookId,l=>{var a;return(a=it.MN.db.getNotebookById(l))==null?void 0:a.title}))!=null?s:"MarginNote"}](marginnote3app://notebook/${i}`}),html:ue(o.notebookId,i=>{var s;return`<a href="marginnote3app://notebook/${i}" class="MNNotebookUrl">${(s=ue(o.notebookId,l=>{var a;return(a=it.MN.db.getNotebookById(l))==null?void 0:a.title}))!=null?s:"MarginNote"}</a>`})}}}},me=(e,t)=>{if(!/{{.+}}/.test(t))return t;let r=o=>t.includes(o);try{return ho(t,{...Mi(e,t),parent:r("parent.")&&ue(e.note.parentNote,o=>Mi(new ft.NodeNote(o),t)),children:r("children")&&ue(e.note.childNotes,o=>o.map(n=>Mi(new ft.NodeNote(n),t)))}).trim()}catch(o){return it.dev.error(o),t}};var $p=C(T());var Bi=(e,t)=>{let r=M(e.replace(/^.*#(\[.+\]).*$/,"$1").replace(/'/g,'"')),o={connectionSymbol:".",maxLevel:999,onlyShowCurrentLayer:!1};if(Array.isArray(r[r.length-1])){let i=r.pop(),[s,l,a]=[i.find(c=>typeof c=="string"),i.find(c=>typeof c=="number"),i.find(c=>typeof c=="boolean")];s!==void 0&&(o.connectionSymbol=s),l!==void 0&&(o.maxLevel=l),a!==void 0&&(o.onlyShowCurrentLayer=a)}let n=r.length;if(n==0||r.some(i=>typeof i!="string"))throw"\u9664\u5F00 option \u5FC5\u987B\u8FD8\u6709\u5143\u7D20\uFF0C\u5E76\u4E14\u90FD\u5FC5\u987B\u662F string";return t.map(i=>{let s=i.length;return o.onlyShowCurrentLayer&&(i=i.slice(-1)),s<=o.maxLevel?i.map((l,a)=>cp(r[a>n-1?n-1:a],l)).join(o.connectionSymbol):""})},kp=({content:e,nodes:t})=>{e=/^\(.*\)$/.test(e)?e:`(/^.*$/gs, "${ce(e)}")`;let{newSubStr:r,regexp:o}=xe(e)[0];if(/#\[(.+)\]/.test(r))if(t.every(i=>{var s,l,a;return((s=t[0].parentNode)==null?void 0:s.nodeid)===((l=i.parentNode)==null?void 0:l.nodeid)&&((a=i==null?void 0:i.childNodes)==null?void 0:a.length)}))t.forEach(i=>{let{treeIndex:s,descendant:l}=i.descendantNodes,a=Bi(r,s).map(c=>r.replace(/#\[(.+)\]/,c));l.forEach((c,u)=>{var f;let p=(f=c.note.noteTitle)!=null?f:"";a[u]&&(c.title=p.replace(o,me(c,a[u])))})});else{(0,$p.showHUD)(U.hierarchical_numbering,2);return}else if(/%\[(.+)\]/.test(r)){let n=yt(r,t.length).map(i=>r.replace(/%\[(.+)\]/,i));t.forEach((i,s)=>{var a;let l=(a=i.note.noteTitle)!=null?a:"";n[s]&&(i.title=l.replace(o,me(i,n[s])))})}else t.forEach(n=>{var s;let i=(s=n.note.noteTitle)!=null?s:"";n.title=i.replace(o,me(n,r))})};var Np={name:"MagicAction for Card",key:"magicaction4card",intro:U.intro,link:S("magicaction4card"),settings:[{key:"smartSelection",type:1,label:U.smart_selection.label,help:U.smart_selection.help},{key:"defaultMergeText",type:4,help:U.default_merge_text.help,link:U.default_merge_text.link,check({input:e}){if(Xe(e),!e.includes("$&"))throw U.default_merge_text.error}}],actions4card:[{key:"manageProfile",type:2,label:U.manage_profile.label,option:U.manage_profile.$option4,help:U.manage_profile.help,method:()=>{}},{type:3,label:U.filter_cards.label,option:U.filter_cards.$option5,key:"filterCard",method({nodes:e,content:t,option:r}){if(!t)return(0,we.showHUD)(U.none_card),[];let o=Ht(t),n=e.filter(i=>{var a;let s=(a=i.title)!=null?a:"",l=(()=>{switch(r){case 1:return s;case 4:return i.tags.join(" ");case 2:return i.excerptsText.join(`

`);case 3:return i.commentsText.join(`

`);default:return`${s}
${i.allText}`}})();return o.some(c=>c.every(u=>u.test(l)))});return n.length?(we.HUDController.show(U.is_selected),n):((0,we.showHUD)(U.none_card),[])},check({input:e}){ki(e)}},{type:2,label:U.merge_cards.label,key:"mergeCard",option:U.merge_cards.$option2,method({option:e,nodes:t}){if(t.length==1)return;let{node:r}=t.slice(1).reduce((i,s)=>{let l=s.ancestorNodes.length;return l<i.level?{level:l,node:s}:i},{level:t[0].ancestorNodes.length,node:t[0]}),o=r.titles;for(let i of t)i!==r&&(o.push(...i.titles),r.note.merge(i.note));let n=r.note.comments.length;r.note.comments.reverse().forEach((i,s)=>{i.type=="TextNote"&&o.includes(i.text)&&r.note.removeCommentByIndex(n-s-1)}),e==0&&(r.titles=o),r.tidyupTags()}},{type:3,label:U.rename_title.label,key:"renameTitle",help:U.rename_title.help,method:kp,check({input:e}){e=/^\(.+\)$/.test(e)?e:`(/^.*$/gs, "${ce(e)}")`;let{regexp:t,newSubStr:r}=xe(e)[0];"test".replace(t,r),/%\[.+\]/.test(r)&&yt(r,1),/#\[.+\]/.test(r)&&Bi(r,[[1,1,1]])}},{type:2,label:U.merge_text.label,key:"mergeText",option:U.merge_text.$option2,help:U.merge_text.help,method:({option:e,nodes:t})=>{let{defaultMergeText:r}=self.globalProfile.magicaction4card,[o,n]=M(`${ce(r)}`,!0).split("$&");for(let i of t){let s=(l=>{if(/%\[.+\]/.test(o)){let a=yt(o,l.length);return l.map((c,u)=>o.replace(/%\[(.+)\]/,a[u])+c).join(n)}return l.map(a=>o+a).join(n)})(i.excerptsCommentsText);i.removeCommentButLinkTag(l=>{var a,c;return l.type==="PaintNote"||l.type==="HtmlNote"||!!(l.type==="LinkNote"&&!i.isOCR&&((c=(a=we.MN.db.getNoteById(l.noteid))==null?void 0:a.excerptPic)==null?void 0:c.paint))},async l=>{var a,c;switch(e){case 0:if(((a=l.note.excerptPic)==null?void 0:a.paint)&&l.isOCR===!1&&await(0,we.selectIndex)(U.merge_text.$excerpt_pic_option2,U.merge_text.label,U.merge_text.is_excerpt_pic)){l.appendTextComments((0,we.removeHighlight)(s));return}l.mainExcerptText=s;break;case 1:if(l.isOCR&&l.mainExcerptText&&await(0,we.selectIndex)(U.merge_text.$excerpt_pic_text_option2,U.merge_text.label,U.merge_text.is_excerpt_pic_text)){l.mainExcerptText=s;return}(c=l.note.excerptPic)!=null&&c.paint||(l.mainExcerptText=""),l.appendTextComments((0,we.removeHighlight)(s))}})}}},{key:"switchTitle",type:2,label:U.switch_title.label,option:U.switch_title.$option2,help:U.switch_title.help,method:async({nodes:e,option:t})=>{var r,o;if(t===0)for(let n of e){let i=n.title,s=(0,we.removeHighlight)(n.mainExcerptText);((r=n.note.excerptPic)==null?void 0:r.paint)&&!n.note.textFirst||(s===i?n.title="":i&&!s?(n.title="",n.mainExcerptText=i):s&&!i&&(n.title=s,(o=n.note.excerptPic)!=null&&o.paint?n.mainExcerptText=s:n.mainExcerptText=""))}else{let n=e.map(s=>[s.title,(0,we.removeHighlight)(s.mainExcerptText)]),i=n.find(([s,l])=>s&&l)?await(0,we.selectIndex)(U.switch_title.$both_option3,U.switch_title.swap_title_excerpt,U.switch_title.swap_help):0;(0,we.undoGroupingWithRefresh)(()=>{e.forEach((s,l)=>{var u,p,f;let[a,c]=n[l];if(!(((u=s.note.excerptPic)==null?void 0:u.paint)&&!s.note.textFirst))if(c===a)s.title="";else if(a&&!c)s.title="",s.mainExcerptText=a;else if(c&&!a)s.title=c,(p=s.note.excerptPic)!=null&&p.paint?s.mainExcerptText=c:s.mainExcerptText="";else switch(i){case 0:s.title=c,s.mainExcerptText=a;break;case 1:s.title=c,(f=s.note.excerptPic)!=null&&f.paint||(s.mainExcerptText="");break;case 2:s.title="",s.mainExcerptText=a}})})}}}]};var Ip=C(T()),Je=(0,Ip.i18n)({zh:{intro:"\u6240\u6709\u52A8\u4F5C\u5747\u9700\u8981\u5728\u6587\u6863\u4E2D\u9009\u4E2D\u6587\u5B57\u6216\u6846\u9009\u9009\u533A\u3002\u52A8\u4F5C\u6765\u81EA\u4E8E\u5404\u4E2A\u6A21\u5757\uFF0C\u9700\u8981\u542F\u7528\u5BF9\u5E94\u7684\u6A21\u5757\u3002\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u7684\u4F7F\u7528\u65B9\u6CD5\u548C\u6CE8\u610F\u4E8B\u9879\u3002",pre_OCR:{label:"\u9884\u5148 OCR",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u4F7F\u7528 AutoOCR \u8FDB\u884C\u8F6C\u6587\u5B57\u6216\u77EB\u6B63\uFF0C\u8BF7\u786E\u4FDD\u4F60\u5DF2\u7ECF\u586B\u5165 OCR \u5BC6\u94A5\u3002"},pre_simplify:{label:"\u9884\u5148\u8F6C\u4E3A\u7B80\u4F53\u4E2D\u6587",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u4F7F\u7528 AutoSimplify \u8FDB\u884C\u7E41\u7B80\u8F6C\u6362\u3002"},pre_format:{label:"\u9884\u5148\u683C\u5F0F\u5316",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u4F7F\u7528 AutoFormat \u8FDB\u884C\u683C\u5F0F\u5316\u6392\u7248\u3002"},show_copy_content:{label:"\u663E\u793A\u590D\u5236\u7684\u5185\u5BB9"},copy_text:"\u590D\u5236\u9009\u4E2D\u6587\u5B57",note_options:{$option6:["\u590D\u5236","\u8BBE\u7F6E\u4E3A\u6807\u9898","\u5408\u5E76\u6807\u9898","\u5408\u5E76\u5230\u6458\u5F55","\u6DFB\u52A0\u4E3A\u6458\u5F55","\u6DFB\u52A0\u4E3A\u8BC4\u8BBA"],label:"\u5F39\u51FA\u66F4\u591A\u9009\u9879",help:"\u5982\u679C\u9009\u4E2D\u8FD9\u6BB5\u6587\u5B57\u4E4B\u524D\uFF0C\u4F60\u5DF2\u7ECF\u9009\u4E2D\u4E86\u4E00\u4E2A\u6458\u5F55\u3002\u6B64\u65F6\u6267\u884C\u67D0\u4E9B\u4F1A\u5C06\u7ED3\u679C\u590D\u5236\u5230\u526A\u8D34\u677F\u7684\u52A8\u4F5C\u65F6\u4F1A\u5F39\u51FA\u66F4\u591A\u9009\u9879\uFF0C\u65B9\u4FBF\u76F4\u63A5\u5199\u5165\u5361\u7247\u4E2D\u3002"}},en:{intro:"All actions require text to be selected or a selection area to be selected. Actions come from various modules and require the corresponding module to be enabled. Click to view specific usage and precautions.",copy_text:"Copy Selected Text",pre_OCR:{label:"Pre OCR",help:"[Only Current Document] Use AutoOCR to OCR. Please make sure you have filled in the OCR key."},pre_simplify:{label:"Pre Simplify",help:"[Only Current Document] Use AutoSimplify to convert to Simplified Chinese."},pre_format:{label:"Pre Format",help:"[Only Current Document] Use AutoFormat to format the text."},show_copy_content:{label:"Show Content of Copied"},note_options:{$option6:["Copy","Set as Title","Merge Title","Merge to Note","Add as Note","Add as Comment"],label:"Popup More Options",help:"If you have selected a note before selecting this text or area, some action which copied result will pop up more options to write directly into the card."}}});var Pp={name:"MagicAction for Text",key:"magicaction4text",link:S("magicaction4text"),intro:Je.intro,settings:[{key:"preOCR",type:1,label:Je.pre_OCR.label,help:Je.pre_OCR.help,bind:["quickSwitch",11]},{key:"preSimplify",type:1,label:Je.pre_simplify.label,help:Je.pre_simplify.help,bind:["quickSwitch",14]},{key:"preFormat",type:1,label:Je.pre_format.label,help:Je.pre_format.help,bind:["quickSwitch",4]},{key:"showCopyContent",type:1,label:Je.show_copy_content.label},{key:"noteOptions",type:7,label:Je.note_options.label,help:Je.note_options.help,option:Je.note_options.$option6}],actions4text:[{type:2,key:"copyText",label:Je.copy_text,method({text:e}){return e}}]};var Rp=C(T());var ge=(0,Rp.i18n)({zh:{intro:`\u5C06\u6458\u5F55\u62C6\u5206\u4E3A\u6807\u9898\uFF08\u88AB\u5B9A\u4E49\u9879\uFF09\u548C\u6458\u5F55\uFF08\u5B9A\u4E49\u9879\uFF09\u4E24\u90E8\u5206\u3002
\u5B9A\u4E49 = \u88AB\u5B9A\u4E49\u9879 + \u5B9A\u4E49\u8054\u9879 + \u5B9A\u4E49\u9879\u3002   `,on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",to_title_link:"\u522B\u540D\u8F6C\u4E3A\u591A\u4E2A\u6807\u9898",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option9:["\u81EA\u5B9A\u4E49\u63D0\u53D6\u6807\u9898","\u81EA\u5B9A\u4E49\u5B9A\u4E49\u8054\u9879","xxx : yyy","xxx \u2014\u2014 yyy","xxx \uFF0C\u662F(\u6307) yyy","xxx \u662F(\u6307)\uFF0Cyyy","xxx \u662F\u6307 yyy","yyy\uFF0C___\u79F0(\u4E4B)\u4E3A xxx","yyy(\u88AB)\u79F0(\u4E4B)\u4E3A xxx"]},title_link_split:{label:"\u9009\u62E9\u522B\u540D\u5206\u8BCD",$option3:["\u81EA\u5B9A\u4E49","\u9ED8\u8BA4","\u6807\u70B9\u7B26\u53F7"]},extract_title:{label:"\u63D0\u53D6\u6807\u9898",$option2:["\u4F7F\u7528 AutoDef \u4E2D\u7684\u8BBE\u7F6E","\u786E\u5B9A"]},split_excerpt:{label:"\u62C6\u5206\u6458\u5F55",$option2:["\u4F7F\u7528 AutoDef \u4E2D\u7684\u8BBE\u7F6E","\u786E\u5B9A"],help:"\u5C06\u6458\u5F55\u62C6\u5206\u4E3A\u6807\u9898\uFF08\u88AB\u5B9A\u4E49\u9879\uFF09\u548C\u6458\u5F55\uFF08\u5B9A\u4E49\u9879\uFF09\u4E24\u90E8\u5206\u3002"},custom_title_split:{link:S("anotherautodef","\u81EA\u5B9A\u4E49\u522B\u540D\u5206\u8BCD"),help:"\u81EA\u5B9A\u4E49\u522B\u540D\u5206\u8BCD\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"},custom_def_link:{link:S("anotherautodef","\u81EA\u5B9A\u4E49\u5B9A\u4E49\u8054\u9879"),help:"\u81EA\u5B9A\u4E49\u5B9A\u4E49\u8054\u9879\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"},custom_extract_title:{link:S("anotherautodef","\u81EA\u5B9A\u4E49\u63D0\u53D6\u6807\u9898"),help:"\u81EA\u5B9A\u4E49\u63D0\u53D6\u6807\u9898\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"}},en:{intro:`Split the excerpt into two parts: title (definiendum) and excerpt (definiens).
Definition = Definiendum + Connective + Definiens.                                          `,on:"Auto Run When Excerpting",to_title_link:"Convert Alias To Muilt Titles",title_link_split:{$option3:["Custom","Default","Punctuation"],label:"Select Alias Separator"},preset:{$option9:["Custom Titles Extraction","Custom Definition Connective","xxx : yyy","xxx \u2014\u2014 yyy","xxx \uFF0C\u662F(\u6307) yyy","xxx \u662F(\u6307)\uFF0Cyyy","xxx \u662F\u6307 yyy","yyy\uFF0C___\u79F0(\u4E4B)\u4E3A xxx","yyy(\u88AB)\u79F0(\u4E4B)\u4E3A xxx"],label:"Select Presets"},extract_title:{label:"Extract Title",$option2:["Use AutoDef Settings","Confirm"]},split_excerpt:{label:"Split Excerpt Text",$option2:["Use AutoDef Settings","Confirm"],help:"Split the excerpt into title (definiendum) and excerpt (definiens) parts."},custom_title_split:{link:S("anotherautodef","custom-alias-separator"),help:"Customize alias separator, click for specific format."},custom_def_link:{link:S("anotherautodef","custom-definition-connective"),help:"Customize definition connective, click for the specific format."},custom_extract_title:{link:S("anotherautodef","custom-titles-extraction"),help:"Customize titles extraction, click for specific format."}}});function Sn(e){if(!self.globalProfile.anotherautodef.toTitleLink)return[e];let t=[],{titleLinkSplit:r}=self.globalProfile.anotherautodef,{customTitleSplit:o}=self.tempProfile.regArray;r.includes(0)&&o&&t.push(...o),r.includes(1)&&t.push([/或者?|[简又]?称(?:之?为)?/g]),r.includes(2)&&t.push([/[、。,，‘’“”"『』()（）【】「」《》«»\/\[\]]/g]);let n=t.reduce((i,s)=>{if(!s.length)return i;let l=s[0],a=e.match(l);return a&&s.slice(1).every(c=>c.test(a[0]))?i.replace(Pt.add(l,"g"),"orogxng"):i},e).split("orogxng").reduce((i,s)=>(s=s.trim(),s&&i.push(s),i),[]);return n.length>1?Rt(n):[e]}function Ui(e,t,r){if(!t)return;let{preset:o}=self.globalProfile.anotherautodef;if(r===void 0&&o.includes(0)&&(r=self.tempProfile.replaceParam.customExtractTitle),!(r!=null&&r.length))return;let n=r.reduce((i,s)=>{let{newSubStr:l}=s,{regexp:a}=s;return a=Pt.add(a,"g"),a.test(t)&&i.push(...t.match(a).map(c=>c.replace(a,me(e,l)))),i},[]);if(n.length)return{title:Rt(n.map(i=>Sn(i)).flat()),text:t}}function Px(e,t){if(!!e){if(t===void 0){let{customDefLink:r}=self.tempProfile.regArray;t=r}if(!!(t!=null&&t.length))for(let r of t){if(!r.length)continue;let o=!1,n=r[0];n.sticky&&(n=Pt.remove(n,"y"),o=!0);let i=e.match(n);if((i==null?void 0:i.length)&&r.slice(1).every(s=>s.test(i[0]))){let[s,l]=e.split(n).filter(a=>a);return o&&([s,l]=[l,s]),{title:Sn(s),text:l}}}}}function Fi(e,t){if(!e)return;let{preset:r}=self.globalProfile.anotherautodef;for(let o of r)switch(o){case 1:{let n=Px(e,t);if(n)return n;break}case 2:case 3:case 4:case 5:case 6:{let n=[/[：:]/,/[一—]{2}/,/[,，]\s*(?:通常|一般)*是指?/,/(?:通常|一般)*是指?\s*[,，]/,/(?:通常|一般)*是指/][o-2];if(n.test(e)){let[i,s]=e.split(n);return{title:Sn(i),text:s}}break}case 7:case 8:{let n=[/[,，].*称之?为/,/(?:通常|一般)?被?称之?为/][o-7];if(n.test(e)){let[i,s]=e.split(n);return{title:Sn(s),text:i}}break}}}var Ap={name:"Another AutoDef",key:"anotherautodef",intro:ge.intro,link:S("anotherautotitle"),settings:[{key:"on",type:1,label:ge.on,auto:{generateTitles({node:e,text:t}){let r=Ui(e,t);if(r!=null&&r.title.length)return r;let o=Fi(t);if(o!=null&&o.title.length)return o}}},{key:"preset",type:7,option:ge.preset.$option9,label:ge.preset.label},{key:"customExtractTitle",type:4,help:ge.custom_extract_title.help,link:ge.custom_extract_title.link,bind:["preset",0],check({input:e}){bt(e)}},{key:"customDefLink",type:4,help:ge.custom_def_link.help,link:ge.custom_def_link.link,bind:["preset",1],check({input:e}){co(e)}},{key:"toTitleLink",type:1,label:ge.to_title_link,bind:["preset",[0,1,2,3,4,5,6,7,8]]},{type:7,key:"titleLinkSplit",label:ge.title_link_split.label,option:ge.title_link_split.$option3,bind:[["toTitleLink",!0],["preset",[0,1,2,3,4,5,6,7,8]]]},{key:"customTitleSplit",type:4,help:ge.custom_title_split.help,link:ge.custom_title_split.link,bind:[["toTitleLink",!0],["titleLinkSplit",0],["preset",[0,1,2,3,4,5,6,7,8]]],check({input:e}){co(e)}}],actions4card:[{type:3,label:ge.extract_title.label,option:ge.extract_title.$option2,key:"extractTitle",method:({nodes:e,content:t,option:r})=>{let o;if(r!=0)if(t)o=xe(t);else return;e.forEach(n=>{if(!n.note.excerptPic||n.isOCR){let i=[];n.notes.forEach(s=>{let l=s.excerptText;if(l){let a=Ui(n,l,o);a!=null&&a.title.length&&i.push(...a.title)}}),n.appendTitles(...i)}})},check({input:e}){At(e)}},{type:3,label:ge.split_excerpt.label,key:"splitExcerpt",option:ge.split_excerpt.$option2,help:ge.split_excerpt.help,method:({nodes:e,content:t,option:r})=>{let o;if(r!=0)if(t)o=Ht(t);else return;e.forEach(n=>{var i;if(!((i=n.note.excerptPic)!=null&&i.paint)||n.isOCR){let s=[];n.notes.forEach(l=>{let a=l.excerptText;if(a){let c=Fi(a,o);c!=null&&c.title.length&&(s.push(...c.title),n.mainExcerptText=c.text)}}),n.titles=s}})}}]};var Dp=C(T());var Op=C(T());var ht=(0,Op.i18n)({zh:{intro:"\u81EA\u52A8\u5C06\u6458\u5F55\u8F6C\u4E3A\u6807\u9898\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option3:["\u81EA\u5B9A\u4E49","\u5B57\u6570","\u4E0D\u542B\u6709\u70B9\u53F7"]},word_count:{help:"[\u7C7B\u4E2D\u6587\u5B57\u6570, \u7C7B\u82F1\u6587\u5355\u8BCD\u6570]\uFF0C\u6CA1\u8D85\u8FC7\u5C31\u81EA\u52A8\u8BBE\u7F6E\u4E3A\u6807\u9898\u3002",enter_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570",input_array:"\u8BF7\u8F93\u5165\u6570\u7EC4\uFF0C\u6BD4\u5982 [10,5]",input_three_number:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u4E24\u4E2A\u6570\u5B57\uFF0C\u6BD4\u5982 [10,5]"},custom_be_title:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:S("anotherautotitle","\u81EA\u5B9A\u4E49")}},en:{intro:"Automatically convert the excerpt to the title.",on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option3:["Custom","Word Count","Not Contain Dot Symbols"]},word_count:{help:"[Chinese words, English words], if not exceeded, then set the excerpt text as the title",enter_positive:"Please enter a positive integer",input_array:"Please enter an array, for example [10,5]",input_three_number:"There must be two numbers in the array\uFF0Cfor example [10,5]"},custom_be_title:{help:"Customize. Click for specific formats",link:S("anotherautotitle","custom")}}});function Rx(e){let{preset:t,wordCount:r}=self.globalProfile.anotherautotitle;self.excerptStatus.isModify&&(e=(0,Dp.removeHighlight)(e));let o=(()=>{for(let n of t)switch(n){case 0:let{customBeTitle:i}=self.tempProfile.regArray;if(!i)continue;if(i.some(c=>c.every(u=>u.test(e))))return e;break;case 1:if(!r)continue;let[s,l]=M(r);if(kr(e)<=(gt(e)?l:s))return e;break;case 2:if(!/[。.、？?！!，,；;：:]/.test(e))return e}})();if(o)return{title:[o],text:""}}var Lp={name:"Another AutoTitle",key:"anotherautotitle",intro:ht.intro,link:S("anotherautotitle"),settings:[{key:"on",type:1,label:ht.on,auto:{generateTitles:{index:999,method({text:e}){return Rx(e)}}}},{key:"preset",type:7,option:ht.preset.$option3,label:ht.preset.label},{key:"customBeTitle",type:4,help:ht.custom_be_title.help,bind:["preset",0],link:ht.custom_be_title.link,check({input:e}){co(e)}},{key:"wordCount",type:4,bind:["preset",1],help:ht.word_count.help,check({input:e}){if(e=M(e),!Array.isArray(e))throw ht.word_count.input_array;if(e.length!==2)throw ht.word_count.input_three_number;if(e.some(t=>!Number.isInteger(t)))throw ht.word_count.enter_positive}}]};var Mp=C(T());var Lt=(0,Mp.i18n)({zh:{intro:"\u81EA\u52A8\u4ECE\u6458\u5F55\u4E2D\u63D0\u53D6\u8BC4\u8BBA\u6216\u8005\u5728\u7279\u5B9A\u65F6\u5019\u81EA\u52A8\u6DFB\u52A0\u8BC4\u8BBA\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option:["\u81EA\u5B9A\u4E49"]},add_comment:{label:"\u6DFB\u52A0\u8BC4\u8BBA",$option2:["\u4F7F\u7528 AutoComment \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_comment:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:S("autocomment")}},en:{intro:"Automatically extract comments from excerpts or add comments at a specific time.",on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option:["Custom"]},add_comment:{$option2:["Use AutoComment Settings","Confirm"],label:"Add Comment"},custom_comment:{help:"Customize. Click for specific formats.",link:S("autocomment")}}});function Bp(e,t){if(!t)return;let{preset:r}=self.globalProfile.autocomment,{customComment:o}=self.tempProfile.replaceParam,n=[];return r.includes(0)&&(o==null?void 0:o.length)&&o.forEach(({newSubStr:i,regexp:s})=>{s=Pt.add(s,"g"),s.test(t)&&n.push(...t.match(s).map(l=>l.replace(s,me(e,i))))}),n}var Up={name:"AutoComment",key:"autocomment",intro:Lt.intro,link:S("autocomment"),settings:[{key:"on",type:1,label:Lt.on,auto:{generateComments({node:e,text:t}){return Bp(e,t)}}},{key:"preset",type:7,option:Lt.preset.$option,label:Lt.preset.label},{key:"customComment",type:4,help:Lt.custom_comment.help,bind:["preset",0],link:Lt.custom_comment.link,check({input:e}){bt(e)}}],actions4card:[{type:3,label:Lt.add_comment.label,key:"addComment",option:Lt.add_comment.$option2,method({nodes:e,option:t,content:r}){if(t==0)e.forEach(o=>{var s;let n=o.excerptsText.join(`
`);((s=o.note.excerptPic)==null?void 0:s.paint)&&o.isOCR===!1&&(n="@picture");let i=Bp(o,n);i!=null&&i.length&&o.appendTextComments(...i)});else if(r)if(/^\(.+\)$/.test(r)){let o=xe(r);e.forEach(n=>{var l;let i=n.excerptsText.join(`
`);((l=n.note.excerptPic)==null?void 0:l.paint)&&n.isOCR===!1&&(i="@picture");let s=ao(i,o.map(a=>({...a,newSubStr:me(n,a.newSubStr)})));n.appendTextComments(...s)})}else e.forEach(o=>{o.appendTextComments(me(o,M(`${ce(r)}`,!0)))})},check({input:e}){/^\(.+\)$/.test(e)?At(e):Xe(e)}}]};var gr=C(T());var Fp=C(T());var H=(0,Fp.i18n)({zh:{intro:"\u8865\u5168\u5355\u8BCD\u8BCD\u5F62\uFF0C\u53EA\u652F\u6301\u52A8\u8BCD\u548C\u540D\u8BCD\u3002\u987A\u4FBF\u63D0\u4F9B\u8BCD\u4E49\u8865\u5145\u548C\u4E0A\u4E0B\u6587\u6458\u5F55\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",loading:"\u6B63\u5728\u5236\u5361...",custom:"\u81EA\u5B9A\u4E49",complete_selected:"\u8865\u5168\u5355\u8BCD\u8BCD\u5F62",select_meaning:{label:"\u52A8\u6001\u9009\u62E9\u91CA\u4E49",$option2:["\u4E2D\u6587","\u82F1\u6587"]},maybe_other_word:"\u68C0\u6D4B\u5230\u5F53\u524D\u5355\u8BCD\u65E2\u53EF\u80FD\u662F\u5176\u4ED6\u5355\u8BCD\u7684\u53D8\u5F62\uFF0C\u4E5F\u53EF\u80FD\u5C31\u662F\u539F\u5F62\uFF0C\u8BF7\u9009\u62E9\u5355\u8BCD\u539F\u5F62",select_lemma:"\u52A8\u6001\u9009\u62E9\u5355\u8BCD\u539F\u5F62",complete_word:{label:"\u82F1\u6587\u5355\u8BCD\u5236\u5361",$option2:["\u8FFD\u52A0","\u66FF\u6362"]},custom_fill:"\u81EA\u5B9A\u4E49\u5355\u8BCD\u586B\u5145\u4FE1\u606F\uFF08\u4E8C\uFF09",custom_fill_front:{help:"\u81EA\u5B9A\u4E49\u5355\u8BCD\u586B\u5145\u4FE1\u606F\uFF08\u4E00\uFF09\uFF0C\u70B9\u51FB\u67E5\u770B\u652F\u6301\u53D8\u91CF\uFF0C\u5F53\u524D\u8F93\u5165\u680F\u4E0D\u5141\u8BB8\u4F7F\u7528 {{zh}} \u548C {{en}}\u3002",link:S("autocomplete"),error:"\u5F53\u524D\u8F93\u5165\u680F\u4E0D\u5141\u8BB8\u4F7F\u7528 {{zh}} \u6216 {{en}}"},auto_context:{help:"\u76EE\u524D\u4E0D\u652F\u6301 OCR Pro\uFF0C\u5FC5\u987B PDF \u81EA\u5E26\u6587\u5B57\u5C42\u3002     ",label:"\u81EA\u52A8\u6458\u5F55\u4E0A\u4E0B\u6587"},collins:{label:"\u67EF\u6797\u65AF\u661F\u7EA7\u7B5B\u9009",$option6:["\u96F6","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94"],help:"\u661F\u8D8A\u591A\u4EE3\u8868\u8D8A\u5E38\u7528\uFF0C\u4F46\u4E5F\u8D8A\u7B80\u5355\uFF0C\u6CA1\u6709\u9009\u4E2D\u7684\u661F\u7EA7\u5355\u8BCD\u4F1A\u88AB\u6392\u9664\uFF0C\u4E0D\u4F1A\u89E6\u53D1\u3002"},fill_word_info:{label:"\u586B\u5145\u5355\u8BCD\u4FE1\u606F",$option3:["\u4E0D\u586B\u5145","\u81EA\u5B9A\u4E49","\u4E2D\u6587\u91CA\u4E49"]},data_source:{label:"\u6570\u636E\u6765\u6E90",$option2:["\u5728\u7EBF API","\u672C\u5730\u6570\u636E\u5E93"],help:"\u5728\u56FD\u5916\u7684\u7528\u6237\u8BF7\u9009\u62E9\u672C\u5730\u6570\u636E\u5E93\u3002\u53EF\u4EE5\u5728 OhMyMN \u7684 QQ \u9891\u9053\u4E2D\u4E0B\u8F7D\u3002"},not_find_word:"\u67E5\u8BE2\u4E0D\u5230\u8BE5\u5355\u8BCD",forbid:"\u4E3A\u51CF\u5C0F\u670D\u52A1\u5668\u538B\u529B\uFF0C\u7981\u6B62\u540C\u65F6\u5904\u7406\u8D85\u8FC7 5 \u5F20\u5361\u7247\u3002\u5982\u679C\u9700\u8981\u5927\u91CF\u5236\u5361\uFF0C\u8BF7\u4F7F\u7528\u672C\u5730\u6570\u636E\u5E93\u3002",choose_meaning:"\u9009\u62E9\u5728\u6587\u4E2D\u7684\u91CA\u4E49",not_find_db:"\u6CA1\u6709\u627E\u5230\u6570\u636E\u5E93"},en:{intro:"Complete word form. Only support verbs and nouns.",on:"Auto Run When Excerpting",custom_fill:"Custom excerption filling template, click for support variables",custom_fill_front:{help:"Custom excerption filling template, click for support variables.",link:S("autocomplete"),error:"The input bar is not allowed to use {{zh}} or {{en}}"},custom:"Custom",complete_selected:"Complete Word Form",loading:"Loading...",select_lemma:"Dynamic Basic Form Selection",maybe_other_word:"The word may be the basic form or the inflected form, choose you want.",select_meaning:{label:"Dynamic Interpretation Selection",$option2:["Chinese","English"]},complete_word:{label:"Generate Word Card",$option2:["Append","Replace"]},auto_context:{label:"Auto Excert Context",help:"Currently not support OCR Pro, only PDF with text layer."},collins:{label:"Collins Star Filtering",$option6:["Zero","One","Two","Three","Four","Five"],help:"The more stars, the more common, but also the simpler, the words without the selected star level will be excluded, and will not trigger."},fill_word_info:{label:"Fill in Word Info",$option3:["Not Fill","Custom","Chinese Meaning"]},data_source:{label:"Data Source",$option2:["Online API","Local Database"],help:"For users outside of China, please choose local database. You can download it in Github Release."},not_find_word:"No matching words found",forbid:"To reduce server pressure, it is forbidden to process more than 5 cards at the same time. If you need to make a lot of word cards, please use the local database.",choose_meaning:"Select the meanings in the text.",not_find_db:"No database found"}});var qp=C(T()),Te=C(T());var jp=C(T());var Y="\u2E80-\u2EFF\u2F00-\u2FDF\u3040-\u309F\u30A0-\u30FA\u30FC-\u30FF\u3100-\u312F\u3200-\u32FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF",Ax=new RegExp(`([${Y}])[ ]*([\\:]+|\\.)[ ]*([${Y}])`,"g"),Ox=new RegExp(`([${Y}])[ ]*([~\\!;,\\?]+)[ ]*`,"g"),Dx=new RegExp(`([\\.]{2,}|\u2026)([${Y}])`,"g"),Lx=new RegExp(`([${Y}])\\:([A-Z0-9\\(\\)])`,"g"),Mx=new RegExp(`([${Y}])([\`"\u05F4])`,"g"),Bx=new RegExp(`([\`"\u05F4])([${Y}])`,"g"),Ux=/([`"\u05f4]+)[ ]*(.+?)[ ]*([`"\u05f4]+)/g,Fx=new RegExp(`([${Y}])('[^s])`,"g"),Gx=new RegExp(`(')([${Y}])`,"g"),qx=new RegExp(`([A-Za-z0-9${Y}])( )('s)`,"g"),jx=new RegExp(`([${Y}])(#)([${Y}]+)(#)([${Y}])`,"g"),Wx=new RegExp(`([${Y}])(#([^ ]))`,"g"),Kx=new RegExp(`(([^ ])#)([${Y}])`,"g"),Vx=new RegExp(`([${Y}])([\\+\\-\\*\\/=&\\|<>])([A-Za-z0-9])`,"g"),Hx=new RegExp(`([A-Za-z0-9])([\\+\\-\\*\\/=&\\|<>])([${Y}])`,"g"),zx=/([/]) ([a-z\-_\./]+)/g,Xx=/([/\.])([A-Za-z\-_\./]+) ([/])/g,Jx=new RegExp(`([${Y}])([\\(\\[\\{<>\u201C])`,"g"),Yx=new RegExp(`([\\)\\]\\}<>\u201D])([${Y}])`,"g"),Zx=/([\(\[\{<\u201c]+)[ ]*(.+?)[ ]*([\)\]\}>\u201d]+)/,Qx=new RegExp(`([A-Za-z0-9${Y}])[ ]*([\u201C])([A-Za-z0-9${Y}\\-_ ]+)([\u201D])`,"g"),ew=new RegExp(`([\u201C])([A-Za-z0-9${Y}\\-_ ]+)([\u201D])[ ]*([A-Za-z0-9${Y}])`,"g"),tw=/([A-Za-z0-9])([\(\[\{])/g,rw=/([\)\]\}])([A-Za-z0-9])/g,ow=new RegExp(`([${Y}])([A-Za-z\u0370-\u03FF0-9@\\$%\\^&\\*\\-\\+\\\\=\\|/\xA1-\xFF\u2150-\u218F\u2700\u2014\u27BF])`,"g"),nw=new RegExp(`([A-Za-z\u0370-\u03FF0-9~\\$%\\^&\\*\\-\\+\\\\=\\|/!;:,\\.\\?\xA1-\xFF\u2150-\u218F\u2700\u2014\u27BF])([${Y}])`,"g"),iw=/(%)([A-Za-z])/g,sw=/([ ]*)([\u00b7\u2022\u2027])([ ]*)/g,lw=new RegExp(`([${Y}]) ([${Y}])`,"g"),Gi=class{constructor(){as(this,"version")}convertToFullwidth(t){return t.replace(/~/g,"\uFF5E").replace(/!/g,"\uFF01").replace(/;/g,"\uFF1B").replace(/:/g,"\uFF1A").replace(/,/g,"\uFF0C").replace(/\./g,"\u3002").replace(/\?/g,"\uFF1F")}toFullwidth(t){let r=t,o=this;return r=r.replace(Ax,(n,i,s,l)=>{let a=o.convertToFullwidth(s);return`${i}${a}${l}`}),r=r.replace(Ox,(n,i,s)=>{let l=o.convertToFullwidth(s);return`${i}${l}`}),r}spacing(t){let r=t;return r=r.replace(Dx,"$1 $2"),r=r.replace(Lx,"$1\uFF1A$2"),r=r.replace(Mx,"$1 $2"),r=r.replace(Bx,"$1 $2"),r=r.replace(Ux,"$1$2$3"),r=r.replace(Fx,"$1 $2"),r=r.replace(Gx,"$1 $2"),r=r.replace(qx,"$1's"),r=r.replace(jx,"$1 $2$3$4 $5"),r=r.replace(Wx,"$1 $2"),r=r.replace(Kx,"$1 $3"),r=r.replace(Vx,"$1 $2 $3"),r=r.replace(Hx,"$1 $2 $3"),r=r.replace(zx,"$1$2"),r=r.replace(Xx,"$1$2$3"),r=r.replace(Jx,"$1 $2"),r=r.replace(Yx,"$1 $2"),r=r.replace(Zx,"$1$2$3"),r=r.replace(Qx,"$1 $2$3$4"),r=r.replace(ew,"$1$2$3 $4"),r=r.replace(tw,"$1 $2"),r=r.replace(rw,"$1 $2"),r=r.replace(ow,"$1 $2"),r=r.replace(nw,"$1 $2"),r=r.replace(iw,"$1 $2"),r=r.replace(sw,"\u30FB"),r=r.replace(lw,"$1$2"),r}},Ar=new Gi;async function Wp(e,t,r){let o=Object.entries(e).map(s=>s[1].map(l=>`${s[0]}. ${l}`)).flat().slice(0,9),{option:n,content:i}=await(0,Te.popup)({title:r,message:t,buttons:[...o.map((s,l)=>`(${l+1}) ${s}`),H.custom],multiLine:!0,canCancel:!0,type:jp.UIAlertViewStyle.PlainTextInput},({alert:s,buttonIndex:l})=>({option:l,content:s.textFieldAtIndex(0).text}));if(n<o.length)return o[n];if(i)return M(i,!0).replace(/\s*\[\s*([a-z]+)\s*\]\s*/,(s,l)=>l==="all"?Object.entries(e).map(a=>`${a[0]}. ${a[1].join("; ")}`).join(`
`):l in e?`${l}. ${e[l].join("; ")}`:"").replace(/\s*\[([0-9\-]+)\]\s*/,(s,l)=>{let a=Array.from({length:o.length},(c,u)=>u+1).join(", ").match(new RegExp(`[${l}]`,"g"));return a!=null&&a.length?`
`+Object.entries(a.reduce((c,u)=>{var h;let[p,f]=o[Number(u)-1].split(/^(\w+)\.\s*/).filter(d=>d);return c[p]=[...(h=c[p])!=null?h:[],f],c},{})).map(c=>`${c[0]}. ${c[1].join("; ")}`).join(`
`)+`
`:""}).trim()}async function aw(e,t=!1){let o=Ar.spacing(Ar.toFullwidth(e)).split(`
`).reduce((n,i)=>(/人名|\[.+\]/.test(i)||n.push(i.replace(/^a\.\s*/gm,"adj. ")),n),[]);if(t){let n={};if(o.forEach(i=>{var a,c;let[s,l]=i.split(/^(\w+)\.\s*/).filter(u=>u);l?/[；;]/.test(l)?n[s]=[...(a=n[s])!=null?a:[],...l.split(/\s*[；;]\s*/).map(u=>u)]:n[s]=[...(c=n[s])!=null?c:[],...l.split(/\s*[,，]\s*/).map(u=>u)]:n.un=[i]}),Object.values(n).flat().length>1)return await Wp(n,H.choose_meaning,g.title)}return o.join(`
`)}async function cw(e,t=!1){let r=e.split(`
`).map(o=>o.replace(/^a\.\s*/gm,"adj. ").replace(/^[rs]\.\s*/gm,"adv. "));if(t){let o={};if(r.forEach(n=>{var l,a;let[i,s]=n.split(/^(\w+)\.\s*/).filter(c=>c);s?/[；;]/.test(s)?o[i]=[...(l=o[i])!=null?l:[],...s.split(/\s*[；;]\s*/).map(c=>c)]:o[i]=[...(a=o[i])!=null?a:[],...s.split(/\s*[,，]\s*/).map(c=>c)]:o.un=[n]}),Object.values(o).flat().length>1)return await Wp(o,H.choose_meaning,g.title)}return r.join(`
`)}async function qi(e){let{dataSource:t}=self.globalProfile.autocomplete;function r(o){let n={};return Object.entries(o).forEach(([i,s])=>{(0,Te.isNSNull)(s)||!s?n[i]=void 0:Number.isNaN(Number(s))?n[i]=s:n[i]=Number(s)}),n}if(t[0]===0){let n=(await(0,Te.fetch)("http://dict.e.opac.vip/dict.php?sw="+e).then(i=>i.json())).filter(i=>i.word==i.sw);if(!n.length)throw"";return r(n[0])}else{if(!g.dataAutoComplete)if((0,Te.isfileExists)(`${g.path}/AutoCompleteData.db`))g.dataAutoComplete=SQLiteDatabase.databaseWithPath(`${g.path}/AutoCompleteData.db`),g.dataAutoComplete.open();else throw H.not_find_db;let o=g.dataAutoComplete.executeQueryWithArgumentsInArray(`SELECT * FROM stardict WHERE word = '${e}'`,[]),n;for(;o.next();)n=o.resultDictionary();if(o.close(),!n)throw"";return r(n)}}function uw(e){return[["zk","\u4E2D\u8003"],["gk","\u9AD8\u8003"],["cet4","\u56DB\u7EA7"],["cet6","\u516D\u7EA7"],["ky","\u8003\u7814"],["gre","GRE"],["toefl","\u6258\u798F"],["ielts","\u96C5\u601D"]].reduce((r,o)=>r.replace(o[0],o[1]),e).split(/\x20+/).filter(r=>r)}function pw(e){return"\u2B50".repeat(e)}function Gp(e,t){if(e)if(t){let r=t(e);if(r)return r}else return e}async function fw(e){let{customFill:t,customFillFront:r,fillWordInfo:o,selectMeanings:n}=self.globalProfile.autocomplete;if(o[0]===0)return["",""];let i=o[0]===1?M(`"${ce(r)}"`):"",s=o[0]===1?M(`"${ce(t)}"`):"{{zh}}",l=async(a,c=[])=>{let u,p;/{{\s*zh\s*}}/.test(a)&&e.translation&&(p=await aw(e.translation,c.includes(0))),/{{\s*en\s*}}/.test(a)&&e.definition&&(u=await cw(e.definition,c.includes(1)));let f={word:e.word,phonetic:e.phonetic,tags:Gp(e.tag,h=>uw(h).join("/")),collins:Gp(e.collins,h=>pw(h)),en:u,zh:p};return ho(a,f).trim()};return[await l(i),await l(s,n)]}function hw(e,t){return t?Object.entries(Kp(t)).reduce((r,o)=>{let[n,i]=o;return n!=="current"&&n!=="lemma"&&!r.includes(i)&&r.push(i),r},[e]):[e]}function Kp(e){let t={};return e.split("/").forEach(r=>{let[o,n]=r.split(":");switch(o){case"s":t.s=n;break;case"d":t.done=n;break;case"p":t.did=n;break;case"i":t.doing=n;break;case"3":t.does=n;break;case"r":t.er=n;break;case"t":t.est=n;break;case"0":t.lemma=n;break;case"1":t.current=n;break}}),t}function dw(e,t){var r;try{let o=(r=Te.MN.db.getDocumentById(e.docMd5))==null?void 0:r.textContentsForPageNo(e.startPage),[n,i,s,l]=M(`[${e.startPos},${e.endPos}]`),a=i<l?i:l,c=n<s?n:s;if(o!=null&&o.length){let u=o.reduce((E,R)=>{let{y:F}=(0,Te.CGRectValue2CGRect)(R[0].rect),ie=F-a;if(ie<50&&ie>-50){let m=0,b=R.reduce((w,x)=>{if(w+=String.fromCharCode(Number(x.char)),m!==1&&ie<5&&ie>-5){let{x:se}=(0,Te.CGRectValue2CGRect)(x.rect);se-c<5&&se-c>-5?(m=1,w+="orogxng"):m=2}return w},"");if(b=b.replace(yn,".$1."),m===1){let w=b.indexOf("orogxng");b=b.replace("orogxng","");let x=b.match(new RegExp(t,"g"));if(!(x!=null&&x.length))throw"";x.length===1?b=b.replace(t,"orogxng"):b=b.replace(new RegExp(t,"g"),(se,Qt)=>w-Qt>-5&&w-Qt<5?"orogxng":se)}/[ \-]$/.test(b)||(b+=" "),E.length&&!/-$/.test(E[E.length-1].text)&&/^(?:\s+|[A-Z]\w*|[^A-Za-z-])/.test(b)&&(E[E.length-1].text=E[E.length-1].text.trim()+"..."),b&&E.push({text:b,flag:m,des:ie,index:E.length})}return E},[]),p=u.filter(E=>E.flag!==0);if(p.length>1){let E=p.findIndex(R=>R.flag===1);E===0?u=u.slice(0,p[E+1].index):E===p.length-1?u=u.slice(p[E-1].index):u=u.slice(p[E-1].index,p[E+1].index)}let f=u.map(E=>E.text).join(""),[h,d]=f.split(/\s*orogxng\s*/);h=h.replace(/^.*(?:[?!。？！…;；]|\.(?!\d))\s*(.*)$|^\s*(.*)$/,"$1$2"),d=d.replace(/^(\s*.*?(?:[?!。？！…;；]|\.(?!\d))).*$|^(.*)\s*$/,"$1$2");let y=[h,/\W$/.test(h)?"":" ",t,/^\W/.test(h)?"":" ",d].join("").replace(/^\.+/,"").replace(/^[\[【(]?(?:\d+|[A-Za-z])[\]】)]/,"");if(!/^\w+$/.test(y))return y}}catch{return}}async function mw(e){let t=await qi(e),{exchange:r}=t;if(r){let o=Kp(r),{lemma:n,current:i}=o;if(n&&i)if(Object.keys(o).length>2&&self.globalProfile.autocomplete.selectLemma){if(await(0,Te.selectIndex)([e,n],g.title,H.maybe_other_word))return await qi(n)}else return e=n,await qi(n)}return t}async function ji(e,t){var r;try{let o=e.replace(new RegExp(`^[^${It}a-zA-Z]*(\\w+)[^${It}a-zA-Z]*$`,"g"),"$1");if(!/^\w[a-z]+$/.test(o))return;let n=o.toLowerCase(),i=await mw(n),{collins:s,autoContext:l}=self.globalProfile.autocomplete;if(i.collins&&!s.includes(Number(i.collins))||!i.collins&&!s.includes(0))return;let a=hw(i.word,i.exchange),c=l&&(r=dw(t,o))!=null?r:"";return{title:a,comments:[...await fw(i)],text:c}}catch(o){qp.dev.error(o),o&&(0,Te.showHUD)(String(o),2);return}}var Vp={name:"AutoComplete",key:"autocomplete",intro:H.intro,link:S("autocomplete"),settings:[{key:"on",type:1,label:H.on,auto:{generateTitles:{index:-999,method({text:e,note:t}){return ji(e,t)}}}},{key:"collins",type:7,option:H.collins.$option6,label:H.collins.label,help:H.collins.help},{key:"dataSource",type:6,option:H.data_source.$option2,label:H.data_source.label,help:H.data_source.help},{key:"fillWordInfo",type:6,option:H.fill_word_info.$option3,label:H.fill_word_info.label},{key:"customFillFront",type:4,help:H.custom_fill_front.help,bind:["fillWordInfo",1],link:H.custom_fill_front.link,check({input:e}){if(Xe(e),/{{\s*(?:zh|en)\s*}}/.test(e))throw H.custom_fill_front.error}},{key:"customFill",type:4,help:H.custom_fill,bind:["fillWordInfo",1],check({input:e}){Xe(e)}},{key:"selectMeanings",type:7,option:H.select_meaning.$option2,label:H.select_meaning.label,bind:[[["fillWordInfo",1],["fillWordInfo",2]]]},{key:"selectLemma",type:1,label:H.select_lemma},{key:"autoContext",type:1,label:H.auto_context.label,help:H.auto_context.help}],actions4card:[{key:"completeWord",type:2,label:H.complete_word.label,option:H.complete_word.$option2,method:async({nodes:e,option:t})=>{if(t===-1)return;let{dataSource:r}=self.globalProfile.autocomplete;r[0]===0&&e.length>5&&((0,gr.showHUD)(H.forbid,2),e=e.slice(0,5));let o=i=>{let s=i.titles[0];return s?ji(s,i.note):void 0},n=await(async()=>{let{selectLemma:i}=self.globalProfile.autocomplete,s=[...self.globalProfile.autocomplete.selectMeanings];e.length>1&&(self.globalProfile.autocomplete.selectLemma=!1,self.globalProfile.autocomplete.selectMeanings=[]),self.globalProfile.autocomplete.selectLemma===!1&&self.globalProfile.autocomplete.selectMeanings.length===0&&gr.HUDController.show(H.loading);let l=await Promise.all(e.map(a=>o(a)));return e.length>1&&(self.globalProfile.autocomplete.selectLemma=i,self.globalProfile.autocomplete.selectMeanings=s),l})();(0,gr.undoGroupingWithRefresh)(()=>{e.forEach((i,s)=>{let l=n==null?void 0:n[s];if(l){let{title:a,comments:c,text:u}=l;u&&(i.mainExcerptText=u),i.titles=a,i.removeCommentButLinkTag(p=>p.type==="PaintNote"||t!==1||p.type==="HtmlNote",p=>{p.appendTextComments(...c)})}})}),gr.HUDController.hidden()}}]};var Hp=C(T());var Mt=(0,Hp.i18n)({zh:{intro:"\u9488\u5BF9\u6709\u5E8F\u53F7\u7684\u6458\u5F55\uFF0C\u81EA\u52A8\u6DFB\u52A0\u6362\u884C\u3002\u6240\u6709\u9884\u8BBE\u5747\u5FC5\u987B\u5339\u914D\u5230\u4E24\u4E2A\u53CA\u4EE5\u4E0A\uFF0C\u5305\u62EC\u81EA\u5B9A\u4E49\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option4:["\u81EA\u5B9A\u4E49","ABCD...","\u4E00\u4E8C\u4E09\u56DB...","1234..."]},list_selected:{label:"\u6DFB\u52A0\u6362\u884C",$option2:["\u4F7F\u7528 AutoList \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_list:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:S("autolist")}},en:{intro:"For text with serial number, auto add line breaks. All presets need to meet a minimum of two serial numbers.",on:"Auto Run When Excerpting",custom_list:{help:"Customize. Click for specific formats",link:S("autolist")},preset:{label:"Select Presets",$option4:["Custom","ABCD...","\u4E00\u4E8C\u4E09\u56DB...","1234..."]},list_selected:{label:"Add Line Breaks",$option2:["Use AutoList Settings","Confirm"]}}});function Wi(e){var r,o,n;let{preset:t}=self.globalProfile.autolist;if(t.includes(0)){let{customList:i}=self.tempProfile.replaceParam;if(i)for(let s of i){s.regexp=Pt.add(s.regexp,"g");let l=(r=e.match(s.regexp))==null?void 0:r.length;if(l&&l>1)return Ki(e.replace(s.regexp,s.newSubStr).replace(/\n{2,}/g,`
`).trim(),s.fnKey)}}return(n=(o=(i=>{var s,l;for(let a of t.filter(c=>c!==0))switch(a){case 1:let c=bn(i)?[/\s*([(（【\[]\s*[A-Za-z]\s*[)）\]】])/g,`
$1`]:[/\s*([A-Za-z]\s*[.、，,])|\s*([(（【\[]\s*[A-Za-z]\s*[)）\]】])/g,`
$1$2`],u=(s=i.match(c[0]))==null?void 0:s.length;if(u&&u>1)return i.replace(c[0],c[1]);break;default:{let f=[[new RegExp(`s*([\u5176\u7B2C]?[${Be.chinese_number}]{1,2}[.\u3001\uFF0C,])|s*([\u5176\u7B2C][${Be.chinese_number}]{1,2})`,"g"),`
$1$2`],[/\s*([0-9]{1,2}\s*[.、，,]\D)|\s*([(（【\[]\s*[0-9]{1,2}\s*[)）\]】])/g,`
$1$2`]][a-2],h=(l=i.match(f[0]))==null?void 0:l.length;if(h&&h>1)return i.replace(f[0],f[1]);break}}})(e))==null?void 0:o.replace(/\n{2,}/g,`
`).trim())!=null?n:e}function Ki(e,t){if(t<=0)return e;switch(t){case 0:return e;case 2:case 3:{let r=[Be.capital_letter,Be.lowercase_letter][t-2],o=0;return e.replace(/^/gm,n=>`${r[o++]}. ${n}`)}case 4:case 5:{let r=[Be.chinese_capital_number,Be.chinese_number][t-4],o=0;return e.replace(/^/gm,n=>`${r[o++]}\u3001${n}`)}case 6:case 7:{let r=[Be.hollow_circle_number,Be.solid_circle_number][t-6],o=0;return e.replace(/^/gm,n=>`${r[o++]} ${n}`)}default:{let r=1;return e.replace(/^/gm,o=>`${r++}. ${o}`)}}}var zp={name:"AutoList",key:"autolist",intro:Mt.intro,link:S("autolist"),settings:[{key:"on",type:1,label:Mt.on,auto:{modifyExcerptText:{index:2,method({text:e}){return Wi(e)}}}},{key:"preset",type:7,option:Mt.preset.$option4,label:Mt.preset.label},{key:"customList",type:4,help:Mt.custom_list.help,bind:["preset",0],link:Mt.custom_list.link,check({input:e}){bt(e)}}],actions4card:[{type:3,label:Mt.list_selected.label,key:"listCard",option:Mt.list_selected.$option2,method({nodes:e,content:t,option:r}){if(r==0)e.forEach(o=>{o.notes.forEach(n=>{let i=n.excerptText;i&&(n.excerptText=Wi(i))})});else if(t){let o=xe(t),{regexp:n,fnKey:i,newSubStr:s}=o[0];e.forEach(l=>{l.notes.forEach(a=>{let c=a.excerptText;c&&(a.excerptText=Ki(c.replace(n,s).replace(/\n{2,}/g,`
`).trim(),i))})})}},check({input:e}){At(e)}}]};var Tn=C(T());var Xp=C(T());var z=(0,Xp.i18n)({zh:{intro:"\u4F7F\u7528\u767E\u5EA6 OCR \u670D\u52A1\u5728\u6458\u5F55\u65F6\u8FDB\u884C\u5C0F\u8BED\u79CD\u7684\u5728\u7EBF\u77EB\u6B63\u3002      ",on:{label:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011"},lang:{$option21:["\u81EA\u52A8\u68C0\u6D4B","\u4E2D\u82F1\u6587\u6DF7\u5408","\u82F1\u6587","\u65E5\u8BED","\u97E9\u8BED","\u6CD5\u8BED","\u897F\u73ED\u7259\u8BED","\u8461\u8404\u7259\u8BED","\u5FB7\u8BED","\u610F\u5927\u5229\u8BED","\u4FC4\u8BED","\u4E39\u9EA6\u8BED","\u8377\u5170\u8BED","\u9A6C\u6765\u8BED","\u745E\u5178\u8BED","\u5370\u5C3C\u8BED","\u6CE2\u5170\u8BED","\u7F57\u9A6C\u5C3C\u4E9A\u8BED","\u571F\u8033\u5176\u8BED","\u5E0C\u814A\u8BED","\u5308\u7259\u5229\u8BED"],help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011",label:"\u8BC6\u522B\u8BED\u8A00"},formula_ocr:{label:"\u516C\u5F0F\u8BC6\u522B",$option3:["Pure Latex","$ Latex $","$$ Latex $$"],help:'"Markdown" \u63D2\u4EF6\u8BF7\u9009\u62E9 Pure Latex'},formula_ocr_providers:{label:"\u516C\u5F0F\u8BC6\u522B\u63D0\u4F9B\u5546",$option2:["\u767E\u5EA6","Mathpix"],help:"\u516C\u5F0F\u8BC6\u522B\u4E0D\u652F\u6301\u6458\u5F55\u65F6\u81EA\u52A8\u8BC6\u522B\uFF0C\u53EA\u80FD\u5728 MagicAtion for Text \u4E2D\u624B\u52A8\u8FDB\u884C\u516C\u5F0F\u8BC6\u522B\u3002"},markdown:{label:"\u4F7F\u7528\u7684 Markdown \u63D2\u4EF6",help:"\u7528\u4E8E\u663E\u793A\u516C\u5F0F\uFF0C\u63A8\u8350\u4F7F\u7528 Milkdown \u3002",$option3:["Markdown","myMarkDown","Milkdown"]},baidu_api_key:{help:"\u767E\u5EA6 Api Key\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:S("autoocr","\u767E\u5EA6-ocr")},baidu_secret_key:"\u767E\u5EA6 Secret Key",mathpix_app_key:{help:"Mathpix App Key\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:S("autoocr","mathpix")},$show_key2:["\u70B9\u51FB\u67E5\u770B\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230","\u70B9\u51FB\u9690\u85CF\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230"],text_ocr:"\u6587\u5B57\u8BC6\u522B",hand_writting_ocr:"\u624B\u5199\u8BC6\u522B",qr_code_ocr:"\u4E8C\u7EF4\u7801\u8BC6\u522B",sure:"\u786E\u5B9A",detect_link:"\u7ED3\u679C\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\u4E0A\uFF0C\u4F46\u68C0\u6D4B\u5230\u8BC6\u522B\u7ED3\u679C\u4E2D\u542B\u6709\u94FE\u63A5\uFF0C\u662F\u5426\u76F4\u63A5\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00\uFF1F",baidu_token_error:"\u767E\u5EA6 OCR Api Key \u6216 Secret Key \u8F93\u5165\u9519\u8BEF\uFF01",no_mathpix_key:"\u6CA1\u6709\u8F93\u5165 Mathpix key\uFF01",mathpix_key_error:"Mathpix key \u8F93\u5165\u9519\u8BEF\uFF01",success_clipboard:"\u7ED3\u679C\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\u4E0A\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01",no_baidu_api_key:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6 OCR Api Key",no_baidu_secret_key:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6 OCR Secret Key"},en:{intro:"Use the Baidu OCR service to correct the online small language when excerpting.      ",on:{label:"Auto Run When Excerpting",help:"[Only Current Document]"},lang:{help:"[Only Current Document]",label:"Language",$option21:["Auto","Chinese+English","English","Japanese","Korean","French","Spanish","Portuguese","German","Italian","Russian","Danish","Dutch","Malay","Swedish","Indonesian","Polish","Romanian","Turkish","Greek","Hungarian"]},formula_ocr_providers:{label:"Formula OCR Providers",$option2:["Baidu","Mathpix"],help:"Formula OCR is not supported in auto mode, only in MagicAtion for Text."},markdown:{label:"Markdown Addon Used",help:"For displaying formulas, Milkdown is recommended",$option3:["Markdown","myMarkDown","Milkdown"]},formula_ocr:{label:"Formula OCR",help:'For "Markdown" Addon, please choose Pure Latex',$option3:["Pure Latex","$ Latex $","$$ Latex $$"]},baidu_api_key:{link:S("autoocr","baidu-ocr"),help:"Baidu Api Key, click to see how to get it."},baidu_secret_key:"Baidu Secret Key",mathpix_app_key:{link:S("autoocr","mathpix"),help:"Mathpix App Key, click to see how to get it."},$show_key2:["Click to show secret key","Click to hide secret key"],text_ocr:"Text OCR",hand_writting_ocr:"Handwritting OCR",qr_code_ocr:"QRCode OCR",sure:"Confirm",detect_link:"The result has been copied to the clipboard, but a link is detected in the recognition result, is it opened directly?",baidu_token_error:"Api Key or Secret Key is wrong!",no_mathpix_key:"No Mathpix key\uFF01",mathpix_key_error:"Mathpix key is wrong!",success_clipboard:"The results have been copied to the clipboard, go ahead and paste them!",no_baidu_api_key:"No Baidu OCR Api Key",no_baidu_secret_key:"No Baidu OCR Secret Key"}});var Bt=C(T());async function Cn(){let{lastGetToken:e,baiduToken:t}=self.globalProfile.additional.autoocr,{baiduApiKey:r,baiduSecretKey:o}=self.globalProfile.autoocr;if(t&&Date.now()-e<2592e6)return t;if(!r)throw z.no_baidu_api_key;if(!o)throw z.no_baidu_secret_key;let n=await(0,Bt.fetch)(`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${r}&client_secret=${o}`).then(i=>i.json());if(!n.access_token)throw z.baidu_token_error;return self.globalProfile.additional.autoocr={lastGetToken:Date.now(),baiduToken:n.access_token},n.access_token}async function Jp(e){let{mathpixAppKey:t}=self.globalProfile.autoocr;if(!t)throw z.no_mathpix_key;let r=await(0,Bt.fetch)("https://api.mathpix.com/v3/latex",{method:"POST",headers:{app_key:t},json:{src:"data:image/jpg;base64,"+e,formats:["latex_styled"],ocr:["math","text"]}}).then(o=>o.json());if(r.error)throw`Mathpix: ${r.error}`;return r.latex_styled}async function Yp(e){let t=await Cn(),r=await(0,Bt.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/qrcode?access_token=${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e}}).then(o=>o.json());if(r.error_code&&r.error_msg)throw`${r.error_code}: ${r.error_msg}`;return r.codes_result.map(o=>o.text).join("")}async function Zp(e){let t=await Cn(),r=await(0,Bt.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/formula?access_token=${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e}}).then(o=>o.json());if(r.error_code&&r.error_msg)throw`Baidu OCR\uFF1A${r.error_code} ${r.error_msg}`;return r.words_result.map(o=>o.words).join("")}async function Qp(e){let t=await Cn(),r=await(0,Bt.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/handwriting?access_token=${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e}}).then(o=>o.json());if(r.error_code&&r.error_msg)throw`${r.error_code}: ${r.error_msg}`;return r.words_result.map(o=>o.words).join("")}async function mo(e){try{let t=["auto_detect","CHN_ENG","ENG","JAP","KOR","FRE","SPA","POR","GER","ITA","RUS","DAN","DUT","MAL","SWE","IND","POL","ROM","TUR","GRE","HUN"],r=await Cn(),o=await(0,Bt.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/accurate_basic?access_token=${r}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e,language_type:t[self.globalProfile.autoocr.lang[0]]}}).then(n=>n.json());if(o.error_code&&o.error_msg)throw`${o.error_code}: ${o.error_msg}`;return o.words_result.map(n=>/[.。;；·?？！!]$/.test(n.words)?n.words+`
`:n.words).join("")}catch(t){(0,Bt.showHUD)(String(t))}}var ef={name:"AutoOCR",key:"autoocr",intro:z.intro,link:S("autoocr"),settings:[{key:"on",type:1,label:z.on.label,help:z.on.help,auto:{customOCR:{index:1,method({imgBase64:e}){return mo(e)}}}},{key:"lang",label:z.lang.label,type:6,option:z.lang.$option21,help:z.lang.help},{key:"formulaOCRProviders",type:6,option:z.formula_ocr_providers.$option2,label:z.formula_ocr_providers.label,help:z.formula_ocr_providers.help},{key:"markdown",type:6,option:z.markdown.$option3,label:z.markdown.label,help:z.markdown.help},{key:"showKey",type:8,label:z.$show_key2},{key:"baiduApiKey",type:4,help:z.baidu_api_key.help,link:z.baidu_api_key.link,bind:["showKey",!0]},{key:"baiduSecretKey",type:4,help:z.baidu_secret_key,bind:["showKey",!0]},{key:"mathpixAppKey",type:4,help:z.mathpix_app_key.help,link:z.mathpix_app_key.link,bind:[["showKey",!0],["formulaOCRProviders",1]]}],actions4text:[{type:2,key:"formulaOCR",label:z.formula_ocr.label,option:z.formula_ocr.$option3,help:z.formula_ocr.help,method:async({imgBase64:e,option:t})=>{try{let r=(self.globalProfile.autoocr.formulaOCRProviders[0]===0?await Zp(e):await Jp(e)).trim();return[r,`$${r}$`,`$$
${r}
$$`][t]}catch(r){(0,Tn.showHUD)(String(r),2)}}},{type:2,key:"textOCR",label:z.text_ocr,method:async({imgBase64:e})=>await mo(e)},{type:2,key:"handWrittingOCR",label:z.hand_writting_ocr,method:async({imgBase64:e})=>{try{return await Qp(e)}catch(t){(0,Tn.showHUD)(String(t),2)}}},{type:2,key:"QRCodeOCR",label:z.qr_code_ocr,method:async({imgBase64:e})=>{try{return await Yp(e)}catch(t){(0,Tn.showHUD)(String(t),2)}}}]};var tf=C(T());var Ut=(0,tf.i18n)({zh:{intro:"\u81EA\u52A8\u66FF\u6362\u6458\u5F55\u4E2D\u7684\u6587\u5B57\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option1:["\u81EA\u5B9A\u4E49"]},replace_selected:{label:"\u66FF\u6362\u6458\u5F55\u5185\u5BB9",$option2:["\u4F7F\u7528 AutoReplace \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_replace:{link:S("autoreplace","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"}},en:{intro:"Automatically replace errors in excerpts. ",on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option1:["Custom"]},replace_selected:{$option2:["Use AutoReplace Settings","Confirm"],label:"Replace Excerpt Text"},custom_replace:{link:S("autoreplace","custom"),help:"Customize. Click for specific formats"}}});function rf(e,t){let{preset:r}=self.globalProfile.autoreplace;for(let o of r)switch(o){case 0:let{customReplace:n}=self.tempProfile.replaceParam;if(!(n!=null&&n.length))continue;t=n.reduce((i,s)=>i.replace(s.regexp,me(e,s.newSubStr)),t)}return t}var of={name:"AutoReplace",key:"autoreplace",intro:Ut.intro,link:S("autoreplace"),settings:[{key:"on",type:1,label:Ut.on,auto:{modifyExcerptText:{index:999,method({node:e,text:t}){return rf(e,t)}}}},{key:"preset",type:7,option:Ut.preset.$option1,label:Ut.preset.label},{key:"customReplace",type:4,help:Ut.custom_replace.help,bind:["preset",0],link:Ut.custom_replace.link}],actions4card:[{type:3,label:Ut.replace_selected.label,key:"replaceCard",option:Ut.replace_selected.$option2,method:({content:e,nodes:t,option:r})=>{if(r==0)t.forEach(o=>{o.notes.forEach(n=>{let i=n.excerptText;i&&(n.excerptText=rf(o,i))})});else if(e){e=/^\(.*\)$/.test(e)?e:`(/^.*$/gs, "${ce(e)}")`;let o=xe(e);t.forEach(n=>{n.notes.forEach(i=>{let s=i.excerptText;s&&(i.excerptText=o.reduce((l,a)=>l.replace(a.regexp,me(n,a.newSubStr)),s))})})}}}]};var nf=C(T());var We=(0,nf.i18n)({zh:{intro:"\u4F18\u5316\u6458\u5F55\u548C\u6807\u9898\u7684\u6392\u7248\u4E0E\u683C\u5F0F\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",custom_format:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:S("autoformat")},preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option5:["\u81EA\u5B9A\u4E49","\u534A\u89D2\u8F6C\u5168\u89D2","\u4E2D\u82F1\u6587\u52A0\u7A7A\u683C","\u53BB\u9664\u4E2D\u6587\u95F4\u7A7A\u683C","\u53BB\u9664\u91CD\u590D\u7A7A\u683C"]},format_selected:{label:"\u4F18\u5316\u6392\u7248\u683C\u5F0F",$option3:["\u6807\u9898\u548C\u6458\u5F55","\u4EC5\u6807\u9898","\u4EC5\u6458\u5F55"]},remove_space:{label:"\u5220\u9664\u6240\u6709\u7A7A\u683C",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u5982\u679C\u6587\u6863\u4E2D\u6709\u5927\u91CF\u5355\u8BCD\uFF0C\u8BF7\u8C28\u614E\u4F7F\u7528\u3002"},format_title:{help:"\u6D89\u53CA\u5230\u9996\u5B57\u6BCD\u5927\u5199\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u89C4\u8303\u3002",label:"\u82F1\u6587\u6807\u9898\u89C4\u8303\u5316",link:S("autoformat")}},en:{intro:"Optimize the layout and format of excerpts and titles.",on:"Auto Run When Excerpting",remove_space:{label:"Remove All Spaces",help:"[Only Current Document] If there are a lot of words in the document, please use it with caution."},custom_format:{help:"Customize. Click for specific formats.",link:S("autoformat")},preset:{label:"Select Presets",$option5:["Custom","Half Width To Full Width","Add Space Between Chinese & English","Remove Spaces Between Chinese","Remove Repeated Spaces"]},format_selected:{label:"Format Excerpt Text",$option3:["All","Only Title","Only Excerpt Text"]},format_title:{label:"Normalize English Title",link:S("autoformat"),help:"Click for  specific specifications"}}});var sf=e=>{let t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|v.?|vs.?|via)$/i,r=/([A-Za-z0-9\u00C0-\u00FF])/,o=/([ :–—-])/;return e.split(o).map(function(n,i,s){return n.search(t)>-1&&i!==0&&i!==s.length-1&&s[i-3]!==":"&&s[i+1]!==":"&&(s[i+1]!=="-"||s[i-1]==="-"&&s[i+1]==="-")?n.toLowerCase():n.substr(1).search(/[A-Z]|\../)>-1||s[i+1]===":"&&s[i+2]!==""?n:n.replace(r,function(l){return l.toUpperCase()})}).join("")};function Vi(e){return e.map(t=>bn(t)?sf(t):t)}function Or(e){let{preset:t}=self.globalProfile.autoformat,{removeSpace:r}=self.docProfile.autoformat;e=e.replace(/\*\*(.+?)\*\*/g,(o,n)=>gt(n)?`placehder${n}placehder`:`\u5360\u554A\u4F4D\u7B26${n}\u5360\u554A\u4F4D\u7B26`),r&&(e=e.replace(/\x20/g,""));for(let o of t)if(!(o!==0&&gt(e)))switch(o){case 0:let{customFormat:n}=self.tempProfile.replaceParam;if(!n)continue;n.forEach(i=>{let{regexp:s,newSubStr:l,fnKey:a}=i;(a===0&&$i(e)||a===1&&gt(e)||a>=2)&&(e=e.replace(s,l))});break;case 1:e=Ar.toFullwidth(e);break;case 2:e=Ar.spacing(e);break;case 3:e=e.replace(new RegExp(`([${It}]) +([${It}])`,"g"),"$1$2");break;case 4:e=e.replace(/\x20{2,}/g," ");break}return e.replace(/占啊位符/g,"**").replace(/placehder/g,"**")}var lf={name:"AutoFormat",key:"autoformat",intro:We.intro,link:S("autoformat"),settings:[{key:"on",type:1,label:We.on,auto:{modifyExcerptText:{index:1,method({text:e}){return Or(e)}},modifyTitles({titles:e}){let{formatTitle:t}=self.globalProfile.autoformat;return t?Vi(e):e}}},{key:"preset",type:7,option:We.preset.$option5,label:We.preset.label},{key:"customFormat",type:4,help:We.custom_format.help,bind:["preset",0],link:We.custom_format.link,check({input:e}){bt(e)}},{key:"removeSpace",type:1,label:We.remove_space.label,help:We.remove_space.help},{key:"formatTitle",type:1,label:We.format_title.label,help:We.format_title.help,link:We.format_title.link}],actions4card:[{key:"formatCard",type:2,label:We.format_selected.label,option:We.format_selected.$option3,method:({nodes:e,option:t})=>{e.forEach(r=>{let o=r.title;if(o&&(t===1||t===0)){let n=Or(o);self.globalProfile.autoformat.formatTitle&&(n=Vi(n.split(/\s*[;；]\s*/)).join("; ")),r.title=n}(t===2||t===0)&&r.notes.forEach(n=>{let i=n.excerptText;i&&(n.excerptText=Or(i))})})}}]};var af=C(T()),Z=(0,af.i18n)({zh:{intro:"\u81EA\u52A8\u4FEE\u6539\u6458\u5F55\u989C\u8272\u548C\u6837\u5F0F\u3002",area:"\u9762\u79EF",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",change_style:{lable:"\u4FEE\u6539\u6458\u5F55\u6837\u5F0F",$option4:["\u4F7F\u7528 AutoStyle \u7684\u8BBE\u7F6E","\u7EBF\u6846+\u586B\u5145","\u586B\u5145","\u7EBF\u6846"]},change_color:{label:"\u4FEE\u6539\u6458\u5F55\u989C\u8272",help:"\u8F93\u5165\u989C\u8272\u7D22\u5F15\uFF0C\u4E5F\u5C31\u662F\u987A\u5E8F\uFF0C1 \u5230 16\u3002",out_of_range:"\u4E0D\u518D\u8303\u56F4\u5185\uFF081,16\uFF09",$option2:["\u4F7F\u7528 AutoStyle \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option4:["\u6837\u5F0F\u7531\u5B57\u6570\u6216\u9762\u79EF\u51B3\u5B9A","\u989C\u8272\u8DDF\u968F\u5361\u7247","\u989C\u8272\u8DDF\u968F\u7B2C\u4E00\u4E2A\u5144\u5F1F\u5361\u7247","\u989C\u8272\u8DDF\u968F\u7236\u5361\u7247"]},$style4:["\u65E0","\u7EBF\u6846+\u586B\u5145","\u586B\u5145","\u7EBF\u6846"],$color17:["\u65E0","\u6D45\u9EC4","\u6D45\u7EFF","\u6D45\u84DD","\u6D45\u7EA2","\u9EC4","\u7EFF","\u84DD","\u7EA2","\u6A58","\u6DF1\u7EFF","\u6DF1\u84DD","\u6DF1\u7EA2","\u767D","\u6D45\u7070","\u6DF1\u7070","\u7D2B"],word_count_area:{help:"[\u7C7B\u4E2D\u6587\u5B57\u6570, \u7C7B\u82F1\u6587\u5355\u8BCD\u6570, \u9009\u533A\u9762\u79EF]\uFF0C\u8D85\u8FC7\u5219\u5C06\u6458\u5F55\u6837\u5F0F\u8BBE\u7F6E\u4E3A\u7EBF\u6846\uFF0C\u5426\u5219\u9ED8\u8BA4\u3002",input_array:"\u8BF7\u8F93\u5165\u6570\u7EC4\uFF0C\u6BD4\u5982 [10,5,100]",input_three_number:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u4E09\u4E2A\u6570\u5B57\uFF0C\u6BD4\u5982 [10,5,100]"},show_area:"\u663E\u793A\u6458\u5F55\u9762\u79EF",default_text_excerpt_color:"\u6587\u672C\u6458\u5F55\u9ED8\u8BA4\u989C\u8272",default_pic_excerpt_color:"\u9009\u533A\u6458\u5F55\u9ED8\u8BA4\u989C\u8272",default_text_excerpt_style:"\u6587\u672C\u6458\u5F55\u9ED8\u8BA4\u6837\u5F0F",default_pic_excerpt_style:"\u9009\u533A\u6458\u5F55\u9ED8\u8BA4\u6837\u5F0F",enter_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570"},en:{intro:"Auto modify excerpt colors and styles.",on:"Auto Run When Excerpting",area:"Aera",change_style:{lable:"Modify Excerpt Style",$option4:["Use AutoStyle Settings","Outline+Fill","Fill","Outline"]},change_color:{label:"Modify Excerpt Color",help:"Enter the color index, 1 to 16",$option2:["Use AutoStyle Settings","Confirm"],out_of_range:"Out of range\uFF081,16\uFF09"},preset:{label:"Select Presets",$option4:["Style is determined by word count or area","Color follow card","Color follows frist child node","Color follows parent node"]},$style4:["None","Wireframe+Fill","Fill","Wireframe"],$color17:["None","Light Yellow","Light Green","Light Blue","light red","Yellow","Green","Blue","Red","Orange","Dark Green","Dark Blue","Dark Red","White","Light Grey","Dark Grey","Purple"],word_count_area:{help:`[Chinese words, English words, Selected area size], if it exceeds, set the excerpt style to wireframe, otherwise the default.
`,input_array:"Please enter an array, for example [10,5,100]",input_three_number:"There must be three numbers in the array\uFF0Cfor example [10,5,100]"},enter_positive:"Please enter a positive integer",show_area:"Show Excerpt Area",default_text_excerpt_color:"Default Text Excerpt Color",default_pic_excerpt_color:"Default Pic Excerpt Color",default_text_excerpt_style:"Default Text Excerpt Style",default_pic_excerpt_style:"Default Pic Excerpt Style"}});var Jt=C(T());function gw(e){let{width:t,height:r}=(0,Jt.CGSizeValue2CGSize)(e.excerptPic.size);return Math.floor(t*r/1e3)}function En(e){var f,h,d;let{preset:t,showArea:r,wordCountArea:o,defaultPicExcerptColor:n,defaultPicExcerptStyle:i,defaultTextExcerptColor:s,defaultTextExcerptStyle:l}=self.globalProfile.autostyle,a=e.excerptPic?n[0]!==0?n[0]-1:void 0:s[0]!==0?s[0]-1:void 0,c=e.excerptPic?i[0]!==0?i[0]-1:void 0:l[0]!==0?l[0]-1:void 0,u={color:a,style:c},p=e.groupNoteId?Jt.MN.db.getNoteById(e.groupNoteId):e;if(t.includes(0)&&o){let[y,E,R]=M(o);if((f=e.excerptPic)!=null&&f.size){let F=gw(e);F>R&&(u.style=2),r&&(0,Jt.showHUD)(Z.area+": "+F)}else if(e.excerptText){let F=(0,Jt.removeHighlight)(e.excerptText);kr(F)>(gt(F)?E:y)&&(u.style=2)}}for(let y of t)switch(y){case 1:if(e.groupNoteId)return u.color=p.colorIndex,u;break;case 2:let E=(d=(h=p.parentNote)==null?void 0:h.childNotes)==null?void 0:d.length;if(E&&E>1)return u.color=p.parentNote.childNotes[0].colorIndex,u;break;case 3:if(p.parentNote)return u.color=p.parentNote.colorIndex,u}return u}var cf=Z.$color17.map((e,t)=>t?Be.hollow_circle_number[t-1]+" "+e:e),uf={name:"AutoStyle",key:"autostyle",intro:Z.intro,link:S("autostyle"),settings:[{key:"on",type:1,label:Z.on,auto:{modifyStyle({note:e}){return En(e)}}},{key:"preset",type:7,option:Z.preset.$option4,label:Z.preset.label},{key:"showArea",type:1,bind:["preset",0],label:Z.show_area},{key:"wordCountArea",type:4,bind:["preset",0],help:Z.word_count_area.help,check({input:e}){if(e=M(e),!Array.isArray(e))throw Z.word_count_area.input_array;if(e.length!==3)throw Z.word_count_area.input_three_number;if(e.some(t=>!Number.isInteger(t)))throw Z.enter_positive}},{key:"defaultTextExcerptColor",type:6,label:Z.default_text_excerpt_color,option:cf},{key:"defaultTextExcerptStyle",type:6,label:Z.default_text_excerpt_style,option:Z.$style4},{key:"defaultPicExcerptColor",type:6,label:Z.default_pic_excerpt_color,option:cf},{key:"defaultPicExcerptStyle",type:6,label:Z.default_pic_excerpt_style,option:Z.$style4}],actions4card:[{type:3,label:Z.change_color.label,key:"changeColor",option:Z.change_color.$option2,help:Z.change_color.help,method({content:e,nodes:t,option:r}){if(r===0)for(let o of t)o.notes.forEach(n=>{let{color:i}=En(n);i!==void 0&&(n.colorIndex=i!==-1?i:12)});else if(e){let o=Number(e)-1;for(let n of t)n.notes.forEach(i=>{i.colorIndex=o})}},check({input:e}){let t=Number(e);if(!Number.isInteger(t))throw Z.enter_positive;if(t>16||t<1)throw Z.change_color.out_of_range}},{type:2,label:Z.change_style.lable,key:"changeStyle",option:Z.change_style.$option4,method({option:e,nodes:t}){if(e===0)for(let r of t)r.notes.forEach(o=>{let{style:n}=En(o);n!==void 0&&(o.fillIndex=n)});else{let r=e-1;for(let o of t)o.notes.forEach(n=>{n.fillIndex=r})}}}]};var pf=C(T());var wt=(0,pf.i18n)({zh:{intro:"\u81EA\u52A8\u4ECE\u6458\u5F55\u4E2D\u63D0\u53D6\u6807\u7B7E\u6216\u8005\u5728\u7279\u5B9A\u65F6\u5019\u81EA\u52A8\u6DFB\u52A0\u6807\u7B7E\u3002",link:S("autotag"),on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option1:["\u81EA\u5B9A\u4E49"]},add_tag:{label:"\u6DFB\u52A0\u6807\u7B7E",$option2:["\u4F7F\u7528 AutoTag \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_tag:{link:S("autotag","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"}},en:{intro:"Extract tags from excerpts or add tags at specific times Automatically.",link:S("autotag"),on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option1:["Custom"]},add_tag:{label:"Add Tags",$option2:["Use AutoTag Settings","Confirm"]},custom_tag:{link:S("autotag","custom"),help:"Customize. Click for specific formats"}}});function Hi(...e){return e.map(t=>t.replace(/#/g," ").replace(/\p{P}+/gu,"_").split(/\s+/)).flat().filter(t=>t)}function ff(e,t){if(!t)return;let{customTag:r}=self.tempProfile.replaceParam,{preset:o}=self.globalProfile.autotag;if(o.includes(0)&&r)return Hi(...ao(t,r.map(n=>({...n,newSubStr:me(e,n.newSubStr)}))))}var hf={name:"AutoTag",key:"autotag",intro:wt.intro,link:wt.link,settings:[{key:"on",type:1,label:wt.on,auto:{generateTags({node:e,text:t}){return ff(e,t)}}},{key:"preset",type:7,option:wt.preset.$option1,label:wt.preset.label},{key:"customTag",type:4,help:wt.custom_tag.help,bind:["preset",0],link:wt.custom_tag.link,check({input:e}){bt(e)}}],actions4card:[{type:3,label:wt.add_tag.label,key:"addTag",option:wt.add_tag.$option2,method({nodes:e,option:t,content:r}){if(t==0)e.forEach(o=>{var s;let n=o.excerptsText.join(`
`);((s=o.note.excerptPic)==null?void 0:s.paint)&&o.isOCR===!1&&(n="@picture");let i=ff(o,n);i!=null&&i.length&&o.appendTags(...i)});else if(r)if(/^\(.+\)$/.test(r)){let o=xe(r);e.forEach(n=>{var l;let i=n.excerptsText.join(`
`);((l=n.note.excerptPic)==null?void 0:l.paint)&&n.isOCR===!1&&(i="@picture");let s=ao(i,o.map(a=>({...a,newSubStr:me(n,a.newSubStr)})));n.appendTags(...Hi(...s))})}else e.forEach(o=>{o.appendTags(...Hi(me(o,M(`${ce(r)}`,!0))))})},check({input:e}){/^\(.+\)$/.test(e)?At(e):Xe(e)}}]};var df=C(T());var W=(0,df.i18n)({zh:{intro:"\u6458\u5F55\u65F6\u81EA\u52A8\u7FFB\u8BD1\uFF0C\u4F5C\u4E3A\u8BC4\u8BBA\u6DFB\u52A0\u8FDB\u53BB\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option1:["\u81EA\u5B9A\u4E49"]},word_count:"[\u7C7B\u4E2D\u6587\u5B57\u6570\uFF0C\u7C7B\u82F1\u6587\u5355\u8BCD\u6570]\uFF0C\u8D85\u8FC7\u624D\u4F1A\u7FFB\u8BD1\u3002      ",translate_providers:{$option2:["\u767E\u5EA6\u7FFB\u8BD1","\u5F69\u4E91\u5C0F\u8BD1"],label:"\u7FFB\u8BD1\u63D0\u4F9B\u5546"},caiyun_from_lang:{label:"\u8F93\u5165\u8BED\u8A00",$option4:["\u81EA\u52A8\u68C0\u6D4B","\u4E2D\u6587","\u82F1\u6587","\u65E5\u6587"]},caiyun_to_lang:{label:"\u8F93\u51FA\u8BED\u8A00",$option3:["\u4E2D\u6587","\u82F1\u6587","\u65E5\u6587"]},no_result:"\u6CA1\u6709\u83B7\u53D6\u5230\u7ED3\u679C",baidu_from_lang:{label:"\u8F93\u5165\u8BED\u8A00",$option29:["\u81EA\u52A8\u68C0\u6D4B","\u4E2D\u6587","\u82F1\u8BED","\u7CA4\u8BED","\u6587\u8A00\u6587","\u65E5\u8BED","\u97E9\u8BED","\u6CD5\u8BED","\u897F\u73ED\u7259\u8BED","\u6CF0\u8BED","\u963F\u62C9\u4F2F\u8BED","\u4FC4\u8BED","\u8461\u8404\u7259\u8BED","\u5FB7\u8BED","\u610F\u5927\u5229\u8BED","\u5E0C\u814A\u8BED","\u8377\u5170\u8BED","\u6CE2\u5170\u8BED","\u4FDD\u52A0\u5229\u4E9A\u8BED","\u7231\u6C99\u5C3C\u4E9A\u8BED","\u4E39\u9EA6\u8BED","\u82AC\u5170\u8BED","\u6377\u514B\u8BED","\u7F57\u9A6C\u5C3C\u4E9A\u8BED","\u65AF\u6D1B\u6587\u5C3C\u4E9A\u8BED","\u745E\u5178\u8BED","\u5308\u7259\u5229\u8BED","\u7E41\u4F53\u4E2D\u6587","\u8D8A\u5357\u8BED"]},baidu_to_lang:{label:"\u8F93\u51FA\u8BED\u8A00",$option28:["\u4E2D\u6587","\u82F1\u8BED","\u7CA4\u8BED","\u6587\u8A00\u6587","\u65E5\u8BED","\u97E9\u8BED","\u6CD5\u8BED","\u897F\u73ED\u7259\u8BED","\u6CF0\u8BED","\u963F\u62C9\u4F2F\u8BED","\u4FC4\u8BED","\u8461\u8404\u7259\u8BED","\u5FB7\u8BED","\u610F\u5927\u5229\u8BED","\u5E0C\u814A\u8BED","\u8377\u5170\u8BED","\u6CE2\u5170\u8BED","\u4FDD\u52A0\u5229\u4E9A\u8BED","\u7231\u6C99\u5C3C\u4E9A\u8BED","\u4E39\u9EA6\u8BED","\u82AC\u5170\u8BED","\u6377\u514B\u8BED","\u7F57\u9A6C\u5C3C\u4E9A\u8BED","\u65AF\u6D1B\u6587\u5C3C\u4E9A\u8BED","\u745E\u5178\u8BED","\u5308\u7259\u5229\u8BED","\u7E41\u4F53\u4E2D\u6587","\u8D8A\u5357\u8BED"]},baidu_thesaurus:{label:"\u81EA\u5B9A\u4E49\u672F\u8BED\u5E93",help:"\u767E\u5EA6\u7FFB\u8BD1\u9AD8\u7EA7\u7248\u53EF\u7528\uFF0C\u4EC5\u652F\u6301\u4E2D\u82F1\u4E92\u8BD1\uFF0C\u70B9\u51FB\u65B0\u5EFA\u81EA\u5B9A\u4E49\u672F\u8BED\u3002",link:"https://fanyi-api.baidu.com/manage/term"},$show_key2:["\u70B9\u51FB\u67E5\u770B\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230","\u70B9\u51FB\u9690\u85CF\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230"],baidu_app_id:{help:"\u767E\u5EA6 App ID\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:S("autotranslate","\u767E\u5EA6\u7FFB\u8BD1")},baidu_secret_key:"\u767E\u5EA6\u5BC6\u94A5",caiyun_token:{help:"\u5F69\u4E91\u5C0F\u8BD1 Token\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:S("autotranslate","\u5F69\u4E91\u5C0F\u8BD1")},translate_card:{label:"\u7FFB\u8BD1\u6458\u5F55\u5185\u5BB9",help:"\u4F1A\u7FFB\u8BD1\u5361\u7247\u4E2D\u6240\u6709\u7684\u6458\u5F55\uFF0C\u6CE8\u610F\u4E0D\u8981\u540C\u65F6\u7FFB\u8BD1\u592A\u591A\u5185\u5BB9\u3002"},loading:"\u6B63\u5728\u7FFB\u8BD1...",translate_text:"\u7FFB\u8BD1\u9009\u4E2D\u6587\u5B57",no_baidu_app_id:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6\u7FFB\u8BD1\u7684 App ID",no_baidu_secret_key:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6\u7FFB\u8BD1\u7684\u5BC6\u94A5",no_caiyun_token:"\u6CA1\u6709\u8BBE\u7F6E\u5F69\u4E91\u5C0F\u8BD1\u7684 Token"},en:{intro:"Translate selected text or card content.",on:"Auto Run When Excerpting",preset:{label:"Select Preset",$option1:["Custom"]},word_count:"[Chinese words, English words], if exceeded, then translate.",translate_providers:{$option2:["Baidu Translate","LingoCloud Translate"],label:"Translate Providers"},caiyun_from_lang:{label:"Input Language",$option4:["Auto Detect","Chinese","English","Japanese"]},caiyun_to_lang:{label:"Output Language",$option3:["Chinese","English","Japanese"]},no_result:"No Result",baidu_from_lang:{label:"Input Language",$option29:["Auto Detect","Chinese","English","Cantonese","Classical Chinese","Japanese","Korean","French","Spanish","Thai","Arabic","Russian","Portuguese","German","Italian","Greek","Dutch","Polish","Bulgarian","Estonian","Danish","Finnish","Czech","Romanian","Slovenian","Swedish","Hungarian","Traditional Chinese","Vietnamese"]},translate_card:{label:"Translate Excerpt Text",help:"Translate all excerpts in the card, note that too many translations at the same time may cause the translation to fail."},baidu_to_lang:{label:"Output Language",$option28:["Chinese","English","Cantonese","Classical Chinese","Japanese","Korean","French","Spanish","Thai","Arabic","Russian","Portuguese","German","Italian","Greek","Dutch","Polish","Bulgarian","Estonian","Danish","Finnish","Czech","Romanian","Slovenian","Swedish","Hungarian","Traditional Chinese","Vietnamese"]},baidu_thesaurus:{label:"Custom Thesaurus",help:"Only available in Baidu Translate Pro, only supports Chinese-English translation, click to create a custom thesaurus.",link:"https://fanyi-api.baidu.com/manage/term"},$show_key2:["Click to show secret key","Click to hide secret key"],baidu_app_id:{help:"Baidu Translate App ID, click to view how to get it.",link:S("autotranslate","baidu-translate")},baidu_secret_key:"Baidu Fanyi Secret Key",caiyun_token:{help:"LingoCloud Translate Token, click to view how to get it.",link:S("autotranslate","lingocloud-translate")},translate_text:"Translate Selected Text",loading:"Translating...",no_baidu_app_id:"No Baidu Fanyi App ID",no_baidu_secret_key:"No Baidu Fanyi Secret Key",no_caiyun_token:"No Caiyun Translate Token"}});var go=C(T());var yw=function(e){function t(A,P){return A<<P|A>>>32-P}function r(A,P){var G,J,fe,_e,le;return fe=A&2147483648,_e=P&2147483648,G=A&1073741824,J=P&1073741824,le=(A&1073741823)+(P&1073741823),G&J?le^2147483648^fe^_e:G|J?le&1073741824?le^3221225472^fe^_e:le^1073741824^fe^_e:le^fe^_e}function o(A,P,G){return A&P|~A&G}function n(A,P,G){return A&G|P&~G}function i(A,P,G){return A^P^G}function s(A,P,G){return P^(A|~G)}function l(A,P,G,J,fe,_e,le){return A=r(A,r(r(o(P,G,J),fe),le)),r(t(A,_e),P)}function a(A,P,G,J,fe,_e,le){return A=r(A,r(r(n(P,G,J),fe),le)),r(t(A,_e),P)}function c(A,P,G,J,fe,_e,le){return A=r(A,r(r(i(P,G,J),fe),le)),r(t(A,_e),P)}function u(A,P,G,J,fe,_e,le){return A=r(A,r(r(s(P,G,J),fe),le)),r(t(A,_e),P)}function p(A){for(var P,G=A.length,J=G+8,fe=(J-J%64)/64,_e=(fe+1)*16,le=Array(_e-1),Bo=0,Et=0;Et<G;)P=(Et-Et%4)/4,Bo=Et%4*8,le[P]=le[P]|A.charCodeAt(Et)<<Bo,Et++;return P=(Et-Et%4)/4,Bo=Et%4*8,le[P]=le[P]|128<<Bo,le[_e-2]=G<<3,le[_e-1]=G>>>29,le}function f(A){var P="",G="",J,fe;for(fe=0;fe<=3;fe++)J=A>>>fe*8&255,G="0"+J.toString(16),P=P+G.substr(G.length-2,2);return P}function h(A){A=A.replace(/\r\n/g,`
`);for(var P="",G=0;G<A.length;G++){var J=A.charCodeAt(G);J<128?P+=String.fromCharCode(J):J>127&&J<2048?(P+=String.fromCharCode(J>>6|192),P+=String.fromCharCode(J&63|128)):(P+=String.fromCharCode(J>>12|224),P+=String.fromCharCode(J>>6&63|128),P+=String.fromCharCode(J&63|128))}return P}var d=[],y,E,R,F,ie,m,b,w,x,se=7,Qt=12,To=17,Eo=22,vo=5,$o=9,ko=14,No=20,Io=4,Po=11,Ro=16,Ao=23,Oo=6,Do=10,Lo=15,Mo=21;for(e=h(e),d=p(e),m=1732584193,b=4023233417,w=2562383102,x=271733878,y=0;y<d.length;y+=16)E=m,R=b,F=w,ie=x,m=l(m,b,w,x,d[y+0],se,3614090360),x=l(x,m,b,w,d[y+1],Qt,3905402710),w=l(w,x,m,b,d[y+2],To,606105819),b=l(b,w,x,m,d[y+3],Eo,3250441966),m=l(m,b,w,x,d[y+4],se,4118548399),x=l(x,m,b,w,d[y+5],Qt,1200080426),w=l(w,x,m,b,d[y+6],To,2821735955),b=l(b,w,x,m,d[y+7],Eo,4249261313),m=l(m,b,w,x,d[y+8],se,1770035416),x=l(x,m,b,w,d[y+9],Qt,2336552879),w=l(w,x,m,b,d[y+10],To,4294925233),b=l(b,w,x,m,d[y+11],Eo,2304563134),m=l(m,b,w,x,d[y+12],se,1804603682),x=l(x,m,b,w,d[y+13],Qt,4254626195),w=l(w,x,m,b,d[y+14],To,2792965006),b=l(b,w,x,m,d[y+15],Eo,1236535329),m=a(m,b,w,x,d[y+1],vo,4129170786),x=a(x,m,b,w,d[y+6],$o,3225465664),w=a(w,x,m,b,d[y+11],ko,643717713),b=a(b,w,x,m,d[y+0],No,3921069994),m=a(m,b,w,x,d[y+5],vo,3593408605),x=a(x,m,b,w,d[y+10],$o,38016083),w=a(w,x,m,b,d[y+15],ko,3634488961),b=a(b,w,x,m,d[y+4],No,3889429448),m=a(m,b,w,x,d[y+9],vo,568446438),x=a(x,m,b,w,d[y+14],$o,3275163606),w=a(w,x,m,b,d[y+3],ko,4107603335),b=a(b,w,x,m,d[y+8],No,1163531501),m=a(m,b,w,x,d[y+13],vo,2850285829),x=a(x,m,b,w,d[y+2],$o,4243563512),w=a(w,x,m,b,d[y+7],ko,1735328473),b=a(b,w,x,m,d[y+12],No,2368359562),m=c(m,b,w,x,d[y+5],Io,4294588738),x=c(x,m,b,w,d[y+8],Po,2272392833),w=c(w,x,m,b,d[y+11],Ro,1839030562),b=c(b,w,x,m,d[y+14],Ao,4259657740),m=c(m,b,w,x,d[y+1],Io,2763975236),x=c(x,m,b,w,d[y+4],Po,1272893353),w=c(w,x,m,b,d[y+7],Ro,4139469664),b=c(b,w,x,m,d[y+10],Ao,3200236656),m=c(m,b,w,x,d[y+13],Io,681279174),x=c(x,m,b,w,d[y+0],Po,3936430074),w=c(w,x,m,b,d[y+3],Ro,3572445317),b=c(b,w,x,m,d[y+6],Ao,76029189),m=c(m,b,w,x,d[y+9],Io,3654602809),x=c(x,m,b,w,d[y+12],Po,3873151461),w=c(w,x,m,b,d[y+15],Ro,530742520),b=c(b,w,x,m,d[y+2],Ao,3299628645),m=u(m,b,w,x,d[y+0],Oo,4096336452),x=u(x,m,b,w,d[y+7],Do,1126891415),w=u(w,x,m,b,d[y+14],Lo,2878612391),b=u(b,w,x,m,d[y+5],Mo,4237533241),m=u(m,b,w,x,d[y+12],Oo,1700485571),x=u(x,m,b,w,d[y+3],Do,2399980690),w=u(w,x,m,b,d[y+10],Lo,4293915773),b=u(b,w,x,m,d[y+1],Mo,2240044497),m=u(m,b,w,x,d[y+8],Oo,1873313359),x=u(x,m,b,w,d[y+15],Do,4264355552),w=u(w,x,m,b,d[y+6],Lo,2734768916),b=u(b,w,x,m,d[y+13],Mo,1309151649),m=u(m,b,w,x,d[y+4],Oo,4149444226),x=u(x,m,b,w,d[y+11],Do,3174756917),w=u(w,x,m,b,d[y+2],Lo,718787259),b=u(b,w,x,m,d[y+9],Mo,3951481745),m=r(m,E),b=r(b,R),w=r(w,F),x=r(x,ie);var lh=f(m)+f(b)+f(w)+f(x);return lh.toLowerCase()},mf=yw;function xw(e,t,r,o){return mf(t+e+o+r)}async function vn(e,t,r){let{baiduAppID:o,baiduSecretKey:n,baiduThesaurus:i}=self.globalProfile.autotranslate;if(!o)throw W.no_baidu_app_id;if(!n)throw W.no_baidu_secret_key;if([1,3,4,5,6,27].includes(t)&&!lo.CJK(e))return"";if(t===11&&!lo.Cyrillic(e))return"";if([2,7,8,12,13,14,15,16,17].includes(t)&&!lo.Latin(e))return"";let s=["auto","zh","en","yue","wyw","jp","kor","fra","spa","th","ara","ru","pt","de","it","el","nl","pl","bul","est","dan","fin","cs","rom","slo","swe","hu","cht","vie"],l=s.slice(1),a=Date.now();e=e.replace(/\n/g,"");let c=xw(e,o,n,a),u=await(0,go.fetch)("https://fanyi-api.baidu.com/api/trans/vip/translate",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{sign:c,salt:a,q:e,appid:o,from:s[t],to:l[r],action:i?1:0}}).then(p=>p.json());if(u.error_code&&u.error_msg)throw`${u.error_code}: ${u.error_msg}`;return u.trans_result.map(p=>p.dst).join(`
`)}async function $n(e,t,r){let{caiyunToken:o}=self.globalProfile.autotranslate;if(o){if([1,3].includes(t)&&!lo.CJK(e))return"";if(t===2&&!/\w+/.test(e))return""}else throw W.no_caiyun_token;let n=["auto","zh","en","ja"],i=n.slice(1),s=await(0,go.fetch)("http://api.interpreter.caiyunai.com/v1/translator",{method:"POST",headers:{"X-Authorization":`token ${o}`},json:{source:[e],trans_type:`${n[t]}2${i[r]}`,request_id:"ohmymn",detect:!0}}).then(l=>l.json());if(!s.target.length)throw W.no_result;return s.target.join(`
`)}async function gf(e){try{let{translateProviders:t,wordCount:r,baiduFromLang:o,baiduToLang:n,caiyunFromLang:i,caiyunToLang:s}=self.globalProfile.autotranslate;if(r){let[a,c]=M(r);if(kr(e)<=(gt(e)?c:a))return}return[t[0]===0?await vn(e,o[0],n[0]):await $n(e,i[0],s[0])]}catch(t){(0,go.showHUD)(String(t),2);return}}var Yt=C(T()),yf={name:"AutoTranslate",key:"autotranslate",intro:W.intro,link:S("autotranslate"),settings:[{key:"on",type:1,label:W.on,auto:{generateComments:{index:-1,method({text:e}){return gf(e)}}}},{key:"wordCount",type:4,help:W.word_count},{key:"translateProviders",type:6,option:W.translate_providers.$option2,label:W.translate_providers.label},{key:"caiyunFromLang",type:6,label:W.caiyun_from_lang.label,option:W.caiyun_from_lang.$option4,bind:["translateProviders",1]},{key:"caiyunToLang",type:6,label:W.caiyun_to_lang.label,option:W.caiyun_to_lang.$option3,bind:["translateProviders",1]},{key:"baiduFromLang",type:6,label:W.baidu_from_lang.label,option:W.baidu_from_lang.$option29,bind:["translateProviders",0]},{key:"baiduToLang",type:6,label:W.baidu_to_lang.label,option:W.baidu_to_lang.$option28,bind:["translateProviders",0]},{key:"baiduThesaurus",type:1,label:W.baidu_thesaurus.label,help:W.baidu_thesaurus.help,link:W.baidu_thesaurus.link,bind:["translateProviders",0]},{key:"showKey",type:8,label:W.$show_key2},{key:"baiduAppID",type:4,help:W.baidu_app_id.help,link:W.baidu_app_id.link,bind:[["showKey",!0],["translateProviders",0]]},{key:"baiduSecretKey",type:4,help:W.baidu_secret_key,bind:[["showKey",!0],["translateProviders",0]]},{key:"caiyunToken",type:4,help:W.caiyun_token.help,link:W.caiyun_token.link,bind:[["showKey",!0],["translateProviders",1]]}],actions4card:[{key:"translateCard",type:2,label:W.translate_card.label,help:W.translate_card.help,method:async({nodes:e})=>{try{let l=function(c){return c?r[0]===0?vn(c,o[0],n[0]):$n(c,i[0],s[0]):""};var t=l;let{translateProviders:r,baiduFromLang:o,baiduToLang:n,caiyunFromLang:i,caiyunToLang:s}=self.globalProfile.autotranslate,a=[];Yt.HUDController.show(W.loading);for(let c of e)a.push(await Promise.all(c.notes.map(u=>l(u.excerptText))));(0,Yt.undoGroupingWithRefresh)(()=>{e.forEach((c,u)=>{let p=a[u];p.length&&c.removeCommentButLinkTag(()=>!0,f=>{f.appendTextComments(...p)})})}),Yt.HUDController.hidden()}catch(r){(0,Yt.showHUD)(String(r),2)}}}],actions4text:[{key:"translateText",type:2,label:W.translate_text,method:async({text:e})=>{try{let{translateProviders:t,baiduFromLang:r,baiduToLang:o,caiyunFromLang:n,caiyunToLang:i}=self.globalProfile.autotranslate;return t[0]===0?await vn(e,r[0],o[0]):await $n(e,n[0],i[0])}catch(t){(0,Yt.showHUD)(String(t),2)}}}]};var bo=C(T());var bf=C(T());var X=(0,bf.i18n)({zh:{intro:"\u641C\u7D22\u548C\u590D\u5236\u4F60\u60F3\u8981\u7684\u3002",which_partof_card:{label:"\u9ED8\u8BA4\u641C\u7D22\u5361\u7247\u5185\u5BB9",$option4:["\u52A8\u6001\u9009\u62E9","\u4F18\u5148\u6807\u9898","\u4F18\u5148\u6458\u5F55","\u81EA\u5B9A\u4E49"],help:"\u82E5\u4F18\u5148\u7684\u5185\u5BB9\u4E3A\u7A7A\uFF0C\u5219\u6309\u7167\u6807\u9898 > \u6458\u5F55 > \u81EA\u5B9A\u4E49\u7684\u987A\u5E8F\u9012\u63A8\u3002\u9009\u4E2D\u591A\u5F20\u5361\u7247\u65F6\u9012\u63A8\u65E0\u6548\u3002"},multiple_titles:{label:"> \u5982\u679C\u6709\u591A\u4E2A\u6807\u9898",$option3:["\u52A8\u6001\u9009\u62E9","\u6240\u6709\u6807\u9898","\u7B2C\u4E00\u4E2A"]},multiple_excerpts:{label:"> \u5982\u679C\u6709\u591A\u4E2A\u6458\u5F55",$option3:["\u52A8\u6001\u9009\u62E9","\u6240\u6709\u6458\u5F55","\u7B2C\u4E00\u4E2A"]},muiltple_cards:{$option3:["\u6807\u9898","\u6458\u5F55","\u81EA\u5B9A\u4E49"]},show_search_engine:{help:"\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u81EA\u5B9A\u4E49 URL\u3002",$label2:["\u70B9\u51FB\u5C55\u5F00\u6240\u6709\u641C\u7D22\u5F15\u64CE","\u70B9\u51FB\u6536\u8D77\u6240\u6709\u641C\u7D22\u5F15\u64CE"],link:S("copysearch","\u641C\u7D22-url")},modify_symbols:{help:"\u9009\u4E2D\u591A\u5F20\u5361\u7247\u65F6\uFF0C\u4E3A\u6BCF\u5F20\u5361\u7247\u7684\u5185\u5BB9\u6DFB\u52A0\u524D\u540E\u4FEE\u9970\uFF0C\u9ED8\u8BA4\u6DFB\u52A0\u5E8F\u53F7\u548C\u6362\u884C\uFF08$&\u4EE3\u8868\u6BCF\u4E00\u6BB5\uFF09\uFF0C\u70B9\u51FB\u67E5\u770B\u81EA\u5B9A\u4E49\u65B9\u6CD5\u3002",link:S("copysearch","\u591A\u5F20\u5361\u7247")},$search_engine7:["\u4E2D\u6587","\u82F1\u6587","\u8BCD\u5178","\u7FFB\u8BD1","\u5B66\u672F","\u95EE\u9898","\u5176\u4ED6"],custom_copy:{link:S("copysearch","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\u590D\u5236\u7684\u5185\u5BB9\uFF0C\u70B9\u51FB\u67E5\u770B\u652F\u6301\u54EA\u4E9B\u53D8\u91CF\u3002"},custom_search:{link:S("copysearch","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\u641C\u7D22\u7684\u5185\u5BB9\uFF0C\u70B9\u51FB\u67E5\u770B\u652F\u6301\u54EA\u4E9B\u53D8\u91CF\u3002"},search_card_info:"\u641C\u7D22\u5361\u7247\u5185\u5BB9",copy_card_info:"\u590D\u5236\u5361\u7247\u5185\u5BB9",search_text:"\u641C\u7D22\u9009\u4E2D\u6587\u5B57",not_get_title:"\u6CA1\u6709\u83B7\u53D6\u5230\u6807\u9898",not_get_excerpt:"\u6CA1\u6709\u83B7\u53D6\u5230\u6458\u5F55\uFF0C\u4F60\u770B\u5230\u7684\u53EF\u80FD\u662F\u8BC4\u8BBA",choose_search_engine:"\u672C\u6B21\u4F7F\u7528\u54EA\u4E00\u4E2A\u641C\u7D22\u5F15\u64CE",copy_seccess:"\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427",one_card_search:"\u9ED8\u8BA4\u641C\u7D22\u7B2C\u4E00\u5F20\u5361\u7247\u7684\u5185\u5BB9\uFF0C\u8BF7\u4E0D\u8981\u9009\u62E9\u591A\u5F20\u5361\u7247",no_search_engine_url:"\u6CA1\u6709\u586B\u5199\u6B64\u641C\u7D22\u5F15\u64CE\u7684 URL",no_keyword:"\u7F3A\u5C11 {{keyword}}",choose_you_want:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u4F60\u60F3\u8981\u7684"},en:{intro:"Copy and search for what you want.",which_partof_card:{label:"Default Content To Search",$option4:["Dynamic Selection","Title First","Excerpt First","Custom"],help:"If the first content is empty, it will get the content in the order of Title > Excerpt > Custom. Not valid when multiple cards are selected"},multiple_titles:{label:"> If Multiple Titles",$option3:["All","First","Dynamic Selection"]},multiple_excerpts:{label:"> If Multiple Excerpts",$option3:["All","First","Dynamic Selection"]},muiltple_cards:{$option3:["Title","Excerpt","Custom"]},search_card_info:"Search Card Content",copy_card_info:"Copy Card Content",search_text:"Search Selected Text",$search_engine7:["Chinese","English","Dict","Translation","Academic","Question","Other"],show_search_engine:{help:"Click to see how to customize the URL",$label2:["Show All Search Engines","Hide All Search Engines"],link:S("copysearch","search-url")},modify_symbols:{help:"Add prefix and suffix to the content of each card when multiple cards are selected, and add a number and a newline by default ($& represents each paragraph). Click to see how to customize it.",link:S("copysearch","multiple-cards")},custom_copy:{link:S("copysearch","custom"),help:"Customize what you copy, click to see which variables are supported"},custom_search:{link:S("copysearch","custom"),help:"Customize what you search, click to see which variables are supported"},not_get_title:"No title found",not_get_excerpt:"No excerpt text found. What you see may be comments",choose_search_engine:"Which search engine to use this time",copy_seccess:"Copy successfully, go ahead and paste",one_card_search:"Default search the content of the first card, please do not select more than one card",no_search_engine_url:"No URL of this search engine",no_keyword:"Missing {{keyword}}",choose_you_want:"Choose one you want"}});var _t=C(T());async function yo(e,t,r=!1){let{multipleTitles:o,multipleExcerpts:n}=self.globalProfile.copysearch;if(e.length!==0)switch(t==="title"?o[0]:n[0]){case 1:{let i=e.join(t==="title"?"; ":`
`);return r?[i]:e.join(i)}case 2:return r?[e[0]]:e[0];default:return r?e:e.length===1?e[0]:await(0,_t.select)(e,g.title,X.choose_you_want)}}function xf(e,t){let{customContent:r,customSearchContent:o}=self.globalProfile.copysearch,n=t==="copy"?r:o;if(!n)return;let i=M(`${ce(n)}`,!0);return me(e,i)}async function zi(e,t,r){var s,l,a,c,u;let o=e.titles,n=e.excerptsText.map(p=>(0,_t.removeHighlight)(p)),i=xf(e,r);switch(t){case 1:{let p=(l=(s=await yo(o,"title"))!=null?s:await yo(n,"excerpt"))!=null?l:i;if(p)return p;break}case 2:{let p=(a=await yo(n,"excerpt"))!=null?a:i;if(p)return p;break}case 3:{let p=i;if(p)return p;break}default:{let p=[...(c=await yo(o,"title",!0))!=null?c:[],...(u=await yo(n,"excerpt",!0))!=null?u:[]];return i&&p.push(i),p.length===1?p[0]:await(0,_t.select)(p,g.title,X.choose_you_want)}}}function Xi(e,t,r){switch(t){case 0:{let{multipleTitles:o}=self.globalProfile.copysearch;return e.reduce((n,i)=>{let s=i.titles;return s.length&&(o[0]===2?n.push(...s):n.push(...s)),n},[])}case 1:{let{multipleTitles:o}=self.globalProfile.copysearch;return e.reduce((n,i)=>{let s=i.excerptsText.map(l=>(0,_t.removeHighlight)(l));return s.length&&(o[0]===2?n.push(s[0]):n.push(s.join(`
`))),n},[])}default:return e.reduce((o,n)=>{let i=xf(n,r);return i&&o.push(i),o},[])}}async function kn(e,t){let{searchAcademic:r,searchChineseText:o,searchEnglishText:n,searchOtherText:i,searchQuestion:s,searchTranslation:l,searchWord:a}=self.globalProfile.copysearch,c=[o,n,a,l,r,s,i][t];c?(0,_t.openUrl)(c.replace("{{keyword}}",encodeURIComponent(e))):(0,_t.showHUD)(X.no_search_engine_url,2)}var wf={name:"CopySearch",key:"copysearch",intro:X.intro,link:S("copysearch"),settings:[{label:X.which_partof_card.label,key:"whichPartofCard",type:6,option:X.which_partof_card.$option4,help:X.which_partof_card.help},{label:X.multiple_titles.label,key:"multipleTitles",type:6,option:X.multiple_titles.$option3},{label:X.multiple_excerpts.label,key:"multipleExcerpts",type:6,option:X.multiple_excerpts.$option3},{key:"modifySymbols",type:4,help:X.modify_symbols.help,link:X.modify_symbols.link,check({input:e}){if(Xe(e),!e.includes("$&"))throw"\u7F3A\u5C11 $&"}},{help:X.custom_copy.help,type:4,key:"customContent",link:X.custom_copy.link,check({input:e}){Xe(e)}},{help:X.custom_search.help,type:4,key:"customSearchContent",link:X.custom_search.link,check({input:e}){Xe(e)}},{label:X.show_search_engine.$label2,key:"showSearchEngine",type:8},...["searchChineseText","searchEnglishText","searchWord","searchTranslation","searchAcademic","searchQuestion","searchOtherText"].map((e,t)=>({type:4,help:X.$search_engine7[t],key:e,bind:["showSearchEngine",!0],check({input:r}){if(!r.includes("{{keyword}}"))throw X.no_keyword}}))],actions4card:[{type:2,key:"searchCardInfo",label:X.search_card_info,option:X.$search_engine7,async method({nodes:e,option:t}){if(e.length==1){let{whichPartofCard:r}=self.globalProfile.copysearch,o=await zi(e[0],r[0],"search");o&&kn(o,t)}else{let{modifySymbols:r,whichPartofCard:o}=self.globalProfile.copysearch,n=o[0],[i,s]=M(`${ce(r)}`,!0).split("$&");o[0]===0?n=await(0,bo.selectIndex)(X.muiltple_cards.$option3,g.title,X.choose_you_want):n-=1;let l=Xi(e,n,"search");l!=null&&l.length&&kn((a=>{if(/%\[.+\]/.test(i)){let c=yt(i,a.length);return a.map((u,p)=>i.replace(/%\[(.+)\]/,c[p])+u).join(s)}return a.map(c=>i+c).join(s)})(l),t)}}},{type:2,key:"copyCardInfo",label:X.copy_card_info,option:X.which_partof_card.$option4,async method({nodes:e,option:t}){if(e.length==1){let r=await zi(e[0],t,"copy");(0,bo.copy)(r)}else{let{modifySymbols:r}=self.globalProfile.copysearch,[o,n]=M(`${ce(r)}`,!0).split("$&"),i=Xi(e,t,"copy");(0,bo.copy)((s=>{if(/%\[.+\]/.test(o)){let l=yt(o,s.length);return s.map((a,c)=>o.replace(/%\[(.+)\]/,l[c])+a).join(n)}return s.map(l=>o+l).join(n)})(i))}}}],actions4text:[{type:2,key:"searchText",label:X.search_text,option:X.$search_engine7,method({text:e,option:t}){e&&kn(e,t)}}]};var Sf=C(T());var In=C(T());var Nn=class{constructor(t){this.cache={};this.dict=t}getDictionary(t,r={}){let{reverse:o}=r,n=o?`R_${t}`:t;return this.cache[n]||(this.cache[n]=this.dict[t].reduce((s,l)=>{let a=r.reverse?1:0;return s[l[a]]=l[1-a],s},{}))}translate(t,r){let o=Object.keys(r).reduce((i,s)=>Math.max(i,s.length),0),n=[];for(let i=0,{length:s}=t;i<s;i++){let l;for(let a=o;a>0;a--){let c=t.substr(i,a);if(Object.hasOwnProperty.call(r,c)){i+=a-1,n.push(r[c]),l=1;break}}!l&&n.push(t[i])}return n.join("")}convertChain(t,r){return r.reduce((o,n)=>{let i=n.slice();return i.splice(0,0,{}),this.translate(o,Object.assign.apply(null,i))},t)}traditionalToSimplified(t){return this.convertChain(t,[[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}hongKongToSimplified(t){return this.convertChain(t,[[this.getDictionary("HKVariantsRevPhrases"),this.getDictionary("HKVariants",{reverse:!0})],[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}taiwanToSimplified(t){return this.convertChain(t,[[this.getDictionary("TWVariantsRevPhrases"),this.getDictionary("TWVariants",{reverse:!0})],[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}taiwanToSimplifiedWithPhrases(t){return this.convertChain(t,[[this.getDictionary("TWVariantsRevPhrases"),this.getDictionary("TWVariants",{reverse:!0})],[this.getDictionary("TWPhrasesIT",{reverse:!0}),this.getDictionary("TWPhrasesName",{reverse:!0}),this.getDictionary("TWPhrasesOther",{reverse:!0})],[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}};var _f=C(T());var st=(0,_f.i18n)({zh:{intro:"\u81EA\u52A8\u5C06\u6458\u5F55\u8F6C\u6362\u4E3A\u7B80\u4F53\u4E2D\u6587\u3002",on:{label:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011"},variant:{label:"\u5F02\u4F53\u5B57\u8F6C\u6362",$option3:["\u4E2D\u56FD\u5927\u9646","\u4E2D\u56FD\u53F0\u6E7E","\u4E2D\u56FD\u9999\u6E2F"]},taiwan_idiom:{label:"\u53F0\u6E7E\u7279\u6B8A\u7528\u8BCD\u8F6C\u6362"},custom_simplify:{help:"\u81EA\u5B9A\u4E49\u8F6C\u6362\uFF0C\u70B9\u51FB\u67E5\u770B\u81EA\u5B9A\u4E49\u65B9\u6CD5\u3002",link:S("autosimplify","\u81EA\u5B9A\u4E49")},simplify_card:{label:"\u8F6C\u6362\u4E3A\u7B80\u4F53\u4E2D\u6587",$option3:["\u6458\u5F55\u548C\u6807\u9898","\u4EC5\u6458\u5F55","\u4EC5\u6807\u9898"]},simplify_text:"\u8F6C\u6362\u4E3A\u7B80\u4F53\u4E2D\u6587"},en:{intro:"Automatically convert the excerpt to Simplified Chinese.",on:{label:"Auto Run When Excerpting",help:"[Only Current Document]"},variant:{label:"Variant Conversion",$option3:["Mainland China","Taiwan China","Hong Kong China"]},taiwan_idiom:{label:"Taiwan Special Word Conversion"},custom_simplify:{help:"Custom conversion, click to get how to customize.",link:S("autosimplify","custom")},simplify_card:{label:"Convert to Simplified Chinese",$option3:["Excerpt and Title","Only Excerpt","Only Title"]},simplify_text:"Convert to Simplified Chinese"}});function Dr(e){var t;try{if(!g.dataAutoSimplify){if(!(0,In.isfileExists)(g.path+"/AutoSimplifyData.json"))throw"AutoSimplifyData.json not found";g.dataAutoSimplify=new Nn((0,In.readJSON)(g.path+"/AutoSimplifyData.json"))}let{taiwanIdiom:r,variant:o}=self.globalProfile.autosimplify,n=(()=>o[0]===1?r?g.dataAutoSimplify.taiwanToSimplifiedWithPhrases(e):g.dataAutoSimplify.taiwanToSimplified(e):o[0]===2?g.dataAutoSimplify.hongKongToSimplified(e):g.dataAutoSimplify.traditionalToSimplified(e))(),{customSimplify:i}=self.tempProfile.replaceParam;return(t=i==null?void 0:i.reduce((s,l)=>s.replace(l.regexp,l.newSubStr),n))!=null?t:n}catch(r){return Sf.dev.error(r),e}}var Cf={name:"AutoSimplify",key:"autosimplify",intro:st.intro,link:S("autosimplify"),settings:[{key:"on",type:1,label:st.on.label,help:st.on.help,auto:{modifyExcerptText:{index:0,method({text:e}){return Dr(e)}}}},{key:"variant",type:6,label:st.variant.label,option:st.variant.$option3},{key:"taiwanIdiom",type:1,label:st.taiwan_idiom.label,bind:["variant",1]},{key:"customSimplify",type:4,help:st.custom_simplify.help,link:st.custom_simplify.link}],actions4card:[{type:2,label:st.simplify_card.label,key:"simplifyCard",option:st.simplify_card.$option3,method:({nodes:e,option:t})=>{e.forEach(r=>{(t==0||t==1)&&r.notes.forEach(o=>{let n=o.excerptText;n&&(o.excerptText=Dr(n))}),(t==0||t==2)&&r.title&&(r.title=Dr(r.title))})}}],actions4text:[{type:2,label:st.simplify_card.label,key:"simplifyText",method:({text:e})=>Dr(e)}]};var Tf=C(T());var Ee=(0,Tf.i18n)({zh:{intro:"\u901A\u8FC7 URL Scheme \u6765\u89E6\u53D1 MagicAction \u4E2D\u7684\u52A8\u4F5C\uFF0C\u4F60\u53EF\u4EE5\u8BBE\u7F6E\u5FEB\u6377\u952E\u6765\u6253\u5F00 URL\u3002\u8BE5\u529F\u80FD\u5B8C\u5168\u7531 OhMyMN \u63D0\u4F9B\uFF0C\u4E0E MN \u65E0\u5173\u3002\u70B9\u51FB\u67E5\u770B\u8BBE\u7F6E\u65B9\u6CD5\u53CA\u6CE8\u610F\u4E8B\u9879\u3002",shortcut_pro:{help:"\u7528\u4E8E\u540C\u65F6\u89E6\u53D1\u591A\u4E2A\u52A8\u4F5C\u5E76\u4F20\u5165\u8F93\u5165\u503C\uFF0C\u70B9\u51FB\u521B\u5EFA\u81EA\u5B9A\u4E49\u6377\u5F84\u3002",label:"\u81EA\u5B9A\u4E49\u6377\u5F84",link:S("shortcut","\u81EA\u5B9A\u4E49\u6377\u5F84")},card_shortcut:"\u5361\u7247\u52A8\u4F5C\u6377\u5F84",action_not_work:"\u6A21\u5757\u672A\u542F\u7528\uFF0C\u8BE5\u52A8\u4F5C\u65E0\u6CD5\u6267\u884C",text_shortcut:"\u6587\u5B57\u52A8\u4F5C\u6377\u5F84",shortcut_range:"shortcut \u53C2\u6570\u8BF7\u4F20\u5165\u8303\u56F4\u5185\u7684\u6574\u6570",no_action:"\u5FC5\u987B\u4F20\u5165 action \u53C2\u6570",action_not_exist:"action \u4E0D\u5B58\u5728",option_interger:"option \u53C2\u6570\u8BF7\u4F20\u5165\u6574\u6570",info_error:"\u9519\u8BEF\u7684 actions \u53C2\u6570",type_not_exist:"type \u53C2\u6570\u4E0D\u6B63\u786E\uFF0C\u5FC5\u987B\u662F card \u6216 text"},en:{intro:"Trigger the action in MagicAction by URL Scheme, you can set a shortcut to open the URL. This feature is provided by OhMyMN, not MN. Click to view the setup method and precautions.         ",shortcut_pro:{help:"Used to trigger multiple actions at the same time and pass in input values. Click to create a custom shortcut.",label:"Custom Shortcuts",link:S("shortcut","custom-shortcuts")},card_shortcut:"Card Action Shortcut",text_shortcut:"Text Action Shortcut",action_not_work:"Module is not enabled, the action cannot be executed",shortcut_range:"The shortcut parameter should be an integer within the range",no_action:"The action parameter must be passed in",action_not_exist:"action does not exist",option_interger:"The option parameter should be an integer",type_not_exist:"The type parameter is incorrect, it must be card or text",info_error:"Incorrect Actions parameter"}});var Ef={name:"Shortcut",key:"shortcut",intro:Ee.intro,link:S("shortcut"),settings:[{key:"shortcutPro",type:1,help:Ee.shortcut_pro.help,label:Ee.shortcut_pro.label,link:Ee.shortcut_pro.link},...[...Array(8).keys()].map(e=>({key:`cardShortcut${e}`,type:6,label:`${Ee.card_shortcut} ${e+1}`,option:[]})),...[...Array(4).keys()].map(e=>({key:`textShortcut${e}`,type:6,label:`${Ee.text_shortcut} ${e+1}`,option:[]}))]};var Lr={shortcut:Ef,gesture:Cp,anotherautotitle:Lp,anotherautodef:Ap,autoformat:lf,autocomplete:Vp,autoreplace:of,autolist:zp,autotag:hf,autostyle:uf,copysearch:wf,autoocr:ef,autotranslate:yf,autocomment:Up,autosimplify:Cf},Pn={addon:_p,magicaction4card:Np,magicaction4text:Pp};var vf=C(T()),Ke=(0,vf.i18n)({zh:{magicaction_from_which_module:e=>`\u8BE5\u52A8\u4F5C\u6765\u81EA\u4E8E ${e}\uFF0C\u4E0E\u5176\u4F7F\u7528\u76F8\u540C\u7684\u8BBE\u7F6E\u3002`,open_panel:"\u5207\u6362\u63A7\u5236\u9762\u677F",custom_shortcut:"\u81EA\u5B9A\u4E49\u6377\u5F84",none:"\u65E0",expand:"\u25B6 \u70B9\u51FB\u5C55\u5F00\u6240\u6709\u9009\u9879",website:"\u5B98\u7F51\uFF1Aohmymn.marginnote.cn",core_team:"\u6838\u5FC3\u5F00\u53D1\u56E2\u961F\uFF1Aourongxing\uFF0CBryan",intro:"OhMyMN \u662F\u4E00\u4E2A\u53EF\u4EE5\u81EA\u52A8\u5904\u7406\u6458\u5F55\u7684\u5DE5\u5177\u7BB1\uFF0C\u540C\u65F6\u4E5F\u662F MarginNote \u63D2\u4EF6\u5F00\u53D1\u6846\u67B6\u3002OhMyMN \u5B8C\u5168\u5F00\u6E90\uFF0C\u5B98\u65B9\u652F\u6301\uFF0C\u6B22\u8FCE\u53C2\u4E0E\u3002"},en:{magicaction_from_which_module:e=>`This action comes from ${e} and uses the same settings. `,open_panel:"Switch Control Panel",none:"None",custom_shortcut:"Custom Shortcut",expand:"\u25B6 Click to expand all options",website:"Website: ohmymn.vercel.app",core_team:"Core Team: ourongxing\uFF0CBryan",intro:"OhMyMN is a toolbox that can process excerpts automatically and also is MarginNote addon development framework. OhMyMN is completely open source, officially supported, and welcome to join us."}});var $f={header:"More",key:"more",rows:[{type:0,label:Ke.website,link:g.doc},{type:0,label:Ke.core_team,link:g.github},{type:0,label:Ke.intro,link:g.github},{type:0,label:`









`,link:""}]};function Ji(e){let t=[{type:0,label:e.intro,link:e.link}];e.key!=="addon"&&t.push({type:0,label:Ke.expand});for(let r of e.settings)if(t.push(r),r.type!==8&&r.help)switch(r.type){case 7:case 6:case 1:case 5:case 4:t.push({type:0,label:r.help,link:r.link,bind:r.bind})}return{header:e.name,key:e.key,rows:t}}function _w(e,t,r){var E,R,F,ie;let o=[],n={key:[],name:[]},i=(R=(E=t.actions4card)==null?void 0:E.map(m=>({...m,module:"magicaction4card",moduleName:"MagicAction For Card"})))!=null?R:[],s=(ie=(F=r.actions4text)==null?void 0:F.map(m=>({...m,module:"magicaction4text",moduleName:"MagicAction For Text"})))!=null?ie:[];e.forEach(m=>{var b,w;o.push(Ji(m)),(b=m.actions4card)!=null&&b.length&&i.push(...m.actions4card.map(x=>({...x,moduleName:m.name,module:m.key,help:Ke.magicaction_from_which_module(m.name)+(x.help?x.help:"")}))),(w=m.actions4text)!=null&&w.length&&s.push(...m.actions4text.map(x=>{var se;return{...x,moduleName:m.name,module:(se=m.key)!=null?se:m.name.replace(/\x20/g,"").toLowerCase(),help:Ke.magicaction_from_which_module(m.name)+(x.help?x.help:"")}}))}),o.forEach((m,b)=>{b&&(n.key.push(m.key),n.name.push(m.header))});let l=Ji(t);l.rows.push(...i);let a=Ji(r);a.rows.push(...s);let[c,u,p]=o;for(let m of c.rows)m.type==7&&m.key=="quickSwitch"&&(m.option=n.name);let{gestureOption:f,actionKeys:h}=kf(l),{gestureOption:d,actionKeys:y}=kf(a);return St.push(...h),Ft.push(...y),p.rows=p.rows.map(m=>(m.type==6&&(m.key.includes("selectionBar")?m.option=[Ke.none,...d]:m.option=[Ke.none,...f]),m)),u.rows=u.rows.map(m=>(m.type==6&&(m.key.includes("text")?m.option=[Ke.none,...d]:m.option=[Ke.none,...f]),m)),o.splice(1,0,l),o.splice(2,0,a),o.push($f),{dataSource:o,moduleNameList:n}}function Sw(e){return e.reduce((t,r,o)=>(t[r.key]=r.rows.reduce((n,i,s)=>(i.type!=0&&(n[i.key]=[o,s]),n),{}),t),{})}function kf(e){var o;let t=[Ke.custom_shortcut,Ke.open_panel],r=[];for(let n of e.rows){if(n.type!==2&&n.type!==3)continue;let i=n;t.push(i.label),(o=i.option)!=null&&o.length?(r.push({key:i.key,module:i.module,moduleName:i.moduleName}),i.type==2?i.option.forEach((s,l)=>{t.push("\u2014\u2014"+s),r.push({key:i.key,option:l,module:i.module,moduleName:i.moduleName})}):i.option[0].includes("Auto")&&(t.push("\u2014\u2014"+i.option[0]),r.push({key:i.key,option:0,module:i.module,moduleName:i.moduleName}))):r.push({key:i.key,module:i.module,moduleName:i.moduleName,option:i.type===3?void 0:0})}return{actionKeys:r,gestureOption:t}}var St=[{key:"none"},{key:"customShortcut"},{key:"switchPanel"}],Ft=[{key:"none"},{key:"customShortcut"},{key:"switchPanel"}],{addon:Cw,magicaction4card:Tw,magicaction4text:Ew}=Pn,{dataSource:Yi,moduleNameList:Ot}=_w([Cw,...Object.values(Lr)],Tw,Ew),nt=Sw(Yi);var Df=C(T()),ve=C(T());var Nf=C(T()),re=(0,Nf.i18n)({zh:{input_saved:"\u8F93\u5165\u5DF2\u4FDD\u5B58",input_clear:"\u8F93\u5165\u5DF2\u6E05\u7A7A",none:"\u65E0",sure:"\u786E\u5B9A",uninstall:{$options2:["\u91CD\u7F6E\u914D\u7F6E","\u53BB\u8BBA\u575B\u66F4\u65B0/\u53CD\u9988"],profile_reset:"\u914D\u7F6E\u5DF2\u91CD\u7F6E",have_bugs:"\u9047\u5230 Bug \u4E86\u5417\uFF1F\u53EF\u4EE5\u5C1D\u8BD5\u91CD\u7F6E\u914D\u7F6E\u6216\u8005\u66F4\u65B0\u5230\u6700\u65B0\u7248\u672C\u3002"},read_failed:"\u81EA\u5B9A\u4E49\u5185\u5BB9\u8BFB\u53D6\u5931\u8D25",detect_link:"\u68C0\u6D4B\u5230\u94FE\u63A5\uFF0C\u662F\u5426\u76F4\u63A5\u6253\u5F00\uFF1F",no_doc:`\u5F53\u524D\u7B14\u8BB0\u672C\u6CA1\u6709\u6587\u6863\uFF0C${g.title} \u65E0\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002\u5982\u679C\u4F60\u6B63\u8981\u6253\u7B97\u6DFB\u52A0\u6587\u6863\uFF0C\u8BF7\u5728\u6DFB\u52A0\u5B8C\u6210\u540E\u91CD\u65B0\u6253\u5F00\u7B14\u8BB0\u672C\u3002`,not_select_card:"\u672A\u9009\u4E2D\u4EFB\u4F55\u8111\u56FE\u5361\u7247",not_select_area:"\u6CA1\u6709\u9009\u4E2D\u4EFB\u4F55\u533A\u57DF",no_text_selection:"\u65E0\u6CD5\u5F97\u5230\u5230\u9009\u4E2D\u533A\u57DF\u7684\u6587\u5B57",text_more_option:{$options6:["\u590D\u5236","\u8BBE\u7F6E\u4E3A\u6807\u9898","\u5408\u5E76\u6807\u9898","\u5408\u5E76\u5230\u6458\u5F55","\u8BBE\u7F6E\u4E3A\u6458\u5F55","\u8BBE\u7F6E\u4E3A\u8BC4\u8BBA"],selected_excerpt:"\u68C0\u6D4B\u5230\u60A8\u4E4B\u524D\u9009\u4E2D\u4E86\u4E00\u6761\u6458\u5F55"},copy_success:"\u590D\u5236\u6210\u529F, \u5FEB\u53BB\u7C98\u8D34\u5427!",smart_select:{title:`${g.title} \u667A\u80FD\u9009\u62E9`,$option4:["\u4EC5\u5904\u7406\u9009\u4E2D\u7684\u5361\u7247","\u4EC5\u5904\u7406\u5B50\u5361\u7247","\u4EC5\u5904\u7406\u6240\u6709\u540E\u4EE3\u5361\u7247","\u5904\u7406\u9009\u4E2D\u7684\u5361\u7247\u53CA\u5176\u540E\u4EE3\u5361\u7247"],card_with_children:"\u68C0\u6D4B\u5230\u60A8\u9009\u4E2D\u7684\u552F\u4E00\u5361\u7247\u6709\u5B50\u5361\u7247",cards_with_children:"\u68C0\u6D4B\u5230\u60A8\u9009\u4E2D\u7684\u591A\u5F20\u540C\u5C42\u7EA7\u5361\u7247\u5747\u6709\u5B50\u5361\u7247"},handle_user_action:{gesture:{alert:"\u8BE5\u529F\u80FD\u7531 OhMyMN \u63D0\u4F9B\uFF0C\u4E0E MarginNote \u65E0\u5173\u3002\u8BF7\u95EE\u60A8\u662F\u5426\u8BE6\u7EC6\u9605\u8BFB\u4F7F\u7528\u6587\u6863\uFF0C\u5E76\u77E5\u6653\u5177\u4F53\u624B\u52BF\u76D1\u6D4B\u533A\u57DF\u548C\u76F8\u5173\u4F7F\u7528\u98CE\u9669",option:["\u4E0D\u6E05\u695A\uFF0C\u67E5\u770B\u6587\u6863","\u6211\u5DF2\u77E5\u6653"]}}},en:{input_saved:"Input Saved",input_clear:"Input Clear",detect_link:"Detect link, open it directly?",no_doc:`There is no document in the notebook, ${g.title} cannot work properly. If you are about to add documents, please reopen the notebook after adding.`,none:"None",sure:"Confirm",read_failed:"Custom content read failed",uninstall:{have_bugs:"have you met a bug? Try reset profile or update to newest version.",profile_reset:"Profile has been reset",$options2:["Reset Profile","Update/Feedback"]},not_select_card:"No card is selected",not_select_area:"No area is selected",no_text_selection:"Unable to get to the text of the selection",copy_success:"Copy successfully, go ahead and paste",text_more_option:{$options6:["Copy","Set as Title","Merge Title","Merge to Excerpt","Set as Excerpt","Set as Comment"],selected_excerpt:"Detected that you previously selected an excerpt"},smart_select:{title:`${g.title} Smart Selector`,$option4:["Process only selected cards","Process only child cards","Process only all descendant cards","Process selected and descendant cards"],card_with_children:"Detect only one selected card has child cards",cards_with_children:"Detect all selected cards of the same level have child cards"},handle_user_action:{gesture:{alert:"This feature is provided by OhMyMN and not related to MarginNote. Have you read the doc and are aware of the specific gesture monitoring areas and the risks associated with their use?",option:["Not sure, check the doc","Sure, I know"]}}}});var Rf=C(T()),Rn=C(T());var Zt=(()=>{try{let e=Object.values(Lr).reduce((t,r)=>{for(let o of r.settings)if(o.key==="on"&&"auto"in o){Object.entries(o.auto).forEach(([n,i])=>{var s;t[n]=[...(s=t[n])!=null?s:[],"index"in i?{index:i.index,status:()=>Pf(r.key),method:i.method}:{index:0,status:()=>Pf(r.key),method:i}]});break}return t},{});return Object.entries(e).reduce((t,[r,o])=>(t[r]=o.sort((n,i)=>n.index-i.index).map(n=>({status:n.status,method:n.method})),t),{})}catch(e){return Rf.dev.error(e),{}}})(),{actions4card:Zi,actions4text:Qi,checkers:If}=Object.values({...Pn,...Lr}).reduce((e,t)=>{var r,o;return t.settings.length&&t.settings.forEach(n=>{"check"in n&&(e.checkers[n.key]=n.check)}),(r=t.actions4card)!=null&&r.length&&t.actions4card.forEach(n=>{e.actions4card[n.key]=n.method,"check"in n&&(e.checkers[n.key]=n.check)}),(o=t.actions4text)!=null&&o.length&&t.actions4text.forEach(n=>{e.actions4text[n.key]=n.method,"check"in n&&(e.checkers[n.key]=n.check)}),e},{actions4card:{},actions4text:{},checkers:{}}),An=Object.values(Lr).reduce((e,t)=>(e.push(t.key),e),[]);function lt(e){let{quickSwitch:t}=self.globalProfile.addon,r=An.indexOf(e);return r===-1||t.includes(r)}async function xo(e,t){try{If[t]&&await If[t]({input:e})}catch(r){return(0,Rn.showHUD)(r?String(r):Rn.MN.isZH?"\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165":"Input errors, please re-enter",3),!1}return!0}function Pf(e){var r,o,n,i,s,l;let{quickSwitch:t}=self.globalProfile.addon;return t.includes(An.indexOf(e))&&((l=(s=(n=(r=self.globalProfile[e])==null?void 0:r.on)!=null?n:(o=self.docProfile[e])==null?void 0:o.on)!=null?s:(i=self.notebookProfile[e])==null?void 0:i.on)!=null?l:!1)}var Q=C(T());async function Af(e,t,r){var i,s;let o=(i=Q.MN.currentDocumentController.imageFromSelection())==null?void 0:i.base64Encoding();if(o===void 0)return(0,Q.showHUD)(re.not_select_area,2);let n;if(e.endsWith("OCR"))n=await Qi[e]({text:"",imgBase64:o,option:t});else{let{preFormat:l,preOCR:a,preSimplify:c}=self.docProfile.magicaction4text,{selectionText:u}=Q.MN.currentDocumentController,p=a&&lt("autoocr")&&(s=await mo(o))!=null?s:u;if(!p)return(0,Q.showHUD)(re.no_text_selection,2);c&&lt("autosimplify")&&(p=Dr(p)),l&&lt("autoformat")&&(p=Or(p)),n=await Qi[e]({text:p,imgBase64:"",option:t})}if(n){if(up(n,!0)){let{option:u}=await(0,Q.popup)({title:g.title,message:re.detect_link,type:Q.UIAlertViewStyle.Default,buttons:[re.sure]},({buttonIndex:p})=>({option:p}));if(u!==-1){(0,Q.openUrl)(n.replace(/^.*(https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]).*$/,"$1"),!0);return}}let{lastFocusNote:l}=Q.MN.currentDocumentController,{noteOptions:a,showCopyContent:c}=self.globalProfile.magicaction4text;if(!l||a.length===0)c?((0,Q.copy)(n,!1),(0,Q.showHUD)(n,3)):(0,Q.copy)(n);else{let u=a[0];if(a.length>1){let f=await(0,Q.selectIndex)(re.text_more_option.$options6.filter((h,d)=>a.includes(d)),g.title,re.text_more_option.selected_excerpt);u=a[f]}let p=new Q.NodeNote(l);(0,Q.undoGroupingWithRefresh)(()=>{if(n)switch(u){case 0:c?((0,Q.copy)(n,!1),(0,Q.showHUD)(n,3)):(0,Q.copy)(n);break;case 1:p.title=n;break;case 2:p.appendTitles(n);break;case 4:p.mainExcerptText=n;break;case 3:p.mainExcerptText=p.mainExcerptText+n;break;case 5:if(e==="formulaOCR"){let{markdown:f}=self.globalProfile.autoocr;switch(f[0]){case 0:l.appendHtmlComment("```math\n"+n+"\n```","```math\n"+n+"\n```",{width:420,height:100},"MarkDownEditor");break;case 1:l.appendHtmlComment(n,n,{width:420,height:100},"MarkdownEditor");break;case 2:l.appendHtmlComment(n,n,{width:420,height:100},"MilkdownEditor");break}}else p.appendTextComments(n)}})}}}var Ye=C(T());async function Of(e,t,r){let o=[];if(e!="filterCard"&&self.globalProfile.addon.panelControl.includes(2)&&hr(),self.customSelectedNodes.length)o=self.customSelectedNodes,self.customSelectedNodes=[],Ye.HUDController.hidden();else if(o=Ye.NodeNote.getSelectedNodes(),e==="manageProfile"){if(t>1)await Ai(o[0],t);else{if(!o.length){(0,Ye.showHUD)(re.not_select_card);return}await Ai(o[0],t)}return}else{if(!o.length){(0,Ye.showHUD)(re.not_select_card);return}let n=o.every(s=>{var l,a;return((l=o[0].parentNode)==null?void 0:l.nodeid)===((a=s.note.parentNote)==null?void 0:a.noteId)&&s.childNodes.length}),i=e==="renameTitle"&&/#\[(.+)\]/.test(r);if(self.globalProfile.magicaction4card.smartSelection&&n&&!i){let{option:s}=await(0,Ye.popup)({title:re.smart_select.title,message:o.length>1?re.smart_select.cards_with_children:re.smart_select.card_with_children,type:Ye.UIAlertViewStyle.Default,buttons:re.smart_select.$option4,canCancel:!1},({buttonIndex:l})=>({option:l}));if(s!==0){let{children:l,descendant:a,all:c}=o.reduce((u,p)=>{let{descendant:f}=p.descendantNodes;return u.descendant.push(...f),u.children.push(...p.childNodes),u.all.push(p,...f),u},{children:[],descendant:[],all:[]});o=[l,a,c][s-1]}}}switch(e){case"filterCard":self.customSelectedNodes=Zi.filterCard({content:r,nodes:o,option:t});break;default:(0,Ye.undoGroupingWithRefresh)(()=>{Zi[e]({content:r,nodes:o,option:t})})}}var yr=async(e,t,r,o)=>{var n,i,s,l;if(!(e==="text"&&ve.MN.studyController.studyMode===ve.StudyMode.review||e==="card"&&(ve.MN.studyController.studyMode!==ve.StudyMode.study||ve.MN.studyController.docMapSplitMode===ve.DocMapSplitMode.allDoc)))if(r!==void 0&&o!==void 0){let a=o?Kt(o):"";if(a===""||a&&await xo(a,t.key)){await On({type:e,key:t.key,option:r,content:a});return}}else if(r!==void 0)await On({type:e,key:t.key,option:r});else switch(t.type){case 3:for(;;){let{option:c,content:u}=await(0,ve.popup)({title:t.label,message:(n=t.help)!=null?n:"",type:ve.UIAlertViewStyle.PlainTextInput,buttons:t.option?t.option:[re.sure]},({alert:f,buttonIndex:h})=>({content:f.textFieldAtIndex(0).text,option:h}));if(c===-1)return;let p=u?(i=Kt(u))==null?void 0:i.trim():"";if(p===void 0)(0,ve.showHUD)(re.read_failed);else if(p===""||p&&await xo(p,t.key)){await On({type:e,key:t.key,option:c,content:p});return}}case 2:let{option:a}=await(0,ve.popup)({title:t.label,message:(s=t.help)!=null?s:"",type:ve.UIAlertViewStyle.Default,buttons:(l=t.option)!=null?l:[re.sure]},({buttonIndex:c})=>({option:c}));if(a===-1)return;await On({type:e,key:t.key,option:a})}};async function On({type:e,key:t,option:r,content:o}){try{e==="text"?await Af(t,r,o!=null?o:""):e==="card"&&await Of(t,r,o!=null?o:"")}catch(n){Df.dev.error(String(n))}}function wo({swipeX:e,swipeY:t},{x:r,y:o,height:n,width:i}){let s=r===void 0||i===void 0||e===void 0||e>r&&e<r+i,l=o===void 0||n===void 0||t===void 0||t>o&&t<o+n;return s&&l}function vw(e){let{studyController:t}=$e.MN,{x:r,y:o}=e.locationInView(t.view),{width:n,height:i}=t.view.bounds;if(o<100||r<70||r>n-70||self.panel.status&&wo({swipeX:r,swipeY:o},self.settingViewController.view.frame))return 0;if(self.textSelectBar){let{winRect:a,arrow:c}=self.textSelectBar,[,u]=M(`[${a.replace(/[{}]/g,"")}]`);self.globalProfile.gesture.showY&&(0,$e.showHUD)(String(Math.round(u-o)),3);let[p,f]=M(self.globalProfile.gesture.selectionBarY||"[0,70]");if(wo({swipeY:o},{y:u-(c===$e.DirectionOfSelection.toRight?p:f),height:40}))return 3}if(t.studyMode!=$e.StudyMode.study)return 0;let{mindmapView:s}=t.notebookController,{selViewLst:l}=s;if(t.docMapSplitMode==$e.DocMapSplitMode.allDoc||!(l!=null&&l.length))return 0;if(l.length==1){let{width:a}=t.readerController.view.frame;if(t.docMapSplitMode==$e.DocMapSplitMode.half&&(t.rightMapMode&&r<a||!t.rightMapMode&&r>n-a))return 0;let c=l[0].view,{y:u,height:p}=s.subviews[0].subviews[0].convertRectToView(c.frame,t.view),f=l[0].note.note.groupMode;if(f===$e.GroupMode.Tree&&wo({swipeY:o},{y:u>60?u-20-30:u+p+20,height:30})||f===$e.GroupMode.Frame&&wo({swipeY:o},{y:u-20-30,height:p+20+30}))return 1}else if(l.length>1){let a=n>510?500:n-50,c={x:(n-a)/2,y:i-130,height:50,width:a};if(wo({swipeX:r,swipeY:o},c))return 2}return 0}async function _o(e,t,r,o,n){if(!lt("gesture"))return;let i=vw(n);if(i===0)return;let s,l="card";if(i===1&&t)s=St[t];else if(i===2&&r)s=St[r];else if(i===3&&o)l="text",s=Ft[o];else return;let{key:a,module:c,option:u,moduleName:p}=s;if(a!=="none")if(a=="switchPanel")so();else if(a==="customShortcut"){let f=["singleBar","muiltBar","selectionBar"][i-1]+"Swipe"+e+"Shortcut",h=self.globalProfile.gesture[f];h&&(0,$e.openUrl)(h)}else if(c&&!lt(c))(0,$e.showHUD)(`${p!=null?p:c} ${Ue.action_not_work}`,2);else{let[f,h]=nt[l==="card"?"magicaction4card":"magicaction4text"][a];await yr(l,self.dataSource[f].rows[h],u)}}var es=()=>(0,Ve.gestureHandlerController)([{view:So.MN.studyController.view,gesture:Ve.initGesture.swipe(1,Ve.UISwipeGestureRecognizerDirection.Up,"SwipeUpOnMindMapView")},{view:So.MN.studyController.view,gesture:Ve.initGesture.swipe(1,Ve.UISwipeGestureRecognizerDirection.Down,"SwipeDownOnMindMapView")},{view:So.MN.studyController.view,gesture:Ve.initGesture.swipe(1,Ve.UISwipeGestureRecognizerDirection.Left,"SwipeLeftOnMindMapView")},{view:So.MN.studyController.view,gesture:Ve.initGesture.swipe(1,Ve.UISwipeGestureRecognizerDirection.Right,"SwipeRightOnMindMapView")}]),Lf=(0,Ve.defineGestureHandlers)({onSwipeUpOnMindMapView(e){let{singleBarSwipeUp:t,muiltBarSwipeUp:r,selectionBarSwipeUp:o}=self.globalProfile.gesture;_o("Up",t[0],r[0],o[0],e)},onSwipeDownOnMindMapView(e){let{singleBarSwipeDown:t,muiltBarSwipeDown:r,selectionBarSwipeDown:o}=self.globalProfile.gesture;_o("Down",t[0],r[0],o[0],e)},onSwipeLeftOnMindMapView(e){let{singleBarSwipeLeft:t,muiltBarSwipeLeft:r,selectionBarSwipeLeft:o}=self.globalProfile.gesture;_o("Left",t[0],r[0],o[0],e)},onSwipeRightOnMindMapView(e){let{singleBarSwipeRight:t,muiltBarSwipeRight:r,selectionBarSwipeRight:o}=self.globalProfile.gesture;_o("Right",t[0],r[0],o[0],e)},onDoubleClickOnTableView(){let{panelControl:e}=self.globalProfile.addon;e.includes(1)&&hr()}});var K=C(T()),at=C(T());var Ze=C(T()),Pe=C(T());var Dn=C(T()),Mf=C(T());async function Bf(){var t;let e=(t=Zt.customOCR)==null?void 0:t.filter(r=>r.status());if(e!=null&&e.length){let r=Dn.MN.currentDocumentController.imageFromFocusNote().base64Encoding();for(let o of e){let n=await o.method({imgBase64:r});if(n)return n}Dn.dev.log("Custom OCR over","ocr")}}async function $w(e,t,r){var n;let o=(n=Zt.generateTitles)==null?void 0:n.filter(i=>i.status());if(o!=null&&o.length)for(let i of o){let s=await i.method({note:e,node:t,text:r});if(s)return s}}async function ts(e,t,r){var s,l;let o={comments:[],tags:[]},n=(s=Zt.generateComments)==null?void 0:s.filter(a=>a.status()),i=(l=Zt.generateTags)==null?void 0:l.filter(a=>a.status());if(n!=null&&n.length)for(let a of n){let c=await a.method({note:e,node:t,text:r});c&&o.comments.push(...c)}if(i!=null&&i.length)for(let a of i){let c=await a.method({note:e,node:t,text:r});c&&o.tags.push(...c)}return o}async function Uf(e){var d,y;let{note:t,text:r,node:o,isComment:n}=e,i=o.titles,{hasTitleThen:s,dragMerge:l}=self.globalProfile.addon,{cacheTitle:a}=self.notebookProfile.additional,c,u=r,p,f={text:r,title:[],comments:[],tags:[]},h=(d=Zt.modifyExcerptText)==null?void 0:d.filter(E=>E.status());if(h!=null&&h.length){for(let E of h){let R=await E.method({node:o,note:t,text:f.text});R&&(f.text=R)}u=f.text}if(!(n&&(l[0]===0||l[0]!==0&&i.length!==0&&s[0]===0))){let E=await $w(t,o,f.text);if(!E&&n&&l[0]===2&&(E={title:[f.text],text:""}),E!=null&&E.title.length){c=E.title,f.text=E.text,f.comments=[...(y=E==null?void 0:E.comments)!=null?y:[],...f.comments];let R=a[self.noteid];if(self.excerptStatus.isModify&&i.length&&(R==null?void 0:R.length)){let F=i.reduce((ie,m,b)=>(R.some(w=>Vt.tell(w,m))&&ie.unshift(b),ie),[]);F.length&&(p=F[F.length-1],F.forEach(ie=>{i.splice(ie,1)}))}}c!=null&&c.length&&(a[self.noteid]=c.map(R=>Vt.to(R)),n?s[0]===1?p!==void 0?(f.title=[...i],f.title.splice(p,0,...c)):f.title=[...i,...c]:s[0]===2&&(f.title=[...c]):p!==void 0?(f.title=[...i],f.title.splice(p,0,...c)):f.title=[...i,...c])}if(f.text||u){let E=f.text;!E&&u&&(E=u);let{tags:R,comments:F}=await ts(t,o,E);f.tags.push(...R),f.comments.push(...F)}return f}async function Ff(e){var r;self.excerptStatus.isModify&&(e=e.map(o=>(0,Mf.removeHighlight)(o)));let t=(r=Zt.modifyTitles)==null?void 0:r.filter(o=>o.status());if(t!=null&&t.length)for(let o of t){let n=await o.method({titles:e});n&&(e=n)}return e}async function Gf(e){var r;let t=(r=Zt.modifyStyle)==null?void 0:r.filter(o=>o.status());if(t!=null&&t.length)for(let o of t){let n=await o.method({note:e});if(n)return n}}var ee,Ct,br,Bn=!1,Mn=!1,Ln=!1,rs=async e=>{var t,r,o,n,i;if(Ze.dev.log("Processing Excerpt","excerpt"),ee=e,Ct=new Pe.NodeNote(ee),br=Ct.note,Bn=!1,Mn=br.noteId!==ee.noteId,Mn&&Ze.dev.log("The Excerpt is a comment","excerpt"),Ln=!1,ee.excerptPic){let s=(o=(r=(t=Ze.MN.db.getNotebookById(ee.notebookId))==null?void 0:t.options)==null?void 0:r.autoOCRMode)!=null?o:!1;Ze.dev.log("The excerpt is image","ocr"),s?await(0,Pe.delayBreak)(50,.1,()=>!!ee.excerptText)?(Ze.dev.log("Image to text success","ocr"),Bn=!0,self.excerptStatus.OCROnlineStatus="free"):(Ln=!0,Ze.dev.log("Image to text fail, no text","ocr")):(Ln=!0,Ze.dev.log("No auto-to-text option on, no image processing","ocr"))}if(Ln){let{tags:s,comments:l}=await ts(ee,Ct,"@picture");jf({comments:l,tags:s})}else{if(self.docProfile.additional.needOCRWait&&(self.docProfile.additional.needOCRWait=await(0,Pe.delayBreak)(50,.01,()=>self.excerptStatus.OCROnlineStatus==="begin")),self.excerptStatus.OCROnlineStatus==="begin"&&(Ze.dev.log("Online OCR ing","ocr"),await(0,Pe.delayBreak)(50,.1,()=>self.excerptStatus.OCROnlineStatus==="end")?Ze.dev.log("Online OCR success","ocr"):Ze.dev.log("Online OCR fail","ocr")),self.excerptStatus.OCROnlineStatus="free",self.globalProfile.addon.lockExcerpt&&self.excerptStatus.isModify&&self.excerptStatus.lastExcerptText!==void 0)return qf({text:self.excerptStatus.lastExcerptText}),Ze.dev.log("Locking excerpt is ON, restore excerpt","excerpt");let s=(i=await Bf())!=null?i:(n=ee.excerptText)==null?void 0:n.trim();if(!s)return;let{title:l,text:a,comments:c,tags:u}=await Uf({note:ee,node:Ct,text:s,isComment:Mn});qf({text:a,title:(await Ff(Rt(l))).join("; ")}),jf({comments:c,tags:u})}kw()};function qf({text:e,title:t}){(0,Pe.undoGroupingWithRefresh)(()=>{var r,o,n;if(e)ee.excerptText=e,((r=self.excerptStatus.lastRemovedComment)==null?void 0:r.note.noteId)===ee.noteId&&(self.excerptStatus.lastRemovedComment=void 0);else if(Mn){let i=Ct.getCommentIndex(ee);if(i!=-1){let{removeExcerpt:s}=self.globalProfile.addon;self.excerptStatus.lastRemovedComment={nodeNote:br,index:i,note:ee},s[0]===0&&xr()}Bn&&((o=br.excerptText)==null?void 0:o.trim())===((n=br.noteTitle)==null?void 0:n.trim())&&(br.excerptText=t)}else Bn?ee.excerptText=t:ee.excerptText="";t&&(Ct.title=t)})}function jf({tags:e,comments:t}){var r;((r=self.excerptStatus.lastRemovedComment)==null?void 0:r.note.noteId)===ee.noteId||!(0,Pe.isNoteExist)(ee)||(0,Pe.undoGroupingWithRefresh)(()=>{if(t!=null&&t.length){t=Rt(t);let{cacheComment:o}=self.notebookProfile.additional,n=o[ee.noteId];if(n){let i=Ct.note.comments,s=[];i.forEach((l,a)=>{l.type==="TextNote"&&n.some(c=>Vt.tell(c,l.text))&&s.unshift(a)}),s.forEach(l=>{br.removeCommentByIndex(l)})}o[ee.noteId]=t.reduce((i,s)=>(s&&i.push(Vt.to(s)),i),[]),Ct.appendTextComments(...t)}if(e!=null&&e.length){e=Rt(e);let{cacheTag:o}=self.notebookProfile.additional,n=o[ee.noteId],i=Ct.tags.filter(s=>n!=null&&n.length?!n.some(l=>Vt.tell(l,s)):!0);o[ee.noteId]=e.reduce((s,l)=>(l&&s.push(Vt.to(l)),s),[]),Ct.tags=[...i,...e]}})}async function kw(){var o;if(((o=self.excerptStatus.lastRemovedComment)==null?void 0:o.note.noteId)===ee.noteId||!(0,Pe.isNoteExist)(ee))return;let e=await Gf(ee);if(!e)return;let{color:t,style:r}=e;t===void 0&&r==null||(0,Pe.undoGroupingWithRefresh)(()=>{t!==void 0&&(ee.colorIndex=t!==-1?t:12),r!==void 0&&(ee.fillIndex=r)})}function xr(){if(!self.excerptStatus.lastRemovedComment)return;let{nodeNote:e,index:t,note:r}=self.excerptStatus.lastRemovedComment;(0,Pe.isNoteExist)(r)&&(0,Pe.isNoteExist)(e)&&(0,Pe.undoGroupingWithRefresh)(()=>{e.removeCommentByIndex(t)}),self.excerptStatus.lastRemovedComment=void 0;let o=r.noteId,{cacheTitle:n,cacheComment:i,cacheTag:s}=self.notebookProfile.additional;n[o]&&(n[o]=void 0),i[o]&&(n[o]=void 0),s[o]&&(n[o]=void 0)}var Hf=C(T()),zf=C(Vf());var ns=C(T());async function Xf(e){try{let t=zf.default.parse(e);if("info"in t||"actions"in t){if(!self.globalProfile.shortcut.shortcutPro)return;let r=[];try{let{info:o,actions:n}=t;if(r=JSON.parse(n||o),!r.length)throw""}catch{throw Ee.info_error}for(let o of r){let{type:n,action:i,option:s,content:l}=o;if(!i)throw Ee.no_action;let a=(()=>{if(n==="card"){let h=St.find(d=>d.key===i);if(h)return{...h,type:"card"}}else if(n==="text"){let h=Ft.find(d=>d.key===i);if(h)return{...h,type:"text"}}else throw Ee.type_not_exist})();if(!a)throw Ee.action_not_exist;let{key:c,module:u,moduleName:p,type:f}=a;if(u&&!lt(u))throw`${p!=null?p:u} ${Ee.action_not_work}`;{let[h,d]=nt[f==="card"?"magicaction4card":"magicaction4text"][c];if(s!==null&&!Number.isInteger(Number(s)))throw Ee.option_interger;let y=s===null?void 0:Number(s);await yr(f,self.dataSource[h].rows[d],y,l===null?void 0:String(l))}}}else{let{type:r,shortcut:o}=t;switch(r){case"card":case"text":{let n=Number(o);if(!Number.isInteger(n)||r==="card"&&(n<1||n>8)||r==="text"&&(n<1||n>4))throw Ee.shortcut_range;let i=self.globalProfile.shortcut[`${r}Shortcut${Number(o)-1}`],{key:s,module:l,option:a,moduleName:c}=r==="card"?St[i[0]]:Ft[i[0]];if(s==="none")return;if(s=="switchPanel")so();else if(l&&!lt(l))(0,ns.showHUD)(`${c!=null?c:l} ${Ee.action_not_work}`,2);else{let[u,p]=nt[r==="card"?"magicaction4card":"magicaction4text"][s];await yr(r,self.dataSource[u].rows[p],a)}break}default:throw Ee.type_not_exist}}}catch(t){(0,ns.showHUD)(String(t),2),Hf.dev.error(t)}}var Aw=[{event:g.key+"InputOver",handler:"onInputOver"},{event:g.key+"ButtonClick",handler:"onButtonClick"},{event:g.key+"SelectChange",handler:"onSelectChange"},{event:g.key+"SwitchChange",handler:"onSwitchChange"}],Ow=["OCRImageEnd","OCRImageBegin","AddonBroadcast","PopupMenuOnNote","ProcessNewExcerpt","ChangeExcerptRange","PopupMenuOnSelection","ClosePopupMenuOnNote","ClosePopupMenuOnSelection"],is=(0,at.eventHandlerController)([...Aw,...Ow]),Jf=(0,at.defineEventHandlers)({async onButtonClick(e){if(self.window!==K.MN.currentWindow)return;K.dev.log("Click a button","event");let{row:t,type:r}=e.userInfo;await yr(r,t)},async onSwitchChange(e){if(self.window!==K.MN.currentWindow)return;K.dev.log("Switch the switch","event");let{name:t,key:r,status:o}=e.userInfo;await wn(t,r,o)},async onSelectChange(e){if(self.window!==K.MN.currentWindow)return;K.dev.log("Change the selection","event");let{name:t,key:r,selections:o}=e.userInfo;switch(r){case"panelPosition":mt(void 0,o[0]);break;case"panelHeight":mt(o[0]);break}await wn(t,r,o)},async onInputOver(e){if(self.window!==K.MN.currentWindow)return;K.dev.log("Input","event");let{name:t,key:r,content:o}=e.userInfo;switch(Ni(r,o),(0,at.showHUD)(o?re.input_saved:re.input_clear),r){case"baiduApiKey":case"baiduSecretKey":self.globalProfile.additional.autoocr.lastGetToken=0}await wn(t,r,o)},onOCRImageBegin(e){self.window===K.MN.currentWindow&&(self.docProfile.additional.needOCRWait=!0,self.excerptStatus.OCROnlineStatus="begin",K.dev.log("Online OCR begin","ocr"))},async onOCRImageEnd(e){self.window===K.MN.currentWindow&&(self.excerptStatus.OCROnlineStatus="end",K.dev.log("Online OCR end","ocr"))},onPopupMenuOnSelection(e){self.window===K.MN.currentWindow&&(self.textSelectBar={winRect:e.userInfo.winRect,arrow:e.userInfo.arrow},K.dev.log("Popup menu on selection open","event"))},onClosePopupMenuOnSelection(e){self.window===K.MN.currentWindow&&(self.textSelectBar=void 0,self.excerptStatus.OCROnlineStatus="free",K.dev.log("Popup menu on selection close","event"))},async onPopupMenuOnNote(e){var o;if(self.window!==K.MN.currentWindow||(self.excerptStatus.isChangeExcerptRange=!1,self.excerptStatus.isProcessNewExcerpt=!1,await(0,at.delayBreak)(20,.05,()=>self.excerptStatus.isChangeExcerptRange||self.excerptStatus.isProcessNewExcerpt)))return;let r=e.userInfo.note;self.excerptStatus.lastExcerptText=(o=r.excerptText)!=null?o:""},async onClosePopupMenuOnNote(e){self.window===K.MN.currentWindow&&(self.excerptStatus.OCROnlineStatus="free",K.dev.log("Popup menu on note close","event"))},onChangeExcerptRange(e){if(self.window!==K.MN.currentWindow||K.MN.studyController.studyMode!==at.StudyMode.study)return;K.dev.log("Change excerpt range","event"),self.noteid=e.userInfo.noteid;let t=K.MN.db.getNoteById(self.noteid);self.excerptStatus.isChangeExcerptRange=!0,self.excerptStatus.isModify=!0,rs(t)},onProcessNewExcerpt(e){if(self.window!==K.MN.currentWindow||K.MN.studyController.studyMode!==at.StudyMode.study)return;K.dev.log("Process new excerpt","event"),self.noteid=e.userInfo.noteid;let t=K.MN.db.getNoteById(self.noteid);self.excerptStatus.isProcessNewExcerpt=!0,self.excerptStatus.isModify=!1,self.globalProfile.addon.lockExcerpt&&(self.excerptStatus.lastExcerptText=void 0),xr(),rs(t)},async onAddonBroadcast(e){if(self.window!==K.MN.currentWindow||!lt("shortcut")||K.MN.studyController.studyMode===at.StudyMode.review)return;K.dev.log("Addon broadcast","event");let{message:t}=e.userInfo,r=t.replace(new RegExp(`^${g.key}\\?`),"");t!==r&&await Xf(r)}});var V=C(T()),Re=C(T());var Zf=C(T()),pe=C(T());var Yf=C(T()),Mr=(0,Yf.i18n)({zh:{input_enter:"\u8F93\u5165\u5B8C\u6309\u56DE\u8F66\uFF08Enter\uFF09\u4FDD\u5B58",none:"\u65E0",expand:"\u25B6 \u70B9\u51FB\u5C55\u5F00\u6240\u6709\u9009\u9879",collapse:"\u25BC \u70B9\u51FB\u6536\u8D77\u6240\u6709\u9009\u9879"},en:{input_enter:"Press Enter to save",none:"None",expand:"\u25B6 Click to expand all options",collapse:"\u25BC Click to collapse all options"}});var Tt={label:e=>{if(pe.MN.isZH)return 16;{let t=Math.floor(380/Nr(e));return t>15?15:t}},input:15,plain:12,selectButton:13};function Un(e){return e.section*100+e.row+999}function Br(e){if(e==="more"||e==="addon"||e==="magicaction4card"||e==="magicaction4text")return;let[t,r]=nt.addon.quickSwitch,o=self.dataSource[t].rows[r].selections,n=An.indexOf(e);if(n!==-1)return!o.includes(n)}function Dw(){return self.dataSource.length}function Lw(e,t){let{key:r}=self.dataSource[t];return r==="addon"||r==="more"?self.dataSource[t].rows.length:Br(r)?0:self.expandSections.has(r)?self.dataSource[t].rows.length:2}function Mw(e,t){let{key:r,header:o}=self.dataSource[t];return Br(r)?void 0:o}function Gt(e,t){try{return!(Array.isArray(e[0])?e:[e]).every(o=>(Array.isArray(o[0])?o:[o]).some(i=>{var p,f,h,d;let[s,l]=i,[a,c]=s==="quickSwitch"?nt.addon.quickSwitch:(f=(p=nt)==null?void 0:p[t])==null?void 0:f[s];if(a===void 0)throw`bind key does not exist\uFF1A${s}`;let u=(d=(h=self.dataSource)==null?void 0:h[a].rows)==null?void 0:d[c];if((u.type===1||u.type===8)&&typeof l=="boolean")return u.status===l;if(u.type===6||u.type===7){if(typeof l=="number")return u.selections.includes(l);if(Array.isArray(l))return l.some(y=>u.selections.includes(y))}return!1}))}catch(r){return Zf.dev.error(String(r)),r}}function Bw(e,t){var i,s;let{rows:r,key:o}=self.dataSource[t.section],n=r[t.row];switch(n.type){case 2:case 3:if(n.module&&Br(n.module))return 0;break;case 8:return n.bind&&Gt(n.bind,o)?0:30;case 0:{if(n.bind&&Gt(n.bind,o))return 0;let l=np(n.label,45).length-1,a=(s=(i=n.label.match(/\n/g))==null?void 0:i.length)!=null?s:0;return(l>a?l:a)*15+30}default:if(n.bind&&Gt(n.bind,o))return 0}return 40}function Uw(e,t){var i,s,l,a;let{rows:r,key:o}=self.dataSource[t.section],n=r[t.row];switch(n.type){case 0:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"PlainTextCellID");return!pe.MN.isMacMN3&&n.bind&&Gt(n.bind,o)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.opaque=!1,c.textLabel.textAlignment=0,c.textLabel.lineBreakMode=0,c.textLabel.numberOfLines=0,c.textLabel.textColor=UIColor.grayColor(),c.textLabel.font=UIFont.systemFontOfSize(Tt.plain),n.link?c.textLabel.text=`\u238B ${n.label}`:o==="more"||t.row===0||t.row===1?c.textLabel.text=n.label:c.textLabel.text=`\u2191 ${n.label}`,c}case 8:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"ExplandCellID");return!pe.MN.isMacMN3&&n.bind&&Gt(n.bind,o)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.opaque=!1,c.textLabel.textAlignment=0,c.textLabel.lineBreakMode=0,c.textLabel.numberOfLines=0,c.textLabel.textColor=UIColor.grayColor(),c.textLabel.font=UIFont.systemFontOfSize(Tt.plain),n.status?c.textLabel.text=`\u25BC ${n.label[1]}`:c.textLabel.text=`\u25B6 ${n.label[0]}`,c}case 2:case 3:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"ButtonCellID");c.textLabel.font=UIFont.systemFontOfSize(Tt.label(n.label)),pe.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.textLabel.text=n.label;let u=NSData.dataWithContentsOfFile(g.path+`/icon/${n.key}.png`);return(0,pe.isNSNull)(u)||(c.imageView.image=UIImage.imageWithDataScale(u,2)),c}case 1:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"SwitchCellID");!pe.MN.isMacMN3&&n.bind&&Gt(n.bind,o)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.text=n.label,c.textLabel.font=UIFont.systemFontOfSize(Tt.label(n.label)),pe.MN.isMacMN3&&(c.textLabel.textColor=g.textColor);let u=Fn.switch((i=n.status)!=null?i:!1),p=u.frame;return p.x=c.contentView.frame.width-p.width-10,u.frame=p,u.autoresizingMask=1<<0,u.tag=Un(t),c.contentView.addSubview(u),c}case 5:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"inlineInputCellID");!pe.MN.isMacMN3&&n.bind&&Gt(n.bind,o)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.font=UIFont.systemFontOfSize(Tt.label(n.label)),pe.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.textLabel.text=n.label;let u=Fn.inlineInput((s=n.content)!=null?s:""),p=u.frame;return p.x=c.contentView.frame.width-p.width-10,u.frame=p,u.autoresizingMask=1<<0,u.tag=Un(t),c.contentView.addSubview(u),c}case 4:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"inputCellID");!pe.MN.isMacMN3&&n.bind&&Gt(n.bind,o)&&(c.hidden=!0),c.textLabel.font=UIFont.systemFontOfSize(Tt.label(n.content)),pe.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.selectionStyle=0;let u=Fn.input((l=n.content)!=null?l:"");return u.autoresizingMask=1<<0,u.tag=Un(t),c.contentView.addSubview(u),c}case 7:case 6:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"selectCellID");!pe.MN.isMacMN3&&n.bind&&Gt(n.bind,o)&&(c.hidden=!0),c.textLabel.font=UIFont.systemFontOfSize(Tt.label(n.label)),c.textLabel.numberOfLines=0,pe.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.textLabel.text=n.label,c.selectionStyle=0;let u=Fn.select(n.type==6?(a=n.option[n.selections[0]])!=null?a:n.option[0]:n.selections.length?`${n.selections.length} \u2713`:Mr.none),p=u.frame;return p.x=c.contentView.frame.width-p.width-10,u.frame=p,u.autoresizingMask=1<<0,u.tag=Un(t),c.contentView.addSubview(u),c}}}var Fn={switch(e){let t={x:0,y:5,width:70,height:30},r=new UISwitch(t);return r.addTargetActionForControlEvents(self,"switchChange:",1<<12),r.backgroundColor=UIColor.clearColor(),r.on=e,r},select(e){let t={x:0,y:5,width:70,height:30},r=new UIButton(t);return e=e.replace(new RegExp(`^[ \u2014${Be.hollow_circle_number}]+`),""),r.setTitleForState(Nr(e)<=8?e:op(e,0,6).trimEnd()+"...",0),r.setTitleColorForState(UIColor.whiteColor(),0),r.backgroundColor=g.buttonColor,r.layer.cornerRadius=10,r.layer.masksToBounds=!0,r.titleLabel.font=UIFont.boldSystemFontOfSize(Tt.selectButton),r.titleLabel.lineBreakMode=4,r.addTargetActionForControlEvents(self,"clickSelectButton:",1<<6),r},inlineInput(e){let t={x:0,y:9,width:70,height:30};pe.MN.isMacMN3||(t.y=5,t.width=100);let r=new UITextField(t);return r.font=UIFont.systemFontOfSize(Tt.input),r.textAlignment=pe.NSTextAlignment.Right,pe.MN.isMacMN3&&(r.textColor=g.textColor),r.delegate=self,r.text=e,r.placeholder="Enter",r.autoresizingMask=1<<1|1<<5,r},input(e){let t={x:40,y:9,width:250,height:30};pe.MN.isMacMN3||(t.y=5);let r=new UITextField(t);return r.font=UIFont.systemFontOfSize(Tt.input),pe.MN.isMacMN3&&(r.textColor=g.textColor),r.placeholder=Mr.input_enter,r.delegate=self,r.autoresizingMask=1<<1|1<<5,r.text=e,r}},Qf={numberOfSectionsInTableView:Dw,tableViewNumberOfRowsInSection:Lw,tableViewCellForRowAtIndexPath:Uw,tableViewTitleForHeaderInSection:Mw,tableViewHeightForRowAtIndexPath:Bw};var eh=C(T()),Ge=C(T());function ss(e){return NSIndexPath.indexPathForRowInSection((e-999)%100,(e-999-(e-999)%100)/100)}async function Fw(e,t){e.cellForRowAtIndexPath(t).selected=!1;let r=self.dataSource[t.section],o=r.rows[t.row];switch(o.type){case 0:t.row!==1||r.key==="more"||r.key==="addon"?o.link&&(0,Ge.openUrl)(o.link,!0):self.expandSections.has(r.key)?(o.label=Mr.expand,self.expandSections.delete(r.key),self.tableView.reloadData()):(o.label=Mr.collapse,self.expandSections.add(r.key),self.tableView.reloadData());break;case 3:case 2:r.key==="magicaction4card"?(0,Ge.postNotification)(g.key+"ButtonClick",{row:o,type:"card"}):r.key==="magicaction4text"&&(0,Ge.postNotification)(g.key+"ButtonClick",{row:o,type:"text"});break;case 8:o.status=!o.status,self.tableView.reloadData(),(0,Ge.postNotification)(g.key+"SwitchChange",{name:r.key,key:o.key,status:o.status})}}async function Gw(e){let t=ss(e.tag),r=self.dataSource[t.section],o=r.rows[t.row],n=e.text.trim();return(0,Ge.isNoteLink)(n)&&(0,Ge.openUrl)(n),(!n||await xo(n,o.key))&&(e.resignFirstResponder(),o.content=n,(0,Ge.postNotification)(g.key+"InputOver",{name:r.key,key:o.key,content:n})),!0}function qw(e){let t=ss(e.tag),r=self.dataSource[t.section],o=r.rows[t.row];o.status=!o.status,self.tableView.reloadData(),(0,Ge.postNotification)(g.key+"SwitchChange",{name:r.key,key:o.key,status:o.status})}var Gn;async function jw(e){var s;let{indexPath:t,selection:r,menuController:o}=e,n=self.dataSource[t.section],i=n.rows[t.row];if(self.dataSource[t.section].rows[t.row].type==6)self.dataSource[t.section].rows[t.row].selections=[r],(0,Ge.postNotification)(g.key+"SelectChange",{name:n.key,key:i.key,selections:[r]}),self.popoverController&&self.popoverController.dismissPopoverAnimated(!0);else{let l=i.selections,a=i.selections.includes(r)?l.filter(c=>c!=r):[r,...l];self.dataSource[t.section].rows[t.row].selections=a,Gn={name:n.key,key:i.key,selections:a.sort()},o.commandTable=(s=o.commandTable)==null?void 0:s.map((c,u)=>(c.checked=i.selections.includes(u),c)),o.menuTableView.reloadData()}self.tableView.reloadData()}function Ww(e){try{let t=ss(e.tag),r=self.dataSource[t.section],o=r.rows[t.row],n=MenuController.new(),i=44,s=1e-5,l={},a=(p,f,h)=>{try{if(p==="gesture"){let{module:d}=f.includes("selectionBar")?Ft[h]:St[h];if(!d)return!1;let y=l[d];if(y!==void 0)return y;{let E=Br(d);return l[d]=E,E}}else if(p==="shortcut"){let{module:d,key:y}=f.includes("text")?Ft[h]:St[h];if(y==="customShortcut")return!0;if(!d)return!1;let E=l[d];if(E!==void 0)return E;{let R=Br(d);return l[d]=R,R}}else return!1}catch{return!0}};n.commandTable=o.option.map((p,f)=>({title:p,object:self,selector:"selectAction:",height:a(r.key,o.key,f)?s:i,param:{indexPath:t,menuController:n,selection:f},checked:o.selections.includes(f)}));let c=Math.max(...o.option.map(p=>Nr(p)))*10+80;n.preferredContentSize={width:c>300?300:c,height:i*n.commandTable.filter(p=>p.height!==s).length};let u=Ge.MN.studyController.view;self.popoverController=new UIPopoverController(n),self.popoverController.presentPopoverFromRect(e.convertRectToView(e.bounds,u),u,1<<3,!0),self.popoverController.delegate=self}catch(t){eh.dev.error(t)}}function Kw(){Gn&&((0,Ge.postNotification)(g.key+"SelectChange",Gn),Gn=void 0)}var th={popoverControllerDidDismissPopover:Kw,tableViewDidSelectRowAtIndexPath:Fw,textFieldShouldReturn:Gw,clickSelectButton:Ww,switchChange:qw,selectAction:jw};var Co=C(T());var rh={viewDidLoad(){self.tableView.allowsSelection=!0,self.view.layer.cornerRadius=10,self.view.layer.borderWidth=2,self.expandSections=new Set},viewWillAppear(){self.tableView.reloadData(),Co.MN.isMacMN3&&(self.tableView.backgroundColor=Co.MN.currentThemeColor,g.textColor=Co.MN.app.currentTheme=="Gray"||Co.MN.app.currentTheme=="Dark"?UIColor.whiteColor():UIColor.blackColor()),self.view.layer.borderColor=g.buttonColor}};var oh=C(T()),nh=JSB.defineClass((0,oh.getObjCClassDeclar)("SettingViewController","UITableViewController"),{...rh,...Qf,...th});var ls=(0,Re.defineLifecycleHandler)({instanceMethods:{sceneWillConnect(){self.useConsole=!1,V.dev.log("Open a new window","lifecycle"),self.panel={status:!1,lastOpenPanel:0,lastClickButton:0,lastReaderViewWidth:0},self.addon={key:g.key,title:g.title},self.metadata={data:void 0,lastFetch:0},self.excerptStatus={isProcessNewExcerpt:!1,isChangeExcerptRange:!1,lastExcerptText:void 0,OCROnlineStatus:"free",isModify:!1,lastRemovedComment:void 0},self.isFirstOpenDoc=!0,self.customSelectedNodes=[],self.globalProfile=he(Pr),self.docProfile=he(dr),self.notebookProfile=he(mr),self.tempProfile=he(xn),self.dataSource=he(Yi),self.settingViewController=nh.new(),self.settingViewController.addon=self.addon,self.settingViewController.dataSource=self.dataSource,self.settingViewController.globalProfile=self.globalProfile,self.settingViewController.docProfile=self.docProfile,self.settingViewController.notebookProfile=self.notebookProfile},notebookWillOpen(e){var t,r;V.dev.log("Open a notebook","lifecycle"),V.MN.studyController.studyMode!==Re.StudyMode.review&&(self.isFirstOpenDoc||pt({range:3,notebookid:e}),is.add(),!V.MN.isMac&&es().add(),((r=(t=V.MN.db.getNotebookById(e))==null?void 0:t.documents)==null?void 0:r.length)===0&&(self.isFirstOpenDoc?(self.isFirstOpenDoc=!1,pt({range:0,docmd5:"00000000",notebookid:e})):pt({range:1,docmd5:"00000000"})))},documentDidOpen(e){V.dev.log("Open a document","lifecycle"),V.MN.studyController.studyMode!==Re.StudyMode.review&&(self.isFirstOpenDoc?(V.dev.log("First open a document","lifecycle"),self.isFirstOpenDoc=!1,pt({range:0,docmd5:e,notebookid:V.MN.currnetNotebookid})):pt({range:1,docmd5:e}))},notebookWillClose(e){V.dev.log("Close a notebook","lifecycle"),V.MN.studyController.studyMode!==Re.StudyMode.review&&(xr(),_n(),Dt({range:3,notebookid:e}),hr(),is.remove(),!V.MN.isMac&&es().remove())},documentWillClose(e){V.dev.log("Close a document","lifecycle"),V.MN.studyController.studyMode!==Re.StudyMode.review&&Dt({range:1,docmd5:e})},sceneDidDisconnect(){V.dev.log("Close a window","lifecycle"),xr(),V.MN.isMac&&V.MN.currentDocmd5&&V.MN.currnetNotebookid&&(_n(),Dt({range:0,docmd5:V.MN.currentDocmd5,notebookid:V.MN.currnetNotebookid}))},sceneWillResignActive(){V.dev.log("Window is inactivation","lifecycle"),xr(),!V.MN.isMac&&V.MN.currentDocmd5&&V.MN.currnetNotebookid&&(_n(),Dt({range:0,docmd5:V.MN.currentDocmd5,notebookid:V.MN.currnetNotebookid}))},sceneDidBecomeActive(){!V.MN.isMac&&mt(),V.dev.log("Window is activated","lifecycle")}},classMethods:{async addonWillDisconnect(){V.dev.log("Addon disconected","lifecycle");let{option:e}=await(0,Re.popup)({title:g.title,message:re.uninstall.have_bugs,buttons:re.uninstall.$options2},({buttonIndex:t})=>({option:t}));switch(e){case 0:{Pi(),self.isFirstOpenDoc=!0,(0,Re.showHUD)(re.uninstall.profile_reset,2);break}case 1:g.forum&&(0,Re.openUrl)(g.forum)}},addonDidConnect(){V.dev.log("Addon connected","lifecycle"),!(0,Re.isfileExists)(`${g.path}/AutoCompleteData.db`)&&(0,Re.isfileExists)(`${g.path}/AutoCompleteData.zip`)&&ZipArchive.unzipFileAtPathToDestination(`${g.path}/AutoCompleteData.zip`,g.path)}}});var sh=JSB.defineClass((0,ih.getObjCClassDeclar)(g.title,"JSExtension"),{...ls.instanceMethods,...rp,...Lf,...Jf},ls.classMethods);JSB.newAddon=e=>(g.path=e,sh);})();

} catch (e) {
  Application.sharedInstance().alert("OhMyMN-"+String(e))
}

